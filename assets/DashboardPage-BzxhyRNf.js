import{j as e,R as we,C as re,a as Ce,P as ue,L as ke,i as Ee,p as ne,b as le,S as Le,c as xe,B as Ie,d as Re,e as Ge}from"./charts-DKGMT1ng.js";import{r as c,u as He,d as De}from"./react-DGBwUpAK.js";import{u as me,c as Oe,d as Ue,r as Fe,e as Me}from"./api-DaFY7q8M.js";import{c as J,D as ie,g as qe}from"./Sidebar-CiKlTNmq.js";import{u as _e,s as se,g as $e,e as Be}from"./App-DlukWX-R.js";import"./index--rWMXLNf.js";function ze({sidebar:t,children:s}){return e.jsxs("div",{className:"h-full min-h-0 bg-slate-50 flex",children:[t&&e.jsxs("aside",{className:"w-72 bg-white/60 border-r border-stone flex flex-col shrink-0",children:[e.jsx("div",{className:"px-4 py-4",children:e.jsx("p",{className:"text-[11px] font-medium uppercase tracking-[0.14em] text-flame",children:"Questionnaires UX"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:t})]}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto",children:s})]})}function pe(t){if(navigator.clipboard?.writeText)return navigator.clipboard.writeText(t);const s=document.createElement("textarea");return s.value=t,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),Promise.resolve()}const Ve=[{value:"SUS",label:"SUS"},{value:"DEEP",label:"DEEP"},{value:"UMUX",label:"UMUX"},{value:"UMUX (Lite)",label:"UMUX (Lite)"},{value:"UEQ",label:"UEQ"},{value:"UEQ-S",label:"UEQ-S"},{value:"AttrakDiff",label:"AttrakDiff"},{value:"AttrakDiff (abrégé)",label:"AttrakDiff (abrégé)"}],We=[{value:"Ouvert",label:"Ouvert"},{value:"Fermé",label:"Fermé"}],Xe=[{value:"Site Web",label:"Site Web"},{value:"Site E-Commerce",label:"Site E-Commerce"},{value:"Application mobile",label:"Application mobile"},{value:"Application tablette",label:"Application tablette"},{value:"Logiciel",label:"Logiciel"},{value:"Autre",label:"Autre"}];function fe({project:t,hasResponses:s,existingFolders:r,onSaved:a,onCancel:n}){const[l,i]=c.useState(""),[d,f]=c.useState(""),[o,m]=c.useState("Ouvert"),[b,x]=c.useState(""),[v,k]=c.useState(""),[A,D]=c.useState(""),[E,F]=c.useState(""),[M,T]=c.useState(""),[w,L]=c.useState(!1),[I,C]=c.useState(null),[P,R]=c.useState(!1);c.useEffect(()=>{t?(i(t.name??""),f(t.questionnaireType??""),m(t.status??"Ouvert"),x(t.publicToken??""),k(t.folder??""),D(t.productType??""),F(t.productName??""),T(t.instructions??"")):(i(""),f(""),m("Ouvert"),x(""),k(""),D(""),F(""),T("")),C(null)},[t]),c.useEffect(()=>{if(t)return;const u=J(d);u&&ie[u]?T(ie[u]):T("")},[d,t]);const O=()=>{if(b.trim())return b.trim();let u;if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")u=crypto.randomUUID();else{const q=new Uint8Array(16);crypto.getRandomValues(q),u=Array.from(q,K=>K.toString(16).padStart(2,"0")).join("")}const h=u.replace(/-/g,"").slice(0,12);return x(h),h},N=async u=>{u.preventDefault(),C(null),L(!0);try{if(!l.trim())throw new Error("Le nom du projet est requis.");if(!A)throw new Error("Le type de produit est requis.");if(!E.trim())throw new Error("Le nom du produit est requis.");const h={name:l.trim(),questionnaireType:d||null,status:o||null,publicToken:O(),folder:v.trim()||null,productType:A||null,productName:E.trim(),instructions:M||null},q=t?await me(t.id,h):await Oe(h);a(q)}catch(h){C(h instanceof Error?h.message:"Impossible d'enregistrer le projet")}finally{L(!1)}},p=b?`${window.location.origin}/p/${b}`:null,_=c.useMemo(()=>r.filter(u=>u.trim().length>0),[r]);return e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-name",className:"block text-sm font-medium text-slate-700 mb-1",children:"Nom du projet"}),e.jsx("input",{id:"pf-name",type:"text",value:l,onChange:u=>i(u.target.value),required:!0,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Mon projet"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-product-name",className:"block text-sm font-medium text-slate-700 mb-1",children:"Nom du produit évalué"}),e.jsx("input",{id:"pf-product-name",type:"text",value:E,onChange:u=>F(u.target.value),required:!0,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Ex : Google Maps, Mon application..."}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Utilisé dans les instructions et remplace ",e.jsx("code",{className:"bg-slate-100 px-1 rounded",children:"@product_name"}),"."]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-type",className:"block text-sm font-medium text-slate-700 mb-1",children:"Questionnaire"}),e.jsxs("select",{id:"pf-type",value:d,onChange:u=>f(u.target.value),disabled:s,required:!0,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:bg-slate-100 disabled:text-slate-500",children:[e.jsx("option",{value:"",children:"Choisir..."}),Ve.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))]}),s&&e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Non modifiable (réponses existantes)"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-product-type",className:"block text-sm font-medium text-slate-700 mb-1",children:"Type de produit"}),e.jsxs("select",{id:"pf-product-type",value:A,onChange:u=>D(u.target.value),required:!0,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Choisir..."}),Xe.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-status",className:"block text-sm font-medium text-slate-700 mb-1",children:"Statut"}),e.jsx("select",{id:"pf-status",value:o,onChange:u=>m(u.target.value),required:!0,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:We.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-folder",className:"block text-sm font-medium text-slate-700 mb-1",children:"Dossier"}),e.jsx("input",{id:"pf-folder",type:"text",value:v,onChange:u=>k(u.target.value),list:"pf-folder-suggestions",className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Aucun dossier"}),_.length>0&&e.jsx("datalist",{id:"pf-folder-suggestions",children:_.map(u=>e.jsx("option",{value:u},u))}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Saisissez un nom de dossier ou choisissez un existant. Laissez vide pour aucun dossier."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-instructions",className:"block text-sm font-medium text-slate-700 mb-1",children:"Instructions aux répondants"}),e.jsx("textarea",{id:"pf-instructions",value:M,onChange:u=>T(u.target.value),rows:5,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 resize-y",placeholder:"Instructions affichées aux répondants en haut du questionnaire..."}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[e.jsx("code",{className:"bg-slate-100 px-1 rounded",children:"@product_name"})," sera remplacé par le nom du produit évalué."]}),E.trim()&&M.includes("@product_name")&&e.jsxs("div",{className:"mt-2 p-3 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 mb-1",children:"Aperçu pour le répondant :"}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line",children:M.replace(/@product_name/g,E.trim())})]})]}),p&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 mb-1",children:"URL publique du questionnaire"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-xs text-primary-700 bg-primary-50 px-2 py-1 rounded flex-1 truncate",children:p}),e.jsx("button",{type:"button",onClick:()=>{pe(p).then(()=>{R(!0),setTimeout(()=>R(!1),2e3)})},className:"shrink-0 text-xs text-primary-600 hover:text-primary-700 font-medium cursor-pointer",children:P?"Copié !":"Copier"})]})]}),I&&e.jsx("div",{className:"text-sm text-danger-600 bg-danger-50 px-3 py-2 rounded-lg",children:I}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:w,className:"px-4 py-2 bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 text-white text-sm font-medium rounded-lg transition-colors cursor-pointer disabled:cursor-not-allowed",children:w?"Enregistrement...":t?"Mettre à jour":"Créer le projet"}),n&&e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm font-medium text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors cursor-pointer",children:"Annuler"})]})]})}const Q={mean:0,sd:0,ci90:[0,0],ci95:[0,0],ci99:[0,0]};function U(t,s=2){const r=10**s;return Math.round(t*r)/r}function he(t){return t.length===0?0:t.reduce((s,r)=>s+r,0)/t.length}function Ke(t,s){if(t.length<=1)return 0;const r=s??he(t),a=t.reduce((n,l)=>n+(l-r)**2,0)/(t.length-1);return Math.sqrt(a)}function Z(t,s){const r=t<.5?t:1-t,a=t<.5?-1:1,n=Math.log(1/(r*r)),l=2.515517,i=.802853,d=.010328,f=1.432788,o=.189269,m=.001308,b=Math.sqrt(n),x=a*(b-(l+i*b+d*n)/(1+f*b+o*n+m*b*n));if(s>=1e3)return x;const v=(x**3+x)/(4*s),k=(5*x**5+16*x**3+3*x)/(96*s*s),A=(3*x**7+19*x**5+17*x**3-15*x)/(384*s**3),D=(79*x**9+776*x**7+1482*x**5-1920*x**3-945*x)/(92160*s**4);return x+v+k+A+D}function ae(t){return Z(t,1e4)}function Ye(t,s,r){const a=1-s/r;return t/Math.sqrt(s)*Math.sqrt(a)}function z(t,s,r,a,n){const l=Ye(s,r,a),i=n*l;return[t-i,t+i]}function g(t,s){if(t.length===0||s===0)return{...Q};const r=he(t),a=Ke(t,r),n=1e100;let l,i,d;if(s>60){const f=ae(.95),o=ae(1-(1-.95)/2),m=ae(1-(1-.99)/2);l=z(r,a,s,n,f),i=z(r,a,s,n,o),d=z(r,a,s,n,m)}else{const f=s-1,o=Z(1-(1-.9)/2,f),m=Z(1-(1-.95)/2,f),b=Z(1-(1-.99)/2,f);l=z(r,a,s,n,o),i=z(r,a,s,n,m),d=z(r,a,s,n,b)}return{mean:U(r),sd:U(a),ci90:[U(l[0]),U(l[1])],ci95:[U(i[0]),U(i[1])],ci99:[U(d[0]),U(d[1])]}}function ge(t){const s=(t.Q1??0)+(t.Q3??0)+(t.Q5??0)+(t.Q7??0)+(t.Q9??0),r=4-(t.Q2??0)+(4-(t.Q4??0))+(4-(t.Q6??0))+(4-(t.Q8??0))+(4-(t.Q10??0));return 2.5*(s+r)}function be(t){return t>=84.1?"A+":t>=80.8?"A":t>=78.9?"A-":t>=77.2?"B+":t>=74.1?"B":t>=72.6?"B-":t>=71.1?"C+":t>=65?"C":t>=62.7?"C-":t>=51.7?"D":"F"}function Ze(t){const s=[];for(const a of t)["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10"].some(l=>typeof a[l]!="number"||Number.isNaN(a[l]))||s.push(ge(a));if(s.length===0)return null;const r=g(s,s.length);return{...r,n:s.length,grade:be(r.mean)}}const Je={G1:["Q1","Q2","Q3","Q4"],G2:["Q5","Q6","Q7"],G3:["Q8","Q9","Q10"],G4:["Q11","Q12","Q13"],G5:["Q14","Q15","Q16"],G6:["Q17","Q18","Q19"]},je={G1:"Contenu percu",G2:"Structure / AI",G3:"Navigation",G4:"Effort cognitif",G5:"Cohérence mise en page",G6:"Guidage visuel"};function et(t){if(t.length===0)return null;const s={G1:[],G2:[],G3:[],G4:[],G5:[],G6:[]};for(const a of t)for(const[n,l]of Object.entries(Je))for(const i of l){const d=a[i];typeof d=="number"&&d>0&&s[n].push(d)}const r=t.length;return{n:r,G1:s.G1.length>0?g(s.G1,r):{...Q},G2:s.G2.length>0?g(s.G2,r):{...Q},G3:s.G3.length>0?g(s.G3,r):{...Q},G4:s.G4.length>0?g(s.G4,r):{...Q},G5:s.G5.length>0?g(s.G5,r):{...Q},G6:s.G6.length>0?g(s.G6,r):{...Q}}}function Ne(t){return 100*((t.Q1??0)+(t.Q2??0)+(t.Q3??0)+(t.Q4??0))/24}function tt(t){if(t.length===0)return null;const s=t.map(Ne);return{...g(s,s.length),n:s.length}}function ye(t){return 100*((t.Q1??0)+(t.Q3??0))/12}function st(t){if(t.length===0)return null;const s=t.map(ye),r=t.map(l=>100/6*(l.Q3??0)),a=t.map(l=>100/6*(l.Q1??0)),n=t.length;return{n,global:g(s,n),usability:g(r,n),usefulness:g(a,n)}}const at={ATT:["Q1","Q12","Q14","Q16","Q24","Q25"],PERSP:["Q2","Q4","Q13","Q21"],EFF:["Q9","Q20","Q22","Q23"],DEP:["Q8","Q11","Q17","Q19"],STIM:["Q5","Q6","Q7","Q18"],NOV:["Q3","Q10","Q15","Q26"]},rt={Q1:"right",Q2:"right",Q3:"left",Q4:"left",Q5:"left",Q6:"right",Q7:"right",Q8:"right",Q9:"left",Q10:"left",Q11:"right",Q12:"left",Q13:"right",Q14:"right",Q15:"right",Q16:"right",Q17:"left",Q18:"left",Q19:"left",Q20:"right",Q21:"left",Q22:"right",Q23:"left",Q24:"left",Q25:"left",Q26:"right"};function nt(t,s){if(!Number.isFinite(t)||t<1||t>7)return null;const r=rt[s];return r?r==="right"?t-4:4-t:null}function lt(t){if(t.length===0)return null;const s={ATT:[],PERSP:[],EFF:[],DEP:[],STIM:[],NOV:[],GLOBAL:[]};for(const a of t)for(const[n,l]of Object.entries(at))for(const i of l){const d=a[i];if(typeof d!="number")continue;const f=nt(d,i);f!=null&&(s[n].push(f),s.GLOBAL.push(f))}const r=t.length;return{n:r,ATT:s.ATT.length>0?g(s.ATT,r):{...Q},PERSP:s.PERSP.length>0?g(s.PERSP,r):{...Q},EFF:s.EFF.length>0?g(s.EFF,r):{...Q},DEP:s.DEP.length>0?g(s.DEP,r):{...Q},STIM:s.STIM.length>0?g(s.STIM,r):{...Q},NOV:s.NOV.length>0?g(s.NOV,r):{...Q},GLOBAL:s.GLOBAL.length>0?g(s.GLOBAL,r):{...Q}}}const it={ATT:"Attractivité",PERSP:"Clarté",EFF:"Efficacité",DEP:"Contrôlabilité",STIM:"Stimulation",NOV:"Nouveauté",GLOBAL:"Score global"},ot={PRAG:["Q1","Q2","Q3","Q4"],HED:["Q5","Q6","Q7","Q8"]};function ct(t){return!Number.isFinite(t)||t<1||t>7?null:t-4}function dt(t){if(t.length===0)return null;const s={PRAG:[],HED:[],GLOBAL:[]};for(const a of t)for(const[n,l]of Object.entries(ot))for(const i of l){const d=a[i];if(typeof d!="number")continue;const f=ct(d);f!=null&&(s[n].push(f),s.GLOBAL.push(f))}const r=t.length;return{n:r,PRAG:s.PRAG.length>0?g(s.PRAG,r):{...Q},HED:s.HED.length>0?g(s.HED,r):{...Q},GLOBAL:s.GLOBAL.length>0?g(s.GLOBAL,r):{...Q}}}const ut={PRAG:"Qualité pragmatique",HED:"Qualité hédonique",GLOBAL:"Score global"},W={QP:["QP1","QP2","QP3","QP4","QP5","QP6","QP7"],QHS:["QHS1","QHS2","QHS3","QHS4","QHS5","QHS6","QHS7"],QHI:["QHI1","QHI2","QHI3","QHI4","QHI5","QHI6","QHI7"],ATT:["ATT1","ATT2","ATT3","ATT4","ATT5","ATT6","ATT7"]},X={QP:["QP2","QP3","QP5","QP6"],QHS:["QHS2","QHS5"],QHI:["QHI3","QHI4"],ATT:["ATT2","ATT5"]};function oe(t,s=!1){if(t.length===0)return null;const r=s?X:W,a={QP:[],QHS:[],QHI:[],ATT:[],QH:[]};for(const l of t){for(const i of r.QP)a.QP.push(l[i]??0);for(const i of r.QHS)a.QHS.push(l[i]??0);for(const i of r.QHI)a.QHI.push(l[i]??0);for(const i of r.ATT)a.ATT.push(l[i]??0);for(const i of r.QHS)a.QH.push(l[i]??0);for(const i of r.QHI)a.QH.push(l[i]??0)}const n=t.length;return{n,QP:g(a.QP,n),QHS:g(a.QHS,n),QHI:g(a.QHI,n),ATT:g(a.ATT,n),QH:g(a.QH,n)}}const xt={QP:"Qualité Pragmatique",QHS:"Qualité Hédonique - Stimulation",QHI:"Qualité Hédonique - Identification",ATT:"Attractivité",QH:"Qualité Hédonique"};function ce(t,s=!1){const r=s?[...X.QP,...X.QHS,...X.QHI,...X.ATT]:[...W.QP,...W.QHS,...W.QHI,...W.ATT],a={};if(t.length===0){for(const n of r)a[n]=0;return a}for(const n of r){const l=t.reduce((i,d)=>i+(d[n]??0),0);a[n]=U(l/t.length)}return a}function mt(t){const r=t.properties?.Payload;if(!r?.rich_text)return null;const a=r.rich_text.map(n=>n.plain_text||"").join("");if(!a)return null;try{return JSON.parse(a)}catch{return null}}function pt(t,s){const r=J(t);if(!r)return null;switch(r){case"sus":{const a=ge(s);return{score:Math.round(a*100)/100,label:be(a)}}case"umux":{const a=Ne(s);return{score:Math.round(a*100)/100}}case"umux_lite":{const a=ye(s);return{score:Math.round(a*100)/100}}default:return null}}const ft={"A+":"bg-emerald-100 text-emerald-800",A:"bg-emerald-100 text-emerald-700","A-":"bg-green-100 text-green-700","B+":"bg-lime-100 text-lime-700",B:"bg-lime-100 text-lime-700","B-":"bg-yellow-100 text-yellow-700","C+":"bg-amber-100 text-amber-700",C:"bg-amber-100 text-amber-700","C-":"bg-orange-100 text-orange-700",D:"bg-red-100 text-red-700",F:"bg-red-200 text-red-800"};function ht({project:t,responses:s,onResponsesChanged:r}){const[a,n]=c.useState(null),l=async o=>{n(o);try{await Ue(t.id,o),r()}catch(m){console.error(m)}finally{n(null)}},i=async o=>{n(o);try{await Fe(t.id,o),r()}catch(m){console.error(m)}finally{n(null)}},d=s.filter(o=>!o.archived),f=s.filter(o=>o.archived);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Réponses"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:[d.length," active",d.length>1?"s":""]})]}),s.length===0?e.jsx("p",{className:"text-sm text-slate-400 py-4",children:"Aucune réponse pour le moment."}):e.jsx("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 border-b border-slate-200",children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase",children:"#"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase",children:"Score"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase",children:"Note"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-slate-500 uppercase",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100",children:[d.map((o,m)=>{const b=mt(o),x=b?.answers?pt(t.questionnaireType,b.answers):null;return e.jsxs("tr",{className:"hover:bg-slate-50/50",children:[e.jsx("td",{className:"px-3 py-2 text-slate-500",children:m+1}),e.jsx("td",{className:"px-3 py-2 font-medium text-slate-900",children:x?x.score.toFixed(1):"—"}),e.jsx("td",{className:"px-3 py-2",children:x?.label?e.jsx("span",{className:`inline-block text-xs font-semibold px-1.5 py-0.5 rounded ${ft[x.label]??"bg-slate-100 text-slate-600"}`,children:x.label}):"—"}),e.jsx("td",{className:"px-3 py-2 text-slate-500 text-xs",children:new Date(o.createdTime).toLocaleString("fr-FR")}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{onClick:()=>l(o.id),disabled:a===o.id,className:"text-xs text-danger-600 hover:text-danger-700 font-medium cursor-pointer disabled:opacity-50",children:"Supprimer"})})]},o.id)}),f.map((o,m)=>e.jsxs("tr",{className:"bg-slate-50/30 opacity-50",children:[e.jsx("td",{className:"px-3 py-2 text-slate-400 line-through",children:d.length+m+1}),e.jsx("td",{className:"px-3 py-2 text-slate-400 line-through",colSpan:2,children:"Supprimée"}),e.jsx("td",{className:"px-3 py-2 text-slate-400 text-xs line-through",children:new Date(o.createdTime).toLocaleString("fr-FR")}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{onClick:()=>i(o.id),disabled:a===o.id,className:"text-xs text-primary-600 hover:text-primary-700 font-medium cursor-pointer disabled:opacity-50",children:"Récupérer"})})]},o.id))]})]})})]})}function gt({title:t,message:s,onConfirm:r,onCancel:a,loading:n}){return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-sm w-full mx-4 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:t}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:s}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:a,disabled:n,className:"px-4 py-2 text-sm font-medium text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors cursor-pointer disabled:opacity-50",children:"Annuler"}),e.jsx("button",{onClick:r,disabled:n,className:"px-4 py-2 text-sm font-medium text-white bg-danger-600 hover:bg-danger-700 rounded-lg transition-colors cursor-pointer disabled:opacity-50",children:n?"Suppression...":"Supprimer"})]})]})})}const V=[{label:"Pire imaginable",max:25,color:"bg-red-500"},{label:"Mauvais",max:39,color:"bg-orange-500"},{label:"Acceptable",max:52,color:"bg-amber-400"},{label:"Bon",max:73,color:"bg-lime-400"},{label:"Excellent",max:86,color:"bg-green-500"},{label:"Meilleur imaginable",max:100,color:"bg-emerald-500"}];function bt({score:t,grade:s}){const r=Math.max(0,Math.min(100,t)),a=r;return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Échelle SUS"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-3 rounded-full overflow-hidden",children:V.map((n,l)=>{const i=l>0?V[l-1].max:0,d=n.max-i;return e.jsx("div",{className:`${n.color}`,style:{width:`${d}%`}},n.label)})}),e.jsx("div",{className:"absolute -top-1 w-5 h-5 bg-white border-2 border-slate-800 rounded-full shadow-sm transform -translate-x-1/2",style:{left:`${a}%`}}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("span",{className:"text-[10px] text-slate-400",children:"0"}),V.map(n=>e.jsx("span",{className:"text-[10px] text-slate-400",style:{position:"absolute",left:`${n.max}%`,transform:"translateX(-50%)"},children:n.max},n.label))]}),e.jsx("div",{className:"flex mt-4 gap-px",children:V.map((n,l)=>{const i=l>0?V[l-1].max:0,d=n.max-i;return e.jsx("div",{style:{width:`${d}%`},className:"text-center",children:e.jsx("span",{className:"text-[9px] text-slate-500 leading-tight block",children:n.label})},n.label)})})]}),e.jsxs("div",{className:"text-center mt-3",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[r.toFixed(1)," / 100"]}),e.jsxs("span",{className:"text-xs text-slate-400 ml-2",children:["Note : ",s]})]})]})}const jt={"A+":"text-emerald-600",A:"text-emerald-600","A-":"text-green-600","B+":"text-lime-600",B:"text-lime-600","B-":"text-yellow-600","C+":"text-amber-600",C:"text-amber-600","C-":"text-orange-600",D:"text-red-600",F:"text-red-700"};function Nt({stats:t}){const[s,r]=c.useState("95"),a=s==="90"?t.ci90:s==="99"?t.ci99:t.ci95;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques SUS"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Score moyen"}),e.jsx("p",{className:"text-3xl font-bold text-primary-600",children:t.mean.toFixed(1)}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"/ 100"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Note"}),e.jsx("p",{className:`text-3xl font-bold ${jt[t.grade]??"text-slate-600"}`,children:t.grade}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"Sauro & Lewis (2012)"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Variabilité"}),e.jsxs("p",{className:"text-sm text-slate-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:"σ"})," = ",t.sd.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(n=>e.jsxs("button",{onClick:()=>r(n),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===n?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[n,"%"]},n))]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["[",a[0].toFixed(1)," ; ",a[1].toFixed(1),"]"]})]})]}),e.jsx(bt,{score:t.mean,grade:t.grade})]})}function $({label:t,summary:s,unit:r="",showVariability:a=!0,ciLevel:n="95",colorClass:l="text-primary-600"}){const i=n==="90"?s.ci90:n==="99"?s.ci99:s.ci95;return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:t}),e.jsxs("p",{className:`text-2xl font-bold ${l}`,children:[s.mean.toFixed(2),r&&e.jsx("span",{className:"text-sm font-normal text-slate-400 ml-1",children:r})]}),a&&e.jsxs("div",{className:"mt-2 space-y-0.5",children:[e.jsxs("p",{className:"text-xs text-slate-500",children:[e.jsx("span",{className:"font-medium",children:"σ"})," = ",s.sd.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["IC",n,"% = [",i[0].toFixed(2)," ; ",i[1].toFixed(2),"]"]})]})]})}re.register(Ce,ue,ke,Ee,ne,le);function yt({stats:t}){const s=["G1","G2","G3","G4","G5","G6"],r=s.map(i=>je[i]),a=s.map(i=>t[i].mean),n={labels:r,datasets:[{label:"Score moyen",data:a,backgroundColor:"rgba(59, 130, 246, 0.15)",borderColor:"rgba(59, 130, 246, 0.8)",borderWidth:2,pointBackgroundColor:"rgba(59, 130, 246, 1)",pointBorderColor:"#fff",pointRadius:4,pointBorderWidth:2}]},l={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}},scales:{r:{beginAtZero:!0,min:0,max:5,ticks:{stepSize:1,font:{size:10},backdropColor:"transparent"},pointLabels:{font:{size:11},color:"#475569"},grid:{color:"rgba(148, 163, 184, 0.3)"},angleLines:{color:"rgba(148, 163, 184, 0.3)"}}}};return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Profil DEEP - 6 dimensions"}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx(we,{data:n,options:l})})]})}const vt=["text-blue-600","text-purple-600","text-teal-600","text-amber-600","text-pink-600","text-emerald-600"];function Qt({stats:t}){const[s,r]=c.useState("95"),a=["G1","G2","G3","G4","G5","G6"];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques DEEP"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(n=>e.jsxs("button",{onClick:()=>r(n),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===n?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[n,"%"]},n))]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:a.map((n,l)=>e.jsx($,{label:je[n],summary:t[n],unit:"/ 5",ciLevel:s,colorClass:vt[l]},n))}),e.jsx(yt,{stats:t})]})}function ve({score:t,max:s,label:r}){const a=Math.max(0,Math.min(100,t/s*100));return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:r}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-3 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-red-400 via-amber-400 via-50% to-emerald-500 transition-all duration-500",style:{width:`${a}%`}})}),e.jsx("div",{className:"absolute -top-1 w-5 h-5 bg-white border-2 border-slate-800 rounded-full shadow-sm transform -translate-x-1/2 transition-all duration-500",style:{left:`${a}%`}}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("span",{className:"text-[10px] text-slate-400",children:"0"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:s})]})]}),e.jsxs("p",{className:"text-center text-sm font-semibold text-slate-700 mt-2",children:[t.toFixed(1)," / ",s]})]})}function St({stats:t}){const[s,r]=c.useState("95"),a=s==="90"?t.ci90:s==="99"?t.ci99:t.ci95;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UMUX"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Score moyen"}),e.jsx("p",{className:"text-3xl font-bold text-primary-600",children:t.mean.toFixed(1)}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"/ 100"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Variabilité"}),e.jsxs("p",{className:"text-sm text-slate-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:"σ"})," = ",t.sd.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(n=>e.jsxs("button",{onClick:()=>r(n),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===n?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[n,"%"]},n))]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["[",a[0].toFixed(1)," ; ",a[1].toFixed(1),"]"]})]})]}),e.jsx(ve,{score:t.mean,max:100,label:"Score UMUX"})]})}function Tt({stats:t}){const[s,r]=c.useState("95");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UMUX-Lite"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(a=>e.jsxs("button",{onClick:()=>r(a),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===a?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[a,"%"]},a))]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx($,{label:"Score global",summary:t.global,unit:"/ 100",ciLevel:s,colorClass:"text-primary-600"}),e.jsx($,{label:"Utilisabilité (Q3)",summary:t.usability,unit:"/ 100",ciLevel:s,colorClass:"text-teal-600"}),e.jsx($,{label:"Utilité (Q1)",summary:t.usefulness,unit:"/ 100",ciLevel:s,colorClass:"text-purple-600"})]}),e.jsx(ve,{score:t.global.mean,max:100,label:"Score global UMUX-Lite"})]})}const Pt={GLOBAL:"text-primary-600",ATT:"text-amber-600",PERSP:"text-blue-600",EFF:"text-teal-600",DEP:"text-indigo-600",STIM:"text-pink-600",NOV:"text-purple-600"},At=["GLOBAL","ATT","PERSP","EFF","DEP","STIM","NOV"];function wt({stats:t}){const[s,r]=c.useState("95");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UEQ"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(a=>e.jsxs("button",{onClick:()=>r(a),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===a?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[a,"%"]},a))]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:At.map(a=>e.jsx($,{label:it[a],summary:t[a],ciLevel:s,colorClass:Pt[a]},a))}),e.jsx("p",{className:"text-xs text-slate-500",children:"Échelle UEQ normalisée de -3 (négatif) à +3 (positif)."})]})}const Ct={GLOBAL:"text-primary-600",PRAG:"text-teal-600",HED:"text-pink-600"},kt=["GLOBAL","PRAG","HED"];function Et({stats:t}){const[s,r]=c.useState("95");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UEQ-S"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(a=>e.jsxs("button",{onClick:()=>r(a),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===a?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[a,"%"]},a))]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:kt.map(a=>e.jsx($,{label:ut[a],summary:t[a],ciLevel:s,colorClass:Ct[a]},a))}),e.jsx("p",{className:"text-xs text-slate-500",children:"Échelle UEQ-S normalisée de -3 (négatif) à +3 (positif)."})]})}re.register(xe,ue,ne,le);function Lt({qp:t,qh:s}){const r={datasets:[{label:"Produit",data:[{x:t,y:s}],backgroundColor:"rgba(59, 130, 246, 1)",borderColor:"#fff",borderWidth:2,pointRadius:8,pointHoverRadius:10}]},a={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{label:n=>`QP: ${(n.parsed.x??0).toFixed(2)}, QH: ${(n.parsed.y??0).toFixed(2)}`}}},scales:{x:{title:{display:!0,text:"Qualité Pragmatique (QP)",font:{size:11}},min:-3,max:3,grid:{color:"rgba(148, 163, 184, 0.2)"},ticks:{font:{size:10}}},y:{title:{display:!0,text:"Qualité Hédonique (QH)",font:{size:11}},min:-3,max:3,grid:{color:"rgba(148, 163, 184, 0.2)"},ticks:{font:{size:10}}}}};return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Portfolio AttrakDiff"}),e.jsx(Le,{data:r,options:a})]})}re.register(Re,xe,Ge,ne,le);const It={QP:"rgba(59, 130, 246, 0.7)",QHS:"rgba(168, 85, 247, 0.7)",QHI:"rgba(236, 72, 153, 0.7)",ATT:"rgba(245, 158, 11, 0.7)"};function Rt(t){return t.startsWith("QP")?"QP":t.startsWith("QHS")?"QHS":t.startsWith("QHI")?"QHI":t.startsWith("ATT")?"ATT":"QP"}function Gt({wordPairs:t,questionnaire:s}){const r=s.questions.filter(o=>o.type==="bipolar"),a=r.map(o=>`${o.leftFr} / ${o.rightFr}`),n=r.map(o=>t[o.id]??0),l=r.map(o=>It[Rt(o.id)]??"rgba(100,100,100,0.5)"),i={labels:a,datasets:[{label:"Moyenne",data:n,backgroundColor:l,borderWidth:0,borderRadius:3}]},d={responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{min:-3,max:3,grid:{color:"rgba(148, 163, 184, 0.2)"},ticks:{font:{size:10}}},y:{ticks:{font:{size:10}},grid:{display:!1}}}},f=Math.max(300,r.length*28);return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Paires de mots - Moyennes"}),e.jsx("div",{style:{height:`${f}px`},children:e.jsx(Ie,{data:i,options:d})})]})}const Ht={QP:"text-blue-600",QHS:"text-purple-600",QHI:"text-pink-600",ATT:"text-amber-600",QH:"text-teal-600"};function Dt({stats:t,wordPairs:s,questionnaire:r,abridged:a}){const[n,l]=c.useState("95"),i=["QP","QHS","QHI","ATT","QH"];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-900",children:["Statistiques AttrakDiff",a?" (abrégé)":""]}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(d=>e.jsxs("button",{onClick:()=>l(d),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${n===d?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[d,"%"]},d))]})]}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:i.map(d=>e.jsx($,{label:xt[d],summary:t[d],ciLevel:n,colorClass:Ht[d]},d))}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Lt,{qp:t.QP.mean,qh:t.QH.mean}),e.jsx(Gt,{wordPairs:s,questionnaire:r})]})]})}function Qe(t){const r=t.properties?.Payload;if(!r?.rich_text)return null;const a=r.rich_text.map(n=>n.plain_text||"").join("");if(!a)return null;try{return JSON.parse(a)}catch{return null}}function Ot(t,s){if(!J(t.questionnaireType))return;const a=[],n=s.filter(o=>!o.archived);for(const o of n){const m=Qe(o);if(!m?.answers)continue;if(a.length===0){const v=["Date",...Object.keys(m.answers)];a.push(v)}const b=new Date(o.createdTime).toLocaleString("fr-FR"),x=Object.values(m.answers).map(v=>String(v??""));a.push([b,...x])}if(a.length===0)return;const l=a.map(o=>o.map(m=>`"${m.replace(/"/g,'""')}"`).join(";")).join(`
`),i=new Blob(["\uFEFF"+l],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(i),f=document.createElement("a");f.href=d,f.download=`${t.name?.replace(/[^a-zA-Z0-9]/g,"_")||"export"}_reponses.csv`,f.click(),URL.revokeObjectURL(d)}function Ut({project:t,responses:s,responsesLoading:r,onProjectUpdated:a,onProjectDeleted:n,onResponsesChanged:l,existingFolders:i=[],activeTab:d,onTabChange:f}){const[o,m]=c.useState(!1),[b,x]=c.useState(!1),[v,k]=c.useState("stats"),A=d??v,D=f??k,[E,F]=c.useState(!1),[M,T]=c.useState(!1),w=J(t.questionnaireType),L=w?qe(w):null,I=s.filter(h=>!h.archived),C=t.status==="Ouvert",P=t.publicToken?`${window.location.origin}/p/${t.publicToken}`:null,R=async()=>{F(!0);try{const h=C?"Fermé":"Ouvert",q=await me(t.id,{name:t.name,status:h});a(q)}catch(h){console.error(h)}finally{F(!1)}},O=()=>{P&&pe(P).then(()=>{T(!0),setTimeout(()=>T(!1),2e3)})},N=c.useMemo(()=>I.map(Qe).filter(h=>!!h?.answers).map(h=>h.answers),[I]),p=c.useMemo(()=>{if(!w||N.length===0)return null;switch(w){case"sus":return{type:"sus",data:Ze(N)};case"deep":return{type:"deep",data:et(N)};case"umux":return{type:"umux",data:tt(N)};case"umux_lite":return{type:"umux_lite",data:st(N)};case"ueq":return{type:"ueq",data:lt(N)};case"ueq_s":return{type:"ueq_s",data:dt(N)};case"attrakdiff":return{type:"attrakdiff",data:oe(N,!1),wordPairs:ce(N,!1)};case"attrakdiff_abridged":return{type:"attrakdiff_abridged",data:oe(N,!0),wordPairs:ce(N,!0)};default:return null}},[w,N]),_=async()=>{x(!0);try{await Me(t.id),n()}catch(h){console.error(h)}finally{x(!1),m(!1)}},u=[{id:"stats",label:"Résultats"},{id:"responses",label:`Réponses (${I.length})`},{id:"form",label:"Paramètres"}];return e.jsxs("div",{className:"p-6 max-w-5xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:t.name||"(Sans titre)"}),I.length>0&&e.jsxs("button",{onClick:()=>Ot(t,s),className:"text-xs text-primary-600 hover:text-primary-700 font-medium cursor-pointer flex items-center gap-1 shrink-0",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Exporter CSV"]})]}),e.jsxs("div",{className:"flex items-center gap-2.5 mt-2 flex-wrap",children:[e.jsxs("button",{onClick:R,disabled:E,className:`inline-flex items-center gap-1.5 text-xs font-medium pl-2 pr-2.5 py-1 rounded-full transition-colors cursor-pointer disabled:opacity-60 disabled:cursor-wait ${C?"bg-success-50 text-success-700 hover:bg-success-100":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,children:[e.jsxs("span",{className:"relative flex h-4 w-7 items-center",children:[e.jsx("span",{className:`absolute inset-0 rounded-full transition-colors ${C?"bg-success-400":"bg-slate-300"}`}),e.jsx("span",{className:`absolute top-0.5 h-3 w-3 rounded-full bg-white shadow-sm transition-transform ${C?"translate-x-3.5":"translate-x-0.5"}`})]}),E?"...":C?"Ouvert":"Fermé"]}),t.questionnaireType&&e.jsx("span",{className:"text-xs font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded-full",children:t.questionnaireType}),P&&e.jsx("span",{className:"w-px h-4 bg-slate-200"}),P&&e.jsxs("div",{className:"inline-flex items-center gap-1.5 min-w-0",children:[e.jsx("code",{className:"text-[11px] text-slate-400 truncate max-w-[280px]",children:P}),e.jsx("button",{onClick:O,className:"inline-flex items-center gap-1 text-xs text-primary-600 hover:text-primary-700 font-medium cursor-pointer shrink-0",children:M?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 text-success-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-success-600",children:"Copié"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copier"]})})]})]})]}),e.jsx("div",{className:"border-b border-slate-200 mb-6",children:e.jsx("nav",{className:"flex gap-6",children:u.map(h=>e.jsx("button",{onClick:()=>D(h.id),className:`pb-2.5 text-sm font-medium border-b-2 transition-colors cursor-pointer ${A===h.id?"border-primary-500 text-primary-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:h.label},h.id))})}),A==="stats"&&e.jsx("div",{children:r?e.jsx("p",{className:"text-sm text-slate-400 py-8",children:"Chargement des résultats..."}):p?.data?e.jsxs(e.Fragment,{children:[p.type==="sus"&&p.data&&e.jsx(Nt,{stats:p.data}),p.type==="deep"&&p.data&&e.jsx(Qt,{stats:p.data}),p.type==="umux"&&p.data&&e.jsx(St,{stats:p.data}),p.type==="umux_lite"&&p.data&&e.jsx(Tt,{stats:p.data}),p.type==="ueq"&&p.data&&e.jsx(wt,{stats:p.data}),p.type==="ueq_s"&&p.data&&e.jsx(Et,{stats:p.data}),(p.type==="attrakdiff"||p.type==="attrakdiff_abridged")&&p.data&&L&&e.jsx(Dt,{stats:p.data,wordPairs:p.wordPairs,questionnaire:L,abridged:p.type==="attrakdiff_abridged"})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-sm text-slate-400",children:N.length===0?"Aucune réponse pour calculer les statistiques.":"Type de questionnaire non reconnu."})})}),A==="responses"&&e.jsx("div",{children:r?e.jsx("p",{className:"text-sm text-slate-400 py-8",children:"Chargement des réponses..."}):e.jsx(ht,{project:t,responses:s,onResponsesChanged:l})}),A==="form"&&e.jsxs("div",{className:"max-w-lg",children:[e.jsx(fe,{project:t,hasResponses:I.length>0,existingFolders:i,onSaved:a}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-200",children:e.jsx("button",{onClick:()=>m(!0),className:"text-sm text-danger-600 hover:text-danger-700 font-medium cursor-pointer",children:"Supprimer ce projet"})})]}),o&&e.jsx(gt,{title:"Supprimer le projet",message:`Le projet « ${t.name} » et toutes ses réponses seront archivés. Cette action est réversible via Notion.`,onConfirm:_,onCancel:()=>m(!1),loading:b})]})}const Ft={stats:"stats",responses:"responses",settings:"form"},Mt={stats:"stats",responses:"responses",form:"settings"};function de(t){const s=t.replace(/^#/,"");if(s===""||s==="presentation")return{mode:"detail",projectId:null,tab:"stats"};if(s==="new")return{mode:"new",projectId:null,tab:"stats"};if(s.startsWith("project/")){const r=s.slice(8),a=r.indexOf("/");if(a===-1)return{mode:"detail",projectId:r||null,tab:"stats"};const n=r.slice(0,a),l=r.slice(a+1),i=Ft[l]??"stats";return{mode:"detail",projectId:n||null,tab:i}}return{mode:"detail",projectId:null,tab:"stats"}}function qt(t,s,r){if(t==="new")return"#new";if(s){const a=Mt[r]??"stats";return a==="stats"?`#project/${s}`:`#project/${s}/${a}`}return"#presentation"}function Xt({onSyncStateChange:t}={}){const s=He(),r=De(),[a,n]=c.useState([]),[l,i]=c.useState(!0),[d,f]=c.useState(null),[o,m]=c.useState(null),[b,x]=c.useState("detail"),[v,k]=c.useState("stats"),A=c.useRef(b),D=c.useRef(null),E=c.useRef(v),F=c.useRef(de(s.hash)),{responses:M,loading:T,backgroundRefreshing:w,loadResponses:L,refreshCurrent:I,invalidate:C,clear:P}=_e(),R=c.useRef(null),O=c.useRef(!1),[N,p]=c.useState(null);c.useEffect(()=>{A.current=b},[b]),c.useEffect(()=>{D.current=o?.id??null},[o?.id]),c.useEffect(()=>{E.current=v},[v]);const _=c.useMemo(()=>N||(T||w?"syncing":"idle"),[T,w,N]);c.useEffect(()=>{t?.(_)},[_,t]),c.useEffect(()=>()=>{t?.("idle")},[t]);const u=c.useRef(!1);c.useEffect(()=>{const j=T||w;u.current&&!j&&(p("saved"),R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{p(null),R.current=null},2e3)),u.current=j},[T,w]),c.useEffect(()=>()=>{R.current&&clearTimeout(R.current)},[]),c.useEffect(()=>{let j=!1;return(async()=>{try{i(!0);const S=ee=>{const{mode:B,projectId:Y,tab:Pe}=F.current;if(B==="new")x("new");else if(Y){const te=ee.find(Ae=>Ae.id===Y);te&&(m(te),x("detail"),k(Pe),L(te.id))}},G=$e();if(G){if(j)return;n(G),S(G);return}const H=await Be();if(j)return;n(H),S(H)}catch(S){j||f(S instanceof Error?S.message:"Erreur inconnue")}finally{j||i(!1)}})(),()=>{j=!0}},[]),c.useEffect(()=>{const{mode:j,projectId:y,tab:S}=de(s.hash),G=A.current,H=D.current,ee=E.current;if(j==="new"){if(G==="new"&&H===null)return;O.current=!0,m(null),x("new"),P();return}if(y){const B=a.find(Y=>Y.id===y);if(B){if(G==="detail"&&H===B.id&&ee===S)return;O.current=!0,m(B),x("detail"),k(S),L(B.id)}return}G==="detail"&&H===null||(O.current=!0,m(null),x("detail"),P())},[s.hash,a,L,P]),c.useEffect(()=>{if(O.current){O.current=!1;return}const j=qt(b,o?.id??null,v),y=s.hash;j===y||j===""&&(y===""||y==="#")||r(`${s.pathname}${s.search}${j}`,{replace:!0})},[b,o?.id,v,s.pathname,s.search,s.hash,r]);const h=c.useMemo(()=>{const j=new Set;for(const y of a)y.folder?.trim()&&j.add(y.folder.trim());return Array.from(j).sort((y,S)=>y.localeCompare(S,"fr"))},[a]),q=()=>{m(null),x("new"),P()},K=c.useCallback(j=>{n(y=>{const S=y.findIndex(H=>H.id===j.id);if(S===-1){const H=[j,...y];return se(H),H}const G=[...y];return G[S]=j,se(G),G}),m(j),x("detail"),L(j.id)},[L]),Se=c.useCallback(()=>{o&&(C(o.id),n(j=>{const y=j.filter(S=>S.id!==o.id);return se(y),y})),m(null),x("detail"),P()},[o,C,P]),Te=c.useCallback(()=>{I()},[I]);return e.jsx(ze,{children:l?e.jsx("div",{className:"flex items-center justify-center h-full py-32",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin mb-3"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Chargement des projets..."})]})}):d?e.jsx("div",{className:"flex items-center justify-center h-full py-32",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx("p",{className:"text-sm text-danger-600 mb-2",children:"Impossible de charger les projets."}),e.jsx("p",{className:"text-xs text-slate-400",children:d})]})}):b==="new"?e.jsxs("div",{className:"p-6 max-w-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-6",children:"Nouveau projet"}),e.jsx(fe,{project:null,hasResponses:!1,existingFolders:h,onSaved:K,onCancel:()=>x("detail")})]}):o?e.jsx(Ut,{project:o,responses:M,responsesLoading:T,onProjectUpdated:K,onProjectDeleted:Se,onResponsesChanged:Te,existingFolders:h,activeTab:v,onTabChange:k},o.id):e.jsxs("div",{className:"mx-auto max-w-3xl px-6 py-14",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Présentation"}),e.jsx("p",{className:"mt-3 text-sm leading-relaxed text-slate-600",children:"Cette section regroupe les questionnaires UX de l'équipe. Vous pouvez créer un projet, suivre ses réponses et accéder aux analyses directement depuis la liste."}),e.jsx("p",{className:"mt-2 text-sm leading-relaxed text-slate-500",children:"Sélectionnez un projet dans le panneau latéral pour ouvrir son détail."}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:q,className:"btn-primary-sm cursor-pointer",children:"Créer un projet"})}),a.length>0&&e.jsxs("p",{className:"mt-5 text-xs text-slate-400",children:[a.length," projet",a.length>1?"s":""," disponible",a.length>1?"s":"","."]})]})})}export{Xt as DashboardPage};
