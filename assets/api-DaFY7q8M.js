const n="https://outils-wlu.f-jaouali.workers.dev".replace(/\/+$/,"")||"http://localhost:8787";function i(){return typeof window>"u"?null:window.localStorage.getItem("authToken")}function s(o=!1){const t={};o&&(t["Content-Type"]="application/json");const e=i();return e&&(t.Authorization=`Bearer ${e}`),t}async function u(){const o=await fetch(`${n}/projects`,{headers:s()});if(!o.ok){const e=await o.text();throw new Error(`Erreur API /projects (${o.status}) : ${e}`)}return(await o.json()).projects??[]}async function p(o){const t=await fetch(`${n}/projects/${encodeURIComponent(o)}/responses`,{headers:s()});if(!t.ok){const r=await t.text();throw new Error(`Erreur API réponses (${t.status}) : ${r}`)}return(await t.json()).responses??[]}async function w(o){const t=await fetch(`${n}/projects`,{method:"POST",headers:s(!0),body:JSON.stringify(o)});if(!t.ok){const r=await t.text();throw new Error(`Erreur création projet (${t.status}) : ${r}`)}const e=await t.json();if(!e.project)throw new Error("Réponse création projet invalide");return e.project}async function d(o,t){const e=await fetch(`${n}/projects/${encodeURIComponent(o)}`,{method:"PATCH",headers:s(!0),body:JSON.stringify(t)});if(!e.ok){const a=await e.text();throw new Error(`Erreur mise à jour projet (${e.status}) : ${a}`)}const r=await e.json();if(!r.project)throw new Error("Réponse mise à jour projet invalide");return r.project}async function h(o){const t=await fetch(`${n}/projects/${encodeURIComponent(o)}`,{method:"DELETE",headers:s()});if(!t.ok){const e=await t.text();throw new Error(`Erreur suppression projet (${t.status}) : ${e}`)}}async function f(o,t){const e=await fetch(`${n}/projects/${encodeURIComponent(o)}/responses/${encodeURIComponent(t)}`,{method:"DELETE",headers:s()});if(!e.ok){const r=await e.text();throw new Error(`Erreur suppression réponse (${e.status}) : ${r}`)}}async function $(o,t){const e=await fetch(`${n}/projects/${encodeURIComponent(o)}/responses/${encodeURIComponent(t)}/recover`,{method:"POST",headers:s()});if(!e.ok){const r=await e.text();throw new Error(`Erreur récupération réponse (${e.status}) : ${r}`)}}async function j(o,t){const e=`${n}/login`,r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,password:t})});if(!r.ok){const c=await r.text();throw new Error(`Erreur de connexion (${r.status}) [${e}] : ${c}`)}const a=await r.json();if(!a.token)throw new Error("Réponse de connexion invalide (pas de token)");return a.token}async function E(o){const t=await fetch(`${n}/public/submit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!t.ok){const e=await t.json().catch(()=>null);throw e?.closed?new Error("CLOSED"):new Error(e?.error??`Erreur enregistrement réponses (${t.status})`)}}async function l(o){const t=await fetch(`${n}/public/project-status/${encodeURIComponent(o)}`);if(!t.ok){const e=await t.text();throw new Error(`Erreur statut projet (${t.status}) : ${e}`)}return await t.json()}export{p as a,l as b,w as c,f as d,h as e,u as f,j as l,$ as r,E as s,d as u};
