import{j as e}from"./charts-DKGMT1ng.js";import{f as W,r as a}from"./react-DGBwUpAK.js";import{g as H,c as R}from"./Sidebar-DvhsLLju.js";import{b as O,s as Y}from"./api-DaFY7q8M.js";const G={"Site Web":"ce site web","Site E-Commerce":"ce site e-commerce","Application mobile":"cette application mobile","Application tablette":"cette application tablette",Logiciel:"ce logiciel",Autre:"ce produit"};function J(l){return l?G[l]??"ce produit":"ce produit"}function K(l,r){return l.map(s=>s.type==="likert"?{...s,textFr:s.textFr.replace(/@product_type/g,r)}:{...s,leftFr:s.leftFr.replace(/@product_type/g,r),rightFr:s.rightFr.replace(/@product_type/g,r)})}function X({q:l,index:r,value:s,onChange:d,showError:c}){return e.jsxs("div",{className:`py-5 ${r>0?"border-t border-slate-100":""}`,children:[e.jsxs("p",{className:`text-sm font-medium mb-3 ${c&&s===null?"text-danger-600":"text-slate-800"}`,children:[e.jsxs("span",{className:"text-slate-400 mr-2",children:[r+1,"."]}),l.textFr]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.scale.map(i=>e.jsx("button",{type:"button",onClick:()=>d(i.value),className:`px-3 py-1.5 text-xs rounded-full border transition-all cursor-pointer ${s===i.value?"bg-primary-600 text-white border-primary-600 shadow-sm":"bg-white text-slate-600 border-slate-300 hover:border-primary-300 hover:bg-primary-50"}`,children:i.labelFr},i.value))}),c&&s===null&&e.jsx("p",{className:"text-xs text-danger-500 mt-1.5",children:"Veuillez répondre à cette question."})]})}function Z({q:l,index:r,value:s,onChange:d,showError:c}){return e.jsxs("div",{className:`py-5 ${r>0?"border-t border-slate-100":""}`,children:[e.jsxs("p",{className:`text-sm font-medium mb-3 ${c&&s===null?"text-danger-600":"text-slate-800"}`,children:[e.jsxs("span",{className:"text-slate-400 mr-2",children:[r+1,"."]}),l.textFr]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.scale.map(i=>e.jsx("button",{type:"button",onClick:()=>d(i.value),className:`px-3 py-1.5 text-xs rounded-full border transition-all cursor-pointer ${s===i.value?"bg-primary-600 text-white border-primary-600 shadow-sm":"bg-white text-slate-600 border-slate-300 hover:border-primary-300 hover:bg-primary-50"}`,children:i.labelFr},i.value)),e.jsx("button",{type:"button",onClick:()=>d(0),className:`px-3 py-1.5 text-xs rounded-full border transition-all cursor-pointer ${s===0?"bg-slate-600 text-white border-slate-600 shadow-sm":"bg-white text-slate-400 border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:"Non applicable"})]}),c&&s===null&&e.jsx("p",{className:"text-xs text-danger-500 mt-1.5",children:"Veuillez répondre à cette question."})]})}function q({q:l,index:r,value:s,onChange:d,showError:c}){return e.jsxs("div",{className:`py-5 ${r>0?"border-t border-slate-100":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:`text-sm font-medium ${c&&s===null?"text-danger-600":"text-slate-600"}`,children:l.leftFr}),e.jsx("span",{className:`text-sm font-medium text-right ${c&&s===null?"text-danger-600":"text-slate-600"}`,children:l.rightFr})]}),e.jsx("div",{className:"flex items-center justify-center gap-1.5",children:l.scaleValues.map(i=>e.jsx("button",{type:"button",onClick:()=>d(i),className:`w-9 h-9 rounded-full border-2 text-xs font-medium transition-all cursor-pointer flex items-center justify-center ${s===i?"bg-primary-600 text-white border-primary-600 shadow-sm scale-110":"bg-white text-slate-500 border-slate-300 hover:border-primary-300 hover:bg-primary-50"}`,children:i},i))}),c&&s===null&&e.jsx("p",{className:"text-xs text-danger-500 mt-1.5 text-center",children:"Veuillez répondre à cette question."})]})}function ne(){const r=W().projectToken,[s,d]=a.useState({}),[c,i]=a.useState(!1),[N,v]=a.useState(!1),[w,h]=a.useState(null),[u,Q]=a.useState(!1),[x,T]=a.useState(null),[k,I]=a.useState(null),[S,_]=a.useState(null),[C,A]=a.useState(null),[f,M]=a.useState(null),[z,L]=a.useState(!1),[B,F]=a.useState(!0),[D,j]=a.useState(!1);a.useEffect(()=>{if(!r){F(!1),j(!0);return}let t=!1;return(async()=>{try{const n=await O(r);if(t)return;I(n.name),_(n.productType),A(n.productName),M(n.instructions);const V=R(n.questionnaireType);V?T(V):j(!0),n.status==="Fermé"&&L(!0)}catch{t||j(!0)}finally{t||F(!1)}})(),()=>{t=!0}},[r]);const m=a.useMemo(()=>x?H(x):null,[x]),p=a.useMemo(()=>{if(!m)return[];const t=J(S);return K(m.questions,t)},[m,S]),P=a.useMemo(()=>{if(!f)return null;const t=C||"";return f.replace(/@product_name/g,t)},[f,C]);if(B)return e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})});if(D||!m)return e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-brand border border-stone p-8 text-center max-w-sm",children:e.jsx("p",{className:"text-slate-700",children:"Questionnaire introuvable."})})});if(z)return e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white rounded-brand border border-stone p-8 text-center max-w-sm",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Questionnaire fermé"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Ce questionnaire n'est plus disponible."})]})});const b=p.length,g=p.filter(t=>s[t.id]!=null).length,E=g===b,y=(t,o)=>{d(n=>({...n,[t]:o}))},U=async t=>{if(t.preventDefault(),h(null),!E){Q(!0);const o=p.find(n=>s[n.id]==null);o&&document.getElementById(`q-${o.id}`)?.scrollIntoView({behavior:"smooth",block:"center"});return}if(!r){h("Ce lien de questionnaire est incomplet (token manquant).");return}try{v(!0),await Y({projectToken:r,answers:s}),i(!0)}catch(o){o instanceof Error&&o.message==="CLOSED"?L(!0):h(o instanceof Error?o.message:"Une erreur est survenue lors de l'enregistrement.")}finally{v(!1)}};if(c)return e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white rounded-brand border border-stone p-8 text-center max-w-sm",children:[e.jsx("div",{className:"w-14 h-14 bg-success-50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-7 h-7 text-success-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Merci pour votre participation"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Vos réponses ont été enregistrées avec succès."})]})});const $=x==="deep";return e.jsx("div",{className:"min-h-screen bg-cream py-8 px-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-brand border border-stone p-6 mb-6",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("p",{className:"text-xs font-bold uppercase tracking-[0.2em] text-flame",children:"We Love Users"}),e.jsx("span",{className:"brand-chip",children:"Team"})]}),e.jsx("h1",{className:"text-3xl font-serif text-ink",children:m.nameFr}),k&&e.jsx("p",{className:"text-sm text-primary-600 font-medium mt-1",children:k}),P?e.jsx("div",{className:"text-sm text-slate-600 mt-2 whitespace-pre-line",children:P}):e.jsx("div",{className:"text-sm text-slate-600 mt-2 [&_strong]:font-semibold [&_em]:italic",dangerouslySetInnerHTML:{__html:m.descriptionHtmlFr}})]}),e.jsxs("div",{className:"bg-white rounded-brand border border-stone p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"Progression"}),e.jsxs("span",{className:"text-xs font-medium text-slate-700",children:[g," / ",b]})]}),e.jsx("div",{className:"h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all duration-300",style:{width:`${b>0?g/b*100:0}%`}})})]}),e.jsxs("form",{onSubmit:U,className:"bg-white rounded-brand border border-stone p-6",children:[p.map((t,o)=>e.jsxs("div",{id:`q-${t.id}`,children:[t.type==="likert"&&!$&&e.jsx(X,{q:t,index:o,value:s[t.id]??null,onChange:n=>y(t.id,n),showError:u}),t.type==="likert"&&$&&e.jsx(Z,{q:t,index:o,value:s[t.id]??null,onChange:n=>y(t.id,n),showError:u}),t.type==="bipolar"&&e.jsx(q,{q:t,index:o,value:s[t.id]??null,onChange:n=>y(t.id,n),showError:u})]},t.id)),w&&e.jsx("div",{className:"text-sm text-danger-600 bg-danger-50 px-3 py-2 rounded-lg mt-4",children:w}),u&&!E&&e.jsx("div",{className:"text-sm text-warning-600 bg-warning-50 px-3 py-2 rounded-lg mt-4",children:"Veuillez répondre à toutes les questions avant d'envoyer."}),e.jsx("div",{className:"mt-6 pt-4 border-t border-slate-100",children:e.jsx("button",{type:"submit",disabled:N,className:"w-full py-3 px-4 bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 text-white text-sm font-medium rounded-lg transition-colors cursor-pointer disabled:cursor-not-allowed",children:N?"Envoi en cours...":"Envoyer mes réponses"})})]})]})})}export{ne as PublicQuestionnairePage};
