const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DashboardPage-BrqQca0W.js","assets/charts-DKGMT1ng.js","assets/react-DGBwUpAK.js","assets/api-DaFY7q8M.js","assets/Sidebar-xeID7eNb.js","assets/index-7Q5wAFn8.js","assets/index-e5K5IfMd.css","assets/AdministrationPage-qe_IYPTn.js","assets/BrandFontsPage-Ce6gQYRT.js","assets/BrandGuidelinesPage-neZASnmR.js","assets/BrandSlidesPage-p88saKc7.js","assets/DocumentTemplatesPage-BVIft2ni.js","assets/HomePage-BwOL9Jml.js","assets/LoginPage-J03aCH08.js","assets/WorkingMethodPage-DHBcvnm4.js"])))=>i.map(i=>d[i]);
import{_ as g}from"./index-7Q5wAFn8.js";import{j as e}from"./charts-DKGMT1ng.js";import{u as I,d as G,r as s,L as w,N as U,R as K,c as j,e as X}from"./react-DGBwUpAK.js";import{f as Y,a as R}from"./api-DaFY7q8M.js";let P={token:null,projects:null,inFlight:null};const q=new Set;function W(n){for(const a of q)a(n)}function Z(){return typeof window>"u"?null:window.localStorage.getItem("authToken")}function N(){const n=Z();return P.token!==n&&(P={token:n,projects:null,inFlight:null}),P}function V(){return N().projects}function Re(n){const a=N();a.projects=n,W(n)}async function z(){const n=N(),a=n.token;return n.projects?n.projects:(n.inFlight||(n.inFlight=Y().then(d=>{const p=N();return p.token===a&&(p.projects=d,W(d)),d}).finally(()=>{const d=N();d.token===a&&(d.inFlight=null)})),n.inFlight)}function J(){P={token:null,projects:null,inFlight:null},W(null)}function ee(n){return q.add(n),()=>{q.delete(n)}}function te({state:n}){return n==="idle"?null:e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[n==="syncing"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-[1.5px] border-primary-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-slate-400",children:"Synchronisation..."})]}),n==="saved"&&e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3.5 h-3.5 text-success-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-slate-400",children:"Synchronisé"})]}),n==="error"&&e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3.5 h-3.5 text-danger-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),e.jsx("span",{className:"text-danger-500",children:"Erreur de sync"})]})]})}const ne=e.jsx("svg",{className:"h-[18px] w-[18px] shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.7,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-4 0a1 1 0 01-1-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 01-1 1h-2z"})}),se=e.jsx("svg",{className:"h-[18px] w-[18px] shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.7,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),ae=e.jsx("svg",{className:"h-[18px] w-[18px] shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.7,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),re=e.jsx("svg",{className:"h-[18px] w-[18px] shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.7,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),oe=e.jsx("svg",{className:"h-[18px] w-[18px] shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.7,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),le=e.jsxs("svg",{className:"h-[18px] w-[18px] shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.7,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),ie=e.jsx("svg",{className:"h-[18px] w-[18px] shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.7,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),ce=[{to:"/modeles-documents#cadrage",label:"Cadrage"},{to:"/modeles-documents#terrain",label:"Terrain"},{to:"/modeles-documents#analyse",label:"Analyse"},{to:"/modeles-documents#restitution",label:"Restitution"},{to:"/modeles-documents#operationnel",label:"Opérationnel"}],B=[{to:"/",label:"Accueil",end:!0,icon:ne},{to:"/notre-facon-de-travailler",label:"Notre façon de travailler",icon:se},{to:"/questionnaires",label:"Questionnaires UX",icon:ae},{to:"/charte-graphique",label:"Charte graphique",icon:re,children:[{to:"/charte-graphique/fonts",label:"Fonts"},{to:"/charte-graphique/slides",label:"Slides"},{to:"/charte-graphique",label:"Design system",end:!0}]},{to:"/modeles-documents",label:"Modèles de documents",icon:oe,children:ce},{to:"/administration",label:"Administration",separatorBefore:!0,icon:le}],E="__sans_dossier__";function F(n){return n.to==="/questionnaires"||!!n.children?.length}function de(n){return B.find(a=>F(a)&&(n===a.to||n.startsWith(`${a.to}/`)))}function ue(n){return n.to==="/charte-graphique"?"/charte-graphique/fonts":n.to==="/questionnaires"?"/questionnaires":n.to}function he({children:n,onLogout:a,fullBleed:d=!1,headerSyncState:p}){const l=I(),m=G(),i=de(l.pathname),[v,k]=s.useState(i?.to??null),_=V(),[y,r]=s.useState(()=>_??[]),[x,f]=s.useState(!_),[u,H]=s.useState(new Set),D=t=>t.end?l.pathname===t.to:l.pathname===t.to||l.pathname.startsWith(`${t.to}/`),Q=t=>{const[o,h]=t.to.split("#");return h?l.pathname===o&&l.hash===`#${h}`:t.end?l.pathname===o:l.pathname===o||l.pathname.startsWith(`${o}/`)};s.useEffect(()=>{k(i?.to??null)},[l.pathname,i?.to]),s.useEffect(()=>{let t=!0;const o=V();o?(r(o),f(!1)):f(!0);const h=ee(c=>{t&&(r(c??[]),f(!1))});return o||z().catch(c=>{console.error("Load questionnaires list failed:",c),t&&f(!1)}),()=>{t=!1,h()}},[]);const L=B.find(t=>t.to===v&&F(t)),$=!!L?.children||L?.to==="/questionnaires",A=t=>l.pathname==="/questionnaires"&&(l.hash===`#project/${t}`||l.hash.startsWith(`#project/${t}/`)),{folders:M,ungrouped:S}=s.useMemo(()=>{const t=new Map,o=[];for(const c of y){const b=c.folder?.trim();b?(t.has(b)||t.set(b,[]),t.get(b).push(c)):o.push(c)}return{folders:Array.from(t.entries()).sort(([c],[b])=>c.localeCompare(b,"fr")),ungrouped:o}},[y]),O=t=>{H(o=>{const h=new Set(o);return h.has(t)?h.delete(t):h.add(t),h})};return e.jsxs("div",{className:"h-screen bg-cream text-ink flex flex-col",children:[e.jsx("header",{className:"w-full bg-cream",children:e.jsxs("div",{className:"flex w-full items-center justify-between px-6 py-4",children:[e.jsxs(w,{to:"/",className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-serif text-2xl leading-none text-ink md:text-3xl",children:"We Love Users"}),e.jsx("span",{className:"brand-chip",children:"TEAM"})]}),p&&e.jsx(te,{state:p})]})}),e.jsxs("div",{className:"min-h-0 flex flex-1",children:[e.jsx("aside",{className:"w-72 shrink-0 px-3 pb-3",children:e.jsxs("div",{className:"relative h-full overflow-hidden rounded-brand border border-stone bg-white shadow-sm flex flex-col",children:[e.jsxs("div",{className:`absolute inset-0 flex flex-col transition-transform duration-300 ease-out ${$?"-translate-x-full":"translate-x-0"}`,children:[e.jsx("nav",{className:"flex-1 overflow-y-auto px-3 py-4",children:e.jsx("ul",{className:"space-y-1",children:B.map(t=>e.jsx("li",{className:t.separatorBefore?"nav-item-separator":"",children:F(t)?e.jsxs("button",{type:"button","aria-expanded":v===t.to,onClick:()=>{k(t.to),m(ue(t))},className:`nav-link nav-link-toggle cursor-pointer ${D(t)?"active":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2.5",children:[t.icon,e.jsx("span",{children:t.label})]}),e.jsx("svg",{className:`h-4 w-4 shrink-0 ${D(t)?"text-flame":"text-taupe"}`,viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M7.22 4.22a.75.75 0 0 1 1.06 0l5.25 5.25a.75.75 0 0 1 0 1.06l-5.25 5.25a.75.75 0 1 1-1.06-1.06L11.94 10 7.22 5.28a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"})})]}):e.jsx(U,{to:t.to,end:t.end,onClick:()=>k(null),className:({isActive:o})=>`nav-link ${o?"active":""}`,children:e.jsxs("span",{className:"flex items-center gap-2.5",children:[t.icon,e.jsx("span",{children:t.label})]})})},t.to))})}),e.jsx("div",{className:"border-t border-stone px-3 py-3",children:e.jsxs("button",{type:"button",onClick:a,className:"nav-link flex w-full items-center gap-2.5 text-left cursor-pointer",children:[ie,e.jsx("span",{children:"Déconnexion"})]})})]}),e.jsxs("div",{className:`absolute inset-0 overflow-y-auto border-l border-stone/70 bg-white/60 px-4 py-4 transition-transform duration-300 ease-out ${$?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("button",{type:"button",onClick:()=>k(null),className:"btn-secondary-sm mb-3 cursor-pointer",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})}),e.jsx("span",{children:"Retour"})]}),e.jsx("p",{className:"mb-3 text-[11px] font-medium uppercase tracking-[0.14em] text-flame",children:L?.label}),L?.to==="/questionnaires"?e.jsxs("nav",{children:[e.jsxs(w,{to:"/questionnaires#new",className:"btn-primary-sm mb-4 flex w-full cursor-pointer items-center justify-center gap-1.5",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Nouveau projet"]}),e.jsx("ul",{className:"space-y-1",children:x?e.jsx("li",{children:e.jsx("span",{className:"subnav-link opacity-70",children:"Chargement..."})}):e.jsxs(e.Fragment,{children:[M.map(([t,o])=>{const h=u.has(t);return e.jsxs("li",{className:"pt-1",children:[e.jsxs("button",{type:"button",onClick:()=>O(t),className:"flex w-full items-center gap-1.5 rounded px-2 py-1.5 text-left text-xs font-semibold uppercase tracking-wide text-taupe transition-colors hover:bg-wash hover:text-ink",children:[e.jsx("svg",{className:`h-3 w-3 shrink-0 transition-transform ${h?"":"rotate-90"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.25,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}),e.jsx("svg",{className:"h-3.5 w-3.5 shrink-0 text-taupe/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),e.jsx("span",{className:"truncate",children:t}),e.jsx("span",{className:"ml-auto text-[10px] font-normal tracking-normal text-taupe",children:o.length})]}),!h&&e.jsx("ul",{className:"ml-1 mt-1 space-y-1",children:o.map(c=>e.jsx("li",{children:e.jsx(w,{to:`/questionnaires#project/${c.id}`,className:`subnav-link ${A(c.id)?"active":""}`,children:c.name||"(Sans titre)"})},c.id))})]},t)}),M.length>0&&S.length>0&&e.jsxs("li",{className:"pt-1",children:[e.jsxs("button",{type:"button",onClick:()=>O(E),className:"flex w-full items-center gap-1.5 rounded px-2 py-1.5 text-left text-xs font-semibold uppercase tracking-wide text-taupe transition-colors hover:bg-wash hover:text-ink",children:[e.jsx("svg",{className:`h-3 w-3 shrink-0 transition-transform ${u.has(E)?"":"rotate-90"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.25,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}),e.jsx("span",{className:"truncate",children:"Sans dossier"}),e.jsx("span",{className:"ml-auto text-[10px] font-normal tracking-normal text-taupe",children:S.length})]}),!u.has(E)&&e.jsx("ul",{className:"ml-1 mt-1 space-y-1",children:S.map(t=>e.jsx("li",{children:e.jsx(w,{to:`/questionnaires#project/${t.id}`,className:`subnav-link ${A(t.id)?"active":""}`,children:t.name||"(Sans titre)"})},t.id))})]}),M.length===0&&S.map(t=>e.jsx("li",{children:e.jsx(w,{to:`/questionnaires#project/${t.id}`,className:`subnav-link ${A(t.id)?"active":""}`,children:t.name||"(Sans titre)"})},t.id))]})}),!x&&y.length===0&&e.jsx("p",{className:"px-3 py-2 text-xs text-taupe",children:"Aucun projet"})]}):e.jsx("nav",{children:e.jsx("ul",{className:"space-y-1.5",children:L?.children?.map(t=>e.jsx("li",{children:e.jsx(w,{to:t.to,className:`subnav-link ${Q(t)?"active":""}`,children:t.label})},t.to))})})]})]})}),e.jsx("main",{className:d?"min-w-0 flex-1 min-h-0 overflow-hidden":"min-w-0 flex-1 min-h-0 overflow-y-auto px-6 py-10 md:px-8 md:py-12",children:n})]})]})}const pe=6e4;let C={token:null,byProject:new Map};function xe(){return typeof window>"u"?null:window.localStorage.getItem("authToken")}function T(){const n=xe();return C.token!==n&&(C={token:n,byProject:new Map}),C.byProject}function me(){C={token:null,byProject:new Map}}function Ee(){const[n,a]=s.useState([]),[d,p]=s.useState(!1),[l,m]=s.useState(!1),i=s.useRef(null),v=s.useCallback(async r=>{i.current=r;const x=T(),f=x.get(r);if(f){if(a(f.responses),p(!1),Date.now()-f.fetchedAt<pe){m(!1);return}m(!0);try{const u=await R(r);i.current===r&&(a(u),x.set(r,{responses:u,fetchedAt:Date.now()}))}catch(u){console.error("Background refresh failed:",u)}finally{i.current===r&&m(!1)}}else{a([]),p(!0),m(!1);try{const u=await R(r);i.current===r&&(a(u),x.set(r,{responses:u,fetchedAt:Date.now()}))}catch(u){console.error("Load responses failed:",u),i.current===r&&a([])}finally{i.current===r&&p(!1)}}},[]),k=s.useCallback(async()=>{const r=i.current;if(r){m(!0);try{const x=await R(r);i.current===r&&(a(x),T().set(r,{responses:x,fetchedAt:Date.now()}))}catch(x){console.error("Refresh responses failed:",x)}finally{i.current===r&&m(!1)}}},[]),_=s.useCallback(r=>{T().delete(r)},[]),y=s.useCallback(()=>{i.current=null,a([]),p(!1),m(!1)},[]);return{responses:n,loading:d,backgroundRefreshing:l,loadResponses:v,refreshCurrent:k,invalidate:_,clear:y}}const fe=s.lazy(async()=>({default:(await g(()=>import("./DashboardPage-BrqQca0W.js"),__vite__mapDeps([0,1,2,3,4,5,6]))).DashboardPage})),je=s.lazy(async()=>({default:(await g(()=>import("./AdministrationPage-qe_IYPTn.js"),__vite__mapDeps([7,1,2]))).AdministrationPage})),ge=s.lazy(async()=>({default:(await g(()=>import("./BrandFontsPage-Ce6gQYRT.js"),__vite__mapDeps([8,1,2]))).BrandFontsPage})),ke=s.lazy(async()=>({default:(await g(()=>import("./BrandGuidelinesPage-neZASnmR.js"),__vite__mapDeps([9,1,2]))).BrandGuidelinesPage})),ve=s.lazy(async()=>({default:(await g(()=>import("./BrandSlidesPage-p88saKc7.js"),__vite__mapDeps([10,1,2]))).BrandSlidesPage})),be=s.lazy(async()=>({default:(await g(()=>import("./DocumentTemplatesPage-BVIft2ni.js"),__vite__mapDeps([11,1,2]))).DocumentTemplatesPage})),we=s.lazy(async()=>({default:(await g(()=>import("./HomePage-BwOL9Jml.js"),__vite__mapDeps([12,1,2]))).HomePage})),ye=s.lazy(async()=>({default:(await g(()=>import("./LoginPage-J03aCH08.js"),__vite__mapDeps([13,1,2,3]))).LoginPage})),Le=s.lazy(async()=>({default:(await g(()=>import("./WorkingMethodPage-DHBcvnm4.js"),__vite__mapDeps([14,1,2]))).WorkingMethodPage}));function Ne(){return e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})})}function _e(){return e.jsx("div",{className:"flex items-center justify-center h-full py-24",children:e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})})}function Se(){const n=I(),[a,d]=s.useState(()=>!!localStorage.getItem("authToken")),[p,l]=s.useState("idle");s.useEffect(()=>{a&&z().catch(k=>{console.error("Preload projects failed:",k)})},[a]);const m=()=>{d(!0)},i=()=>{J(),me(),localStorage.removeItem("authToken"),d(!1)};if(!a)return e.jsx(s.Suspense,{fallback:e.jsx(Ne,{}),children:e.jsx(ye,{onLogin:m,title:"Connexion requise",subtitle:"Connectez-vous pour accéder à l'espace Team."})});const v=n.pathname==="/questionnaires";return e.jsx(he,{onLogout:i,fullBleed:v,headerSyncState:v?p:void 0,children:e.jsx(s.Suspense,{fallback:e.jsx(_e,{}),children:e.jsxs(K,{children:[e.jsx(j,{path:"/",element:e.jsx(we,{})}),e.jsx(j,{path:"/notre-facon-de-travailler",element:e.jsx(Le,{})}),e.jsx(j,{path:"/charte-graphique",element:e.jsx(ke,{})}),e.jsx(j,{path:"/charte-graphique/slides",element:e.jsx(ve,{})}),e.jsx(j,{path:"/charte-graphique/fonts",element:e.jsx(ge,{})}),e.jsx(j,{path:"/modeles-documents",element:e.jsx(be,{})}),e.jsx(j,{path:"/questionnaires",element:e.jsx(fe,{onSyncStateChange:l})}),e.jsx(j,{path:"/administration",element:e.jsx(je,{})}),e.jsx(j,{path:"*",element:e.jsx(X,{to:"/",replace:!0})})]})})})}const Te=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"}));export{Te as A,z as e,V as g,Re as s,Ee as u};
