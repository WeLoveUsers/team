import{j as e,R as qe,C as se,a as Be,P as Se,L as $e,i as Ve,p as ae,b as ne,B as Qe,c as Te,d as de,e as ke,S as ze}from"./charts-nuwTBMFx.js";import{r as d,u as We,d as Xe}from"./react-DGBwUpAK.js";import{u as Pe,h as Ke,i as Ye,j as Ze,k as Je}from"./api-DYJm7ZOt.js";import{c as re,D as xe,g as et}from"./Sidebar-xeID7eNb.js";import{D as Ae}from"./DeleteConfirmModal-IVzid9wc.js";import{u as tt,s as oe,g as st,e as at}from"./App-BenPhVbi.js";import"./index-DJao75Ul.js";function nt({children:t}){return e.jsx("div",{className:"h-full min-h-0 bg-cream flex",children:e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto",children:e.jsx("div",{className:"mx-auto h-full w-full max-w-5xl",children:t})})})}function Ce(t){if(navigator.clipboard?.writeText)return navigator.clipboard.writeText(t);const s=document.createElement("textarea");return s.value=t,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),Promise.resolve()}const rt=[{value:"SUS",label:"SUS"},{value:"DEEP",label:"DEEP"},{value:"UMUX",label:"UMUX"},{value:"UMUX (Lite)",label:"UMUX (Lite)"},{value:"UEQ",label:"UEQ"},{value:"UEQ-S",label:"UEQ-S"},{value:"AttrakDiff",label:"AttrakDiff"},{value:"AttrakDiff (abrégé)",label:"AttrakDiff (abrégé)"}],lt=[{value:"Ouvert",label:"Ouvert"},{value:"Fermé",label:"Fermé"}],it=[{value:"Site Web",label:"Site Web"},{value:"Site E-Commerce",label:"Site E-Commerce"},{value:"Application mobile",label:"Application mobile"},{value:"Application tablette",label:"Application tablette"},{value:"Logiciel",label:"Logiciel"},{value:"Autre",label:"Autre"}];function Ee({project:t,hasResponses:s,existingFolders:n,onSaved:a,onCancel:r}){const[l,o]=d.useState(""),[u,p]=d.useState(""),[c,m]=d.useState("Ouvert"),[h,i]=d.useState(""),[g,P]=d.useState(""),[v,L]=d.useState(""),[w,D]=d.useState(""),[R,I]=d.useState(""),[Q,C]=d.useState(!1),[T,E]=d.useState(null),[G,B]=d.useState(!1);d.useEffect(()=>{t?(o(t.name??""),p(t.questionnaireType??""),m(t.status??"Ouvert"),i(t.publicToken??""),P(t.folder??""),L(t.productType??""),D(t.productName??""),I(t.instructions??"")):(o(""),p(""),m("Ouvert"),i(""),P(""),L(""),D(""),I("")),E(null)},[t]),d.useEffect(()=>{if(t)return;const x=re(u);x&&xe[x]?I(xe[x]):I("")},[u,t]);const F=()=>{if(h.trim())return h.trim();let x;if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")x=crypto.randomUUID();else{const U=new Uint8Array(16);crypto.getRandomValues(U),x=Array.from(U,Y=>Y.toString(16).padStart(2,"0")).join("")}const b=x.replace(/-/g,"").slice(0,12);return i(b),b},y=async x=>{x.preventDefault(),E(null),C(!0);try{if(!l.trim())throw new Error("Le nom du projet est requis.");if(!v)throw new Error("Le type de produit est requis.");if(!w.trim())throw new Error("Le nom du produit est requis.");const b={name:l.trim(),questionnaireType:u||null,status:c||null,publicToken:F(),folder:g.trim()||null,productType:v||null,productName:w.trim(),instructions:R||null},U=t?await Pe(t.id,b):await Ke(b);a(U)}catch(b){E(b instanceof Error?b.message:"Impossible d'enregistrer le projet")}finally{C(!1)}},f=h?`${window.location.origin}/p/${h}`:null,q=d.useMemo(()=>n.filter(x=>x.trim().length>0),[n]);return e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-name",className:"block text-sm font-medium text-ink mb-1",children:"Nom du projet"}),e.jsx("input",{id:"pf-name",type:"text",value:l,onChange:x=>o(x.target.value),required:!0,className:"field-input",placeholder:"Mon projet"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-product-name",className:"block text-sm font-medium text-ink mb-1",children:"Nom du produit évalué"}),e.jsx("input",{id:"pf-product-name",type:"text",value:w,onChange:x=>D(x.target.value),required:!0,className:"field-input",placeholder:"Ex : Google Maps, Mon application..."}),e.jsxs("p",{className:"text-xs text-taupe mt-1",children:["Utilisé dans les instructions et remplace ",e.jsx("code",{className:"bg-cream px-1 rounded border border-stone text-graphite",children:"@product_name"}),"."]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-type",className:"block text-sm font-medium text-ink mb-1",children:"Questionnaire"}),e.jsxs("select",{id:"pf-type",value:u,onChange:x=>p(x.target.value),disabled:s,required:!0,className:"field-select disabled:opacity-60",children:[e.jsx("option",{value:"",children:"Choisir..."}),rt.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]}),s&&e.jsx("p",{className:"text-xs text-taupe mt-1",children:"Non modifiable (réponses existantes)"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-product-type",className:"block text-sm font-medium text-ink mb-1",children:"Type de produit"}),e.jsxs("select",{id:"pf-product-type",value:v,onChange:x=>L(x.target.value),required:!0,className:"field-select",children:[e.jsx("option",{value:"",children:"Choisir..."}),it.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-status",className:"block text-sm font-medium text-ink mb-1",children:"Statut"}),e.jsx("select",{id:"pf-status",value:c,onChange:x=>m(x.target.value),required:!0,className:"field-select",children:lt.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-folder",className:"block text-sm font-medium text-ink mb-1",children:"Dossier"}),e.jsx("input",{id:"pf-folder",type:"text",value:g,onChange:x=>P(x.target.value),list:"pf-folder-suggestions",className:"field-input",placeholder:"Aucun dossier"}),q.length>0&&e.jsx("datalist",{id:"pf-folder-suggestions",children:q.map(x=>e.jsx("option",{value:x},x))}),e.jsx("p",{className:"text-xs text-taupe mt-1",children:"Saisissez un nom de dossier ou choisissez un existant. Laissez vide pour aucun dossier."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-instructions",className:"block text-sm font-medium text-ink mb-1",children:"Instructions aux répondants"}),e.jsx("textarea",{id:"pf-instructions",value:R,onChange:x=>I(x.target.value),rows:5,className:"field-textarea",placeholder:"Instructions affichées aux répondants en haut du questionnaire..."}),e.jsxs("p",{className:"text-xs text-taupe mt-1",children:[e.jsx("code",{className:"bg-cream px-1 rounded border border-stone text-graphite",children:"@product_name"})," sera remplacé par le nom du produit évalué."]}),w.trim()&&R.includes("@product_name")&&e.jsxs("div",{className:"mt-2 p-3 bg-cream rounded-brand border border-stone",children:[e.jsx("p",{className:"text-xs font-medium text-taupe mb-1",children:"Aperçu pour le répondant :"}),e.jsx("p",{className:"text-sm text-ink whitespace-pre-line",children:R.replace(/@product_name/g,w.trim())})]})]}),f&&e.jsxs("div",{className:"bg-cream rounded-brand border border-stone p-3",children:[e.jsx("p",{className:"text-xs font-medium text-taupe mb-1",children:"URL publique du questionnaire"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-xs text-flame bg-wash px-2 py-1 rounded flex-1 truncate",children:f}),e.jsx("button",{type:"button",onClick:()=>{Ce(f).then(()=>{B(!0),setTimeout(()=>B(!1),2e3)})},className:"shrink-0 text-xs text-flame hover:text-ink font-medium cursor-pointer transition-colors",children:G?"Copié !":"Copier"})]})]}),T&&e.jsx("div",{className:"text-sm text-berry bg-danger-50 px-3 py-2 rounded-lg",children:T}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:Q,className:"btn-primary-sm disabled:opacity-60 disabled:cursor-not-allowed cursor-pointer",children:Q?"Enregistrement...":t?"Mettre à jour":"Créer le projet"}),r&&e.jsx("button",{type:"button",onClick:r,className:"btn-secondary-sm cursor-pointer",children:"Annuler"})]})]})}const k={mean:0,sd:0,ci90:[0,0],ci95:[0,0],ci99:[0,0]};function M(t,s=2){const n=10**s;return Math.round(t*n)/n}function z(t){return t.length===0?0:t.reduce((s,n)=>s+n,0)/t.length}function ot(t,s){if(t.length<=1)return 0;const n=s??z(t),a=t.reduce((r,l)=>r+(l-n)**2,0)/(t.length-1);return Math.sqrt(a)}function te(t,s){const n=t<.5?t:1-t,a=t<.5?-1:1,r=Math.log(1/(n*n)),l=2.515517,o=.802853,u=.010328,p=1.432788,c=.189269,m=.001308,h=Math.sqrt(r),i=a*(h-(l+o*h+u*r)/(1+p*h+c*r+m*h*r));if(s>=1e3)return i;const g=(i**3+i)/(4*s),P=(5*i**5+16*i**3+3*i)/(96*s*s),v=(3*i**7+19*i**5+17*i**3-15*i)/(384*s**3),L=(79*i**9+776*i**7+1482*i**5-1920*i**3-945*i)/(92160*s**4);return i+g+P+v+L}function ce(t){return te(t,1e4)}function ct(t,s,n){const a=1-s/n;return t/Math.sqrt(s)*Math.sqrt(a)}function V(t,s,n,a,r){const l=ct(s,n,a),o=r*l;return[t-o,t+o]}function j(t,s){if(t.length===0||s===0)return{...k};const n=z(t);if(s<=1||t.length<=1){const p=M(n);return{mean:p,sd:0,ci90:[p,p],ci95:[p,p],ci99:[p,p]}}const a=ot(t,n),r=1e100;let l,o,u;if(s>60){const p=ce(.95),c=ce(1-(1-.95)/2),m=ce(1-(1-.99)/2);l=V(n,a,s,r,p),o=V(n,a,s,r,c),u=V(n,a,s,r,m)}else{const p=s-1,c=te(1-(1-.9)/2,p),m=te(1-(1-.95)/2,p),h=te(1-(1-.99)/2,p);l=V(n,a,s,r,c),o=V(n,a,s,r,m),u=V(n,a,s,r,h)}return{mean:M(n),sd:M(a),ci90:[M(l[0]),M(l[1])],ci95:[M(o[0]),M(o[1])],ci99:[M(u[0]),M(u[1])]}}function we(t){const s=(t.Q1??0)+(t.Q3??0)+(t.Q5??0)+(t.Q7??0)+(t.Q9??0),n=4-(t.Q2??0)+(4-(t.Q4??0))+(4-(t.Q6??0))+(4-(t.Q8??0))+(4-(t.Q10??0));return 2.5*(s+n)}function Le(t){return t>=84.1?"A+":t>=80.8?"A":t>=78.9?"A-":t>=77.2?"B+":t>=74.1?"B":t>=72.6?"B-":t>=71.1?"C+":t>=65?"C":t>=62.7?"C-":t>=51.7?"D":"F"}function dt(t){const s=[];for(const a of t)["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10"].some(l=>typeof a[l]!="number"||Number.isNaN(a[l]))||s.push(we(a));if(s.length===0)return null;const n=j(s,s.length);return{...n,n:s.length,grade:Le(n.mean)}}const ut={G1:["Q1","Q2","Q3","Q4"],G2:["Q5","Q6","Q7"],G3:["Q8","Q9","Q10"],G4:["Q11","Q12","Q13"],G5:["Q14","Q15","Q16"],G6:["Q17","Q18","Q19"]},Ie={G1:"Contenu percu",G2:"Structure / AI",G3:"Navigation",G4:"Effort cognitif",G5:"Cohérence mise en page",G6:"Guidage visuel"};function xt(t){if(t.length===0)return null;const s={G1:[],G2:[],G3:[],G4:[],G5:[],G6:[]};for(const a of t)for(const[r,l]of Object.entries(ut))for(const o of l){const u=a[o];typeof u=="number"&&u>0&&s[r].push(u)}const n=t.length;return{n,G1:s.G1.length>0?j(s.G1,n):{...k},G2:s.G2.length>0?j(s.G2,n):{...k},G3:s.G3.length>0?j(s.G3,n):{...k},G4:s.G4.length>0?j(s.G4,n):{...k},G5:s.G5.length>0?j(s.G5,n):{...k},G6:s.G6.length>0?j(s.G6,n):{...k}}}function De(t){return 100*((t.Q1??0)+(t.Q2??0)+(t.Q3??0)+(t.Q4??0))/24}function mt(t){if(t.length===0)return null;const s=t.map(De);return{...j(s,s.length),n:s.length}}function Re(t){return 100*((t.Q1??0)+(t.Q3??0))/12}function pt(t){if(t.length===0)return null;const s=t.map(Re),n=t.map(l=>100/6*(l.Q3??0)),a=t.map(l=>100/6*(l.Q1??0)),r=t.length;return{n:r,global:j(s,r),usability:j(n,r),usefulness:j(a,r)}}const ht={ATT:["Q1","Q12","Q14","Q16","Q24","Q25"],PERSP:["Q2","Q4","Q13","Q21"],EFF:["Q9","Q20","Q22","Q23"],DEP:["Q8","Q11","Q17","Q19"],STIM:["Q5","Q6","Q7","Q18"],NOV:["Q3","Q10","Q15","Q26"]},ft={Q1:"right",Q2:"right",Q3:"left",Q4:"left",Q5:"left",Q6:"right",Q7:"right",Q8:"right",Q9:"left",Q10:"left",Q11:"right",Q12:"left",Q13:"right",Q14:"right",Q15:"right",Q16:"right",Q17:"left",Q18:"left",Q19:"left",Q20:"right",Q21:"left",Q22:"right",Q23:"left",Q24:"left",Q25:"left",Q26:"right"};function gt(t,s){if(!Number.isFinite(t)||t<1||t>7)return null;const n=ft[s];return n?n==="right"?t-4:4-t:null}function bt(t){if(t.length===0)return null;const s={ATT:[],PERSP:[],EFF:[],DEP:[],STIM:[],NOV:[]},n=[];for(const r of t){const l=[];for(const[o,u]of Object.entries(ht)){const p=[];for(const c of u){const m=r[c];if(typeof m!="number")continue;const h=gt(m,c);h!=null&&(p.push(h),l.push(h))}p.length>0&&s[o].push(z(p))}l.length>0&&n.push(z(l))}return{n:n.length,ATT:s.ATT.length>0?j(s.ATT,s.ATT.length):{...k},PERSP:s.PERSP.length>0?j(s.PERSP,s.PERSP.length):{...k},EFF:s.EFF.length>0?j(s.EFF,s.EFF.length):{...k},DEP:s.DEP.length>0?j(s.DEP,s.DEP.length):{...k},STIM:s.STIM.length>0?j(s.STIM,s.STIM.length):{...k},NOV:s.NOV.length>0?j(s.NOV,s.NOV.length):{...k},GLOBAL:n.length>0?j(n,n.length):{...k}}}const J={ATT:"Attractivité",PERSP:"Clarté",EFF:"Efficacité",DEP:"Contrôlabilité",STIM:"Stimulation",NOV:"Nouveauté",GLOBAL:"Score global"},jt={PRAG:["Q1","Q2","Q3","Q4"],HED:["Q5","Q6","Q7","Q8"]},Nt={Q1:"right",Q2:"right",Q3:"right",Q4:"right",Q5:"right",Q6:"right",Q7:"right",Q8:"right"};function yt(t,s){if(!Number.isFinite(t)||t<1||t>7)return null;const n=Nt[s];return n?n==="right"?t-4:4-t:null}function vt(t){if(t.length===0)return null;const s={PRAG:[],HED:[]},n=[];for(const r of t){const l=[];for(const[o,u]of Object.entries(jt)){const p=[];for(const c of u){const m=r[c];if(typeof m!="number")continue;const h=yt(m,c);h!=null&&(p.push(h),l.push(h))}p.length>0&&s[o].push(z(p))}l.length>0&&n.push(z(l))}return{n:n.length,PRAG:s.PRAG.length>0?j(s.PRAG,s.PRAG.length):{...k},HED:s.HED.length>0?j(s.HED,s.HED.length):{...k},GLOBAL:n.length>0?j(n,n.length):{...k}}}const ee={PRAG:"Qualité pragmatique",HED:"Qualité hédonique",GLOBAL:"Score global"},X={QP:["QP1","QP2","QP3","QP4","QP5","QP6","QP7"],QHS:["QHS1","QHS2","QHS3","QHS4","QHS5","QHS6","QHS7"],QHI:["QHI1","QHI2","QHI3","QHI4","QHI5","QHI6","QHI7"],ATT:["ATT1","ATT2","ATT3","ATT4","ATT5","ATT6","ATT7"]},K={QP:["QP2","QP3","QP5","QP6"],QHS:["QHS2","QHS5"],QHI:["QHI3","QHI4"],ATT:["ATT2","ATT5"]};function me(t,s=!1){if(t.length===0)return null;const n=s?K:X,a={QP:[],QHS:[],QHI:[],ATT:[],QH:[]};for(const l of t){for(const o of n.QP)a.QP.push(l[o]??0);for(const o of n.QHS)a.QHS.push(l[o]??0);for(const o of n.QHI)a.QHI.push(l[o]??0);for(const o of n.ATT)a.ATT.push(l[o]??0);for(const o of n.QHS)a.QH.push(l[o]??0);for(const o of n.QHI)a.QH.push(l[o]??0)}const r=t.length;return{n:r,QP:j(a.QP,r),QHS:j(a.QHS,r),QHI:j(a.QHI,r),ATT:j(a.ATT,r),QH:j(a.QH,r)}}const St={QP:"Qualité Pragmatique",QHS:"Qualité Hédonique - Stimulation",QHI:"Qualité Hédonique - Identification",ATT:"Attractivité",QH:"Qualité Hédonique"};function pe(t,s=!1){const n=s?[...K.QP,...K.QHS,...K.QHI,...K.ATT]:[...X.QP,...X.QHS,...X.QHI,...X.ATT],a={};if(t.length===0){for(const r of n)a[r]=0;return a}for(const r of n){const l=t.reduce((o,u)=>o+(u[r]??0),0);a[r]=M(l/t.length)}return a}function Qt(t){const n=t.properties?.Payload;if(!n?.rich_text)return null;const a=n.rich_text.map(r=>r.plain_text||"").join("");if(!a)return null;try{return JSON.parse(a)}catch{return null}}function Tt(t,s){const n=re(t);if(!n)return null;switch(n){case"sus":{const a=we(s);return{score:Math.round(a*100)/100,label:Le(a)}}case"umux":{const a=De(s);return{score:Math.round(a*100)/100}}case"umux_lite":{const a=Re(s);return{score:Math.round(a*100)/100}}default:return null}}const kt={"A+":"bg-emerald-100 text-emerald-800",A:"bg-emerald-100 text-emerald-700","A-":"bg-green-100 text-green-700","B+":"bg-lime-100 text-lime-700",B:"bg-lime-100 text-lime-700","B-":"bg-yellow-100 text-yellow-700","C+":"bg-amber-100 text-amber-700",C:"bg-amber-100 text-amber-700","C-":"bg-orange-100 text-orange-700",D:"bg-red-100 text-red-700",F:"bg-red-200 text-red-800"};function Pt({project:t,responses:s,onResponsesChanged:n}){const[a,r]=d.useState(null),[l,o]=d.useState(null),u=async i=>{r(i);try{await Ze(t.id,i),n()}catch(g){console.error(g)}finally{r(null)}},p=async i=>{r(i);try{await Ye(t.id,i),n()}catch(g){console.error(g)}finally{r(null)}},c=s.filter(i=>!i.archived),m=s.filter(i=>i.archived),h=async()=>{if(!l)return;await u(l.id),o(null)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-ink",children:"Réponses"}),e.jsxs("span",{className:"text-xs text-taupe bg-slate-100 px-2 py-0.5 rounded-full",children:[c.length," active",c.length>1?"s":""]})]}),s.length===0?e.jsx("p",{className:"text-sm text-taupe py-4",children:"Aucune réponse pour le moment."}):e.jsx("div",{className:"border border-stone rounded-brand overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-cream border-b border-stone",children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-taupe uppercase",children:"#"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-taupe uppercase",children:"Score"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-taupe uppercase",children:"Note"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-taupe uppercase",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-taupe uppercase",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100",children:[c.map((i,g)=>{const P=Qt(i),v=P?.answers?Tt(t.questionnaireType,P.answers):null;return e.jsxs("tr",{className:"hover:bg-cream/50",children:[e.jsx("td",{className:"px-3 py-2 text-taupe",children:g+1}),e.jsx("td",{className:"px-3 py-2 font-medium text-ink",children:v?v.score.toFixed(1):"—"}),e.jsx("td",{className:"px-3 py-2",children:v?.label?e.jsx("span",{className:`inline-block text-xs font-semibold px-1.5 py-0.5 rounded ${kt[v.label]??"bg-slate-100 text-graphite"}`,children:v.label}):"—"}),e.jsx("td",{className:"px-3 py-2 text-taupe text-xs",children:new Date(i.createdTime).toLocaleString("fr-FR")}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{onClick:()=>o(i),disabled:a===i.id,className:"text-xs text-berry hover:text-berry/80 font-medium cursor-pointer disabled:opacity-50 transition-colors",children:"Supprimer"})})]},i.id)}),m.map((i,g)=>e.jsxs("tr",{className:"bg-cream/30 opacity-50",children:[e.jsx("td",{className:"px-3 py-2 text-taupe line-through",children:c.length+g+1}),e.jsx("td",{className:"px-3 py-2 text-taupe line-through",colSpan:2,children:"Supprimée"}),e.jsx("td",{className:"px-3 py-2 text-taupe text-xs line-through",children:new Date(i.createdTime).toLocaleString("fr-FR")}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{onClick:()=>p(i.id),disabled:a===i.id,className:"text-xs text-flame hover:text-ink font-medium cursor-pointer disabled:opacity-50 transition-colors",children:"Récupérer"})})]},i.id))]})]})}),l&&e.jsx(Ae,{title:"Supprimer la réponse",message:"Cette réponse sera archivée et retirée des statistiques.",onConfirm:h,onCancel:()=>o(null),loading:a===l.id})]})}const W=[{label:"Pire imaginable",max:25,color:"bg-red-500"},{label:"Mauvais",max:39,color:"bg-orange-500"},{label:"Acceptable",max:52,color:"bg-amber-400"},{label:"Bon",max:73,color:"bg-lime-400"},{label:"Excellent",max:86,color:"bg-green-500"},{label:"Meilleur imaginable",max:100,color:"bg-emerald-500"}];function At({score:t,grade:s}){const n=Math.max(0,Math.min(100,t)),a=n;return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Échelle SUS"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-3 rounded-full overflow-hidden",children:W.map((r,l)=>{const o=l>0?W[l-1].max:0,u=r.max-o;return e.jsx("div",{className:`${r.color}`,style:{width:`${u}%`}},r.label)})}),e.jsx("div",{className:"absolute -top-1 w-5 h-5 bg-white border-2 border-slate-800 rounded-full shadow-sm transform -translate-x-1/2",style:{left:`${a}%`}}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("span",{className:"text-[10px] text-slate-400",children:"0"}),W.map(r=>e.jsx("span",{className:"text-[10px] text-slate-400",style:{position:"absolute",left:`${r.max}%`,transform:"translateX(-50%)"},children:r.max},r.label))]}),e.jsx("div",{className:"flex mt-4 gap-px",children:W.map((r,l)=>{const o=l>0?W[l-1].max:0,u=r.max-o;return e.jsx("div",{style:{width:`${u}%`},className:"text-center",children:e.jsx("span",{className:"text-[9px] text-slate-500 leading-tight block",children:r.label})},r.label)})})]}),e.jsxs("div",{className:"text-center mt-3",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[n.toFixed(1)," / 100"]}),e.jsxs("span",{className:"text-xs text-slate-400 ml-2",children:["Note : ",s]})]})]})}const Ct={"A+":"text-emerald-600",A:"text-emerald-600","A-":"text-green-600","B+":"text-lime-600",B:"text-lime-600","B-":"text-yellow-600","C+":"text-amber-600",C:"text-amber-600","C-":"text-orange-600",D:"text-red-600",F:"text-red-700"};function Et({stats:t}){const[s,n]=d.useState("95"),a=s==="90"?t.ci90:s==="99"?t.ci99:t.ci95;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques SUS"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Score moyen"}),e.jsx("p",{className:"text-3xl font-bold text-primary-600",children:t.mean.toFixed(1)}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"/ 100"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Note"}),e.jsx("p",{className:`text-3xl font-bold ${Ct[t.grade]??"text-slate-600"}`,children:t.grade}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"Sauro & Lewis (2012)"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Variabilité"}),e.jsxs("p",{className:"text-sm text-slate-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:"σ"})," = ",t.sd.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(r=>e.jsxs("button",{onClick:()=>n(r),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===r?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[r,"%"]},r))]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["[",a[0].toFixed(1)," ; ",a[1].toFixed(1),"]"]})]})]}),e.jsx(At,{score:t.mean,grade:t.grade})]})}function _({label:t,summary:s,unit:n="",showVariability:a=!0,ciLevel:r="95",colorClass:l="text-primary-600"}){const o=r==="90"?s.ci90:r==="99"?s.ci99:s.ci95;return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:t}),e.jsxs("p",{className:`text-2xl font-bold ${l}`,children:[s.mean.toFixed(2),n&&e.jsx("span",{className:"text-sm font-normal text-slate-400 ml-1",children:n})]}),a&&e.jsxs("div",{className:"mt-2 space-y-0.5",children:[e.jsxs("p",{className:"text-xs text-slate-500",children:[e.jsx("span",{className:"font-medium",children:"σ"})," = ",s.sd.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["IC",r,"% = [",o[0].toFixed(2)," ; ",o[1].toFixed(2),"]"]})]})]})}se.register(Be,Se,$e,Ve,ae,ne);function wt({stats:t}){const s=["G1","G2","G3","G4","G5","G6"],n=s.map(o=>Ie[o]),a=s.map(o=>t[o].mean),r={labels:n,datasets:[{label:"Score moyen",data:a,backgroundColor:"rgba(59, 130, 246, 0.15)",borderColor:"rgba(59, 130, 246, 0.8)",borderWidth:2,pointBackgroundColor:"rgba(59, 130, 246, 1)",pointBorderColor:"#fff",pointRadius:4,pointBorderWidth:2}]},l={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}},scales:{r:{beginAtZero:!0,min:0,max:5,ticks:{stepSize:1,font:{size:10},backdropColor:"transparent"},pointLabels:{font:{size:11},color:"#475569"},grid:{color:"rgba(148, 163, 184, 0.3)"},angleLines:{color:"rgba(148, 163, 184, 0.3)"}}}};return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Profil DEEP - 6 dimensions"}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx(qe,{data:r,options:l})})]})}const Lt=["text-blue-600","text-purple-600","text-teal-600","text-amber-600","text-pink-600","text-emerald-600"];function It({stats:t}){const[s,n]=d.useState("95"),a=["G1","G2","G3","G4","G5","G6"];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques DEEP"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(r=>e.jsxs("button",{onClick:()=>n(r),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===r?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[r,"%"]},r))]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:a.map((r,l)=>e.jsx(_,{label:Ie[r],summary:t[r],unit:"/ 5",ciLevel:s,colorClass:Lt[l]},r))}),e.jsx(wt,{stats:t})]})}function He({score:t,max:s,label:n}){const a=Math.max(0,Math.min(100,t/s*100));return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:n}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-3 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-red-400 via-amber-400 via-50% to-emerald-500 transition-all duration-500",style:{width:`${a}%`}})}),e.jsx("div",{className:"absolute -top-1 w-5 h-5 bg-white border-2 border-slate-800 rounded-full shadow-sm transform -translate-x-1/2 transition-all duration-500",style:{left:`${a}%`}}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("span",{className:"text-[10px] text-slate-400",children:"0"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:s})]})]}),e.jsxs("p",{className:"text-center text-sm font-semibold text-slate-700 mt-2",children:[t.toFixed(1)," / ",s]})]})}function Dt({stats:t}){const[s,n]=d.useState("95"),a=s==="90"?t.ci90:s==="99"?t.ci99:t.ci95;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UMUX"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Score moyen"}),e.jsx("p",{className:"text-3xl font-bold text-primary-600",children:t.mean.toFixed(1)}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"/ 100"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Variabilité"}),e.jsxs("p",{className:"text-sm text-slate-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:"σ"})," = ",t.sd.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(r=>e.jsxs("button",{onClick:()=>n(r),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===r?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[r,"%"]},r))]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["[",a[0].toFixed(1)," ; ",a[1].toFixed(1),"]"]})]})]}),e.jsx(He,{score:t.mean,max:100,label:"Score UMUX"})]})}function Rt({stats:t}){const[s,n]=d.useState("95");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UMUX-Lite"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(a=>e.jsxs("button",{onClick:()=>n(a),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===a?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[a,"%"]},a))]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(_,{label:"Score global",summary:t.global,unit:"/ 100",ciLevel:s,colorClass:"text-primary-600"}),e.jsx(_,{label:"Utilisabilité (Q3)",summary:t.usability,unit:"/ 100",ciLevel:s,colorClass:"text-teal-600"}),e.jsx(_,{label:"Utilité (Q1)",summary:t.usefulness,unit:"/ 100",ciLevel:s,colorClass:"text-purple-600"})]}),e.jsx(He,{score:t.global.mean,max:100,label:"Score global UMUX-Lite"})]})}se.register(Te,de,ke,ae,ne);function he(t,s){return s==="90"?t.ci90:s==="99"?t.ci99:t.ci95}function Oe({title:t,rows:s,ciLevel:n,xMin:a=-3,xMax:r=3}){const l={labels:s.map(c=>c.label),datasets:[{label:"Moyenne",data:s.map(c=>c.summary.mean),backgroundColor:s.map(c=>c.color),borderWidth:0,borderRadius:4,maxBarThickness:28}]},o=d.useMemo(()=>({id:"mean-ci-error-bars",afterDatasetsDraw:c=>{const m=c.scales.x,h=c.getDatasetMeta(0);if(!m||!h)return;const{ctx:i}=c,g=4;i.save(),i.strokeStyle="#0f172a",i.lineWidth=1.5,h.data.forEach((P,v)=>{const L=s[v];if(!L)return;const[w,D]=he(L.summary,n),R=Math.max(a,Math.min(r,w)),I=Math.max(a,Math.min(r,D)),Q=P.y,C=m.getPixelForValue(R),T=m.getPixelForValue(I);i.beginPath(),i.moveTo(C,Q),i.lineTo(T,Q),i.moveTo(C,Q-g),i.lineTo(C,Q+g),i.moveTo(T,Q-g),i.lineTo(T,Q+g),i.stroke()}),i.restore()}}),[n,s,a,r]),u={responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1},tooltip:{callbacks:{label:c=>{const m=s[c.dataIndex];if(!m)return"";const[h,i]=he(m.summary,n);return`Moyenne ${m.summary.mean.toFixed(2)} | IC${n}% [${h.toFixed(2)} ; ${i.toFixed(2)}]`}}}},scales:{x:{min:a,max:r,ticks:{stepSize:1,font:{size:10}},grid:{color:"rgba(148, 163, 184, 0.2)"}},y:{ticks:{font:{size:11}},grid:{display:!1}}}},p=Math.max(220,s.length*42);return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:t}),e.jsx("div",{style:{height:`${p}px`},children:e.jsx(Qe,{data:l,options:u,plugins:[o]})}),e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Barres: moyenne. Traits noirs: intervalle de confiance (IC",n,"%)."]})]})}const fe={GLOBAL:"text-primary-600",ATT:"text-amber-600",PERSP:"text-blue-600",EFF:"text-teal-600",DEP:"text-indigo-600",STIM:"text-pink-600",NOV:"text-purple-600"},ge={GLOBAL:"rgba(2, 132, 199, 0.75)",ATT:"rgba(217, 119, 6, 0.75)",PERSP:"rgba(37, 99, 235, 0.75)",EFF:"rgba(13, 148, 136, 0.75)",DEP:"rgba(79, 70, 229, 0.75)",STIM:"rgba(219, 39, 119, 0.75)",NOV:"rgba(147, 51, 234, 0.75)"},be=["ATT","PERSP","EFF","DEP","STIM","NOV"];function Ht({stats:t}){const[s,n]=d.useState("95");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UEQ"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(a=>e.jsxs("button",{onClick:()=>n(a),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===a?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[a,"%"]},a))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-primary-700",children:"Score global"}),e.jsx("div",{className:"max-w-sm",children:e.jsx(_,{label:J.GLOBAL,summary:t.GLOBAL,ciLevel:s,colorClass:fe.GLOBAL})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-600",children:"Dimensions detaillees"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3",children:be.map(a=>e.jsx(_,{label:J[a],summary:t[a],ciLevel:s,colorClass:fe[a]},a))})]}),e.jsx(Oe,{title:"Profil UEQ - Moyennes et IC",ciLevel:s,rows:[{label:J.GLOBAL,summary:t.GLOBAL,color:ge.GLOBAL},...be.map(a=>({label:J[a],summary:t[a],color:ge[a]}))],xMin:-3,xMax:3}),e.jsx("p",{className:"text-xs text-slate-500",children:"Échelle UEQ normalisée de -3 (négatif) à +3 (positif)."})]})}const je={GLOBAL:"text-primary-600",PRAG:"text-teal-600",HED:"text-pink-600"},Ne={GLOBAL:"rgba(2, 132, 199, 0.75)",PRAG:"rgba(13, 148, 136, 0.75)",HED:"rgba(219, 39, 119, 0.75)"},ye=["PRAG","HED"];function Ot({stats:t}){const[s,n]=d.useState("95");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UEQ-S"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(a=>e.jsxs("button",{onClick:()=>n(a),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===a?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[a,"%"]},a))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-primary-700",children:"Score global"}),e.jsx("div",{className:"max-w-sm",children:e.jsx(_,{label:ee.GLOBAL,summary:t.GLOBAL,ciLevel:s,colorClass:je.GLOBAL})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-600",children:"Dimensions detaillees"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:ye.map(a=>e.jsx(_,{label:ee[a],summary:t[a],ciLevel:s,colorClass:je[a]},a))})]}),e.jsx(Oe,{title:"Profil UEQ-S - Moyennes et IC",ciLevel:s,rows:[{label:ee.GLOBAL,summary:t.GLOBAL,color:Ne.GLOBAL},...ye.map(a=>({label:ee[a],summary:t[a],color:Ne[a]}))],xMin:-3,xMax:3}),e.jsx("p",{className:"text-xs text-slate-500",children:"Échelle UEQ-S normalisée de -3 (négatif) à +3 (positif)."})]})}se.register(de,Se,ae,ne);function Gt({qp:t,qh:s}){const n={datasets:[{label:"Produit",data:[{x:t,y:s}],backgroundColor:"rgba(59, 130, 246, 1)",borderColor:"#fff",borderWidth:2,pointRadius:8,pointHoverRadius:10}]},a={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{label:r=>`QP: ${(r.parsed.x??0).toFixed(2)}, QH: ${(r.parsed.y??0).toFixed(2)}`}}},scales:{x:{title:{display:!0,text:"Qualité Pragmatique (QP)",font:{size:11}},min:-3,max:3,grid:{color:"rgba(148, 163, 184, 0.2)"},ticks:{font:{size:10}}},y:{title:{display:!0,text:"Qualité Hédonique (QH)",font:{size:11}},min:-3,max:3,grid:{color:"rgba(148, 163, 184, 0.2)"},ticks:{font:{size:10}}}}};return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Portfolio AttrakDiff"}),e.jsx(ze,{data:n,options:a})]})}se.register(Te,de,ke,ae,ne);const Mt={QP:"rgba(59, 130, 246, 0.7)",QHS:"rgba(168, 85, 247, 0.7)",QHI:"rgba(236, 72, 153, 0.7)",ATT:"rgba(245, 158, 11, 0.7)"};function Ft(t){return t.startsWith("QP")?"QP":t.startsWith("QHS")?"QHS":t.startsWith("QHI")?"QHI":t.startsWith("ATT")?"ATT":"QP"}function Ut({wordPairs:t,questionnaire:s}){const n=s.questions.filter(c=>c.type==="bipolar"),a=n.map(c=>`${c.leftFr} / ${c.rightFr}`),r=n.map(c=>t[c.id]??0),l=n.map(c=>Mt[Ft(c.id)]??"rgba(100,100,100,0.5)"),o={labels:a,datasets:[{label:"Moyenne",data:r,backgroundColor:l,borderWidth:0,borderRadius:3}]},u={responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{min:-3,max:3,grid:{color:"rgba(148, 163, 184, 0.2)"},ticks:{font:{size:10}}},y:{ticks:{font:{size:10}},grid:{display:!1}}}},p=Math.max(300,n.length*28);return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Paires de mots - Moyennes"}),e.jsx("div",{style:{height:`${p}px`},children:e.jsx(Qe,{data:o,options:u})})]})}const _t={QP:"text-blue-600",QHS:"text-purple-600",QHI:"text-pink-600",ATT:"text-amber-600",QH:"text-teal-600"};function qt({stats:t,wordPairs:s,questionnaire:n,abridged:a}){const[r,l]=d.useState("95"),o=["QP","QHS","QHI","ATT","QH"];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-900",children:["Statistiques AttrakDiff",a?" (abrégé)":""]}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(u=>e.jsxs("button",{onClick:()=>l(u),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${r===u?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[u,"%"]},u))]})]}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:o.map(u=>e.jsx(_,{label:St[u],summary:t[u],ciLevel:r,colorClass:_t[u]},u))}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Gt,{qp:t.QP.mean,qh:t.QH.mean}),e.jsx(Ut,{wordPairs:s,questionnaire:n})]})]})}function Ge(t){const n=t.properties?.Payload;if(!n?.rich_text)return null;const a=n.rich_text.map(r=>r.plain_text||"").join("");if(!a)return null;try{return JSON.parse(a)}catch{return null}}function Bt(t,s){if(!re(t.questionnaireType))return;const a=[],r=s.filter(c=>!c.archived);for(const c of r){const m=Ge(c);if(!m?.answers)continue;if(a.length===0){const g=["Date",...Object.keys(m.answers)];a.push(g)}const h=new Date(c.createdTime).toLocaleString("fr-FR"),i=Object.values(m.answers).map(g=>String(g??""));a.push([h,...i])}if(a.length===0)return;const l=a.map(c=>c.map(m=>`"${m.replace(/"/g,'""')}"`).join(";")).join(`
`),o=new Blob(["\uFEFF"+l],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(o),p=document.createElement("a");p.href=u,p.download=`${t.name?.replace(/[^a-zA-Z0-9]/g,"_")||"export"}_reponses.csv`,p.click(),URL.revokeObjectURL(u)}function $t({project:t,responses:s,responsesLoading:n,onProjectUpdated:a,onProjectDeleted:r,onResponsesChanged:l,existingFolders:o=[],activeTab:u,onTabChange:p}){const[c,m]=d.useState(!1),[h,i]=d.useState(!1),[g,P]=d.useState("stats"),v=u??g,L=p??P,[w,D]=d.useState(!1),[R,I]=d.useState(!1),Q=re(t.questionnaireType),C=Q?et(Q):null,T=s.filter(b=>!b.archived),E=t.status==="Ouvert",G=t.publicToken?`${window.location.origin}/p/${t.publicToken}`:null,B=async()=>{D(!0);try{const b=E?"Fermé":"Ouvert",U=await Pe(t.id,{name:t.name,status:b});a(U)}catch(b){console.error(b)}finally{D(!1)}},F=()=>{G&&Ce(G).then(()=>{I(!0),setTimeout(()=>I(!1),2e3)})},y=d.useMemo(()=>T.map(Ge).filter(b=>!!b?.answers).map(b=>b.answers),[T]),f=d.useMemo(()=>{if(!Q||y.length===0)return null;switch(Q){case"sus":return{type:"sus",data:dt(y)};case"deep":return{type:"deep",data:xt(y)};case"umux":return{type:"umux",data:mt(y)};case"umux_lite":return{type:"umux_lite",data:pt(y)};case"ueq":return{type:"ueq",data:bt(y)};case"ueq_s":return{type:"ueq_s",data:vt(y)};case"attrakdiff":return{type:"attrakdiff",data:me(y,!1),wordPairs:pe(y,!1)};case"attrakdiff_abridged":return{type:"attrakdiff_abridged",data:me(y,!0),wordPairs:pe(y,!0)};default:return null}},[Q,y]),q=async()=>{i(!0);try{await Je(t.id),r()}catch(b){console.error(b)}finally{i(!1),m(!1)}},x=[{id:"stats",label:"Résultats"},{id:"responses",label:`Réponses (${T.length})`},{id:"form",label:"Paramètres"}];return e.jsxs("div",{className:"p-6 max-w-5xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-ink",children:t.name||"(Sans titre)"}),T.length>0&&e.jsxs("button",{onClick:()=>Bt(t,s),className:"text-xs text-flame hover:text-ink font-medium cursor-pointer flex items-center gap-1 shrink-0 transition-colors",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Exporter CSV"]})]}),e.jsxs("div",{className:"flex items-center gap-2.5 mt-2 flex-wrap",children:[e.jsxs("button",{onClick:B,disabled:w,className:`inline-flex items-center gap-1.5 text-xs font-medium pl-2 pr-2.5 py-1 rounded-full transition-colors cursor-pointer disabled:opacity-60 disabled:cursor-wait ${E?"bg-success-50 text-success-700 hover:bg-success-100":"bg-slate-100 text-taupe hover:bg-slate-200"}`,children:[e.jsxs("span",{className:"relative flex h-4 w-7 items-center",children:[e.jsx("span",{className:`absolute inset-0 rounded-full transition-colors ${E?"bg-success-400":"bg-slate-300"}`}),e.jsx("span",{className:`absolute top-0.5 h-3 w-3 rounded-full bg-white shadow-sm transition-transform ${E?"translate-x-3.5":"translate-x-0.5"}`})]}),w?"...":E?"Ouvert":"Fermé"]}),t.questionnaireType&&e.jsx("span",{className:"text-xs font-medium text-taupe bg-slate-100 px-2 py-1 rounded-full",children:t.questionnaireType}),G&&e.jsx("span",{className:"w-px h-4 bg-stone"}),G&&e.jsxs("div",{className:"inline-flex items-center gap-1.5 min-w-0",children:[e.jsx("code",{className:"text-[11px] text-taupe truncate max-w-[280px]",children:G}),e.jsx("button",{onClick:F,className:"inline-flex items-center gap-1 text-xs text-flame hover:text-ink font-medium cursor-pointer shrink-0 transition-colors",children:R?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 text-sage",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-sage",children:"Copié"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copier"]})})]})]})]}),e.jsx("div",{className:"border-b border-stone mb-6",children:e.jsx("nav",{className:"flex gap-6",children:x.map(b=>e.jsx("button",{onClick:()=>L(b.id),className:`pb-2.5 text-sm font-medium border-b-2 transition-colors cursor-pointer ${v===b.id?"border-flame text-flame":"border-transparent text-taupe hover:text-ink"}`,children:b.label},b.id))})}),v==="stats"&&e.jsx("div",{children:n?e.jsx("p",{className:"text-sm text-taupe py-8",children:"Chargement des résultats..."}):f?.data?e.jsxs(e.Fragment,{children:[f.type==="sus"&&f.data&&e.jsx(Et,{stats:f.data}),f.type==="deep"&&f.data&&e.jsx(It,{stats:f.data}),f.type==="umux"&&f.data&&e.jsx(Dt,{stats:f.data}),f.type==="umux_lite"&&f.data&&e.jsx(Rt,{stats:f.data}),f.type==="ueq"&&f.data&&e.jsx(Ht,{stats:f.data}),f.type==="ueq_s"&&f.data&&e.jsx(Ot,{stats:f.data}),(f.type==="attrakdiff"||f.type==="attrakdiff_abridged")&&f.data&&C&&e.jsx(qt,{stats:f.data,wordPairs:f.wordPairs,questionnaire:C,abridged:f.type==="attrakdiff_abridged"})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-sm text-taupe",children:y.length===0?"Aucune réponse pour calculer les statistiques.":"Type de questionnaire non reconnu."})})}),v==="responses"&&e.jsx("div",{children:n?e.jsx("p",{className:"text-sm text-taupe py-8",children:"Chargement des réponses..."}):e.jsx(Pt,{project:t,responses:s,onResponsesChanged:l})}),v==="form"&&e.jsxs("div",{className:"max-w-lg",children:[e.jsx(Ee,{project:t,hasResponses:T.length>0,existingFolders:o,onSaved:a}),e.jsx("div",{className:"mt-8 pt-6 border-t border-stone",children:e.jsx("button",{onClick:()=>m(!0),className:"text-sm text-berry hover:text-berry/80 font-medium cursor-pointer transition-colors",children:"Supprimer ce projet"})})]}),c&&e.jsx(Ae,{title:"Supprimer le projet",message:`Le projet « ${t.name} » et toutes ses réponses seront archivés. Cette action est réversible via Notion.`,onConfirm:q,onCancel:()=>m(!1),loading:h})]})}const Vt={stats:"stats",responses:"responses",settings:"form"},zt={stats:"stats",responses:"responses",form:"settings"};function ve(t){const s=t.replace(/^#/,"");if(s===""||s==="presentation")return{mode:"detail",projectId:null,tab:"stats"};if(s==="new")return{mode:"new",projectId:null,tab:"stats"};if(s.startsWith("project/")){const n=s.slice(8),a=n.indexOf("/");if(a===-1)return{mode:"detail",projectId:n||null,tab:"stats"};const r=n.slice(0,a),l=n.slice(a+1),o=Vt[l]??"stats";return{mode:"detail",projectId:r||null,tab:o}}return{mode:"detail",projectId:null,tab:"stats"}}function Wt(t,s,n){if(t==="new")return"#new";if(s){const a=zt[n]??"stats";return a==="stats"?`#project/${s}`:`#project/${s}/${a}`}return"#presentation"}function ss({onSyncStateChange:t}={}){const s=We(),n=Xe(),[a,r]=d.useState([]),[l,o]=d.useState(!0),[u,p]=d.useState(null),[c,m]=d.useState(null),[h,i]=d.useState("detail"),[g,P]=d.useState("stats"),[v,L]=d.useState(!1),w=d.useRef(h),D=d.useRef(null),R=d.useRef(g),I=d.useRef(ve(s.hash)),{responses:Q,loading:C,backgroundRefreshing:T,loadResponses:E,refreshCurrent:G,invalidate:B,clear:F}=tt(),y=d.useRef(null),f=d.useRef(!1),[q,x]=d.useState(null);d.useEffect(()=>{w.current=h},[h]),d.useEffect(()=>{D.current=c?.id??null},[c?.id]),d.useEffect(()=>{R.current=g},[g]);const b=d.useMemo(()=>q||(C||T?"syncing":"idle"),[C,T,q]);d.useEffect(()=>{t?.(b)},[b,t]),d.useEffect(()=>()=>{t?.("idle")},[t]);const U=d.useRef(!1);d.useEffect(()=>{const N=C||T;U.current&&!N&&(x("saved"),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{x(null),y.current=null},2e3)),U.current=N},[C,T]),d.useEffect(()=>()=>{y.current&&clearTimeout(y.current)},[]),d.useEffect(()=>{let N=!1;return(async()=>{try{o(!0);const A=le=>{const{mode:$,projectId:Z,tab:Ue}=I.current;if($==="new")i("new");else if(Z){const ie=le.find(_e=>_e.id===Z);ie&&(m(ie),i("detail"),P(Ue),E(ie.id))}},H=st();if(H){if(N)return;r(H),A(H);return}const O=await at();if(N)return;r(O),A(O)}catch(A){N||p(A instanceof Error?A.message:"Erreur inconnue")}finally{N||(f.current=!0,L(!0),o(!1))}})(),()=>{N=!0}},[]),d.useEffect(()=>{const{mode:N,projectId:S,tab:A}=ve(s.hash),H=w.current,O=D.current,le=R.current;if(N==="new"){if(H==="new"&&O===null)return;f.current=!0,m(null),i("new"),F();return}if(S){const $=a.find(Z=>Z.id===S);if($){if(H==="detail"&&O===$.id&&le===A)return;f.current=!0,m($),i("detail"),P(A),E($.id)}return}H==="detail"&&O===null||(f.current=!0,m(null),i("detail"),F())},[s.hash,a,E,F]),d.useEffect(()=>{if(!v)return;if(f.current){f.current=!1;return}const N=Wt(h,c?.id??null,g),S=s.hash;N===S||N===""&&(S===""||S==="#")||n(`${s.pathname}${s.search}${N}`,{replace:!0})},[h,c?.id,g,s.pathname,s.search,s.hash,n,v]);const Y=d.useMemo(()=>{const N=new Set;for(const S of a)S.folder?.trim()&&N.add(S.folder.trim());return Array.from(N).sort((S,A)=>S.localeCompare(A,"fr"))},[a]),ue=d.useCallback(N=>{r(S=>{const A=S.findIndex(O=>O.id===N.id);if(A===-1){const O=[N,...S];return oe(O),O}const H=[...S];return H[A]=N,oe(H),H}),m(N),i("detail"),E(N.id)},[E]),Me=d.useCallback(()=>{c&&(B(c.id),r(N=>{const S=N.filter(A=>A.id!==c.id);return oe(S),S})),m(null),i("detail"),F()},[c,B,F]),Fe=d.useCallback(()=>{G()},[G]);return e.jsx(nt,{children:l?e.jsx("div",{className:"flex items-center justify-center h-full py-32",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin mb-3"}),e.jsx("p",{className:"text-sm text-taupe",children:"Chargement des projets..."})]})}):u?e.jsx("div",{className:"flex items-center justify-center h-full py-32",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx("p",{className:"text-sm text-berry mb-2",children:"Impossible de charger les projets."}),e.jsx("p",{className:"text-xs text-taupe",children:u})]})}):h==="new"?e.jsxs("div",{className:"p-6 max-w-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-ink mb-6",children:"Nouveau projet"}),e.jsx(Ee,{project:null,hasResponses:!1,existingFolders:Y,onSaved:ue,onCancel:()=>i("detail")})]}):c?e.jsx($t,{project:c,responses:Q,responsesLoading:C,onProjectUpdated:ue,onProjectDeleted:Me,onResponsesChanged:Fe,existingFolders:Y,activeTab:g,onTabChange:P},c.id):e.jsx("div",{className:"flex items-center justify-center h-full py-32",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx("p",{className:"text-sm text-graphite",children:"Sélectionnez un projet dans le panneau latéral ou créez-en un nouveau."}),a.length>0&&e.jsxs("p",{className:"mt-3 text-xs text-taupe",children:[a.length," projet",a.length>1?"s":""," disponible",a.length>1?"s":"","."]})]})})})}export{ss as DashboardPage};
