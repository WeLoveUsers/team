import{j as e,R as ke,C as re,a as Ce,P as ue,L as Ae,i as Ee,p as ne,b as le,S as Ie,c as xe,B as Le,d as Re,e as He}from"./charts-DKGMT1ng.js";import{r as c,u as De,d as Fe}from"./react-DGBwUpAK.js";import{u as me,c as Ge,d as Oe,r as Me,e as Ue}from"./api-Bvj00Ti9.js";import{c as J,D as ie,g as qe}from"./Sidebar-DvhsLLju.js";import{u as _e,s as se,g as $e,e as Be}from"./App-CqZM5MKp.js";import"./index-DVf0JBI4.js";function ze({sidebar:t,children:s}){return e.jsxs("div",{className:"h-full min-h-0 bg-slate-50 flex",children:[t&&e.jsxs("aside",{className:"w-72 bg-white/60 border-r border-stone flex flex-col shrink-0",children:[e.jsx("div",{className:"px-4 py-4",children:e.jsx("p",{className:"text-[11px] font-medium uppercase tracking-[0.14em] text-flame",children:"Questionnaires UX"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:t})]}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto",children:s})]})}function pe(t){if(navigator.clipboard?.writeText)return navigator.clipboard.writeText(t);const s=document.createElement("textarea");return s.value=t,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),Promise.resolve()}const Ve=[{value:"SUS",label:"SUS"},{value:"DEEP",label:"DEEP"},{value:"UMUX",label:"UMUX"},{value:"UMUX (Lite)",label:"UMUX (Lite)"},{value:"UEQ",label:"UEQ"},{value:"AttrakDiff",label:"AttrakDiff"},{value:"AttrakDiff (abrégé)",label:"AttrakDiff (abrégé)"}],We=[{value:"Ouvert",label:"Ouvert"},{value:"Fermé",label:"Fermé"}],Xe=[{value:"Site Web",label:"Site Web"},{value:"Site E-Commerce",label:"Site E-Commerce"},{value:"Application mobile",label:"Application mobile"},{value:"Application tablette",label:"Application tablette"},{value:"Logiciel",label:"Logiciel"},{value:"Autre",label:"Autre"}];function fe({project:t,hasResponses:s,existingFolders:r,onSaved:a,onCancel:n}){const[l,o]=c.useState(""),[d,h]=c.useState(""),[i,m]=c.useState("Ouvert"),[b,x]=c.useState(""),[v,A]=c.useState(""),[P,F]=c.useState(""),[E,M]=c.useState(""),[U,S]=c.useState(""),[k,I]=c.useState(!1),[L,C]=c.useState(null),[T,R]=c.useState(!1);c.useEffect(()=>{t?(o(t.name??""),h(t.questionnaireType??""),m(t.status??"Ouvert"),x(t.publicToken??""),A(t.folder??""),F(t.productType??""),M(t.productName??""),S(t.instructions??"")):(o(""),h(""),m("Ouvert"),x(""),A(""),F(""),M(""),S("")),C(null)},[t]),c.useEffect(()=>{if(t)return;const u=J(d);u&&ie[u]?S(ie[u]):S("")},[d,t]);const G=()=>{if(b.trim())return b.trim();let u;if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")u=crypto.randomUUID();else{const q=new Uint8Array(16);crypto.getRandomValues(q),u=Array.from(q,K=>K.toString(16).padStart(2,"0")).join("")}const f=u.replace(/-/g,"").slice(0,12);return x(f),f},y=async u=>{u.preventDefault(),C(null),I(!0);try{if(!l.trim())throw new Error("Le nom du projet est requis.");if(!P)throw new Error("Le type de produit est requis.");if(!E.trim())throw new Error("Le nom du produit est requis.");const f={name:l.trim(),questionnaireType:d||null,status:i||null,publicToken:G(),folder:v.trim()||null,productType:P||null,productName:E.trim(),instructions:U||null},q=t?await me(t.id,f):await Ge(f);a(q)}catch(f){C(f instanceof Error?f.message:"Impossible d'enregistrer le projet")}finally{I(!1)}},p=b?`${window.location.origin}/p/${b}`:null,_=c.useMemo(()=>r.filter(u=>u.trim().length>0),[r]);return e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-name",className:"block text-sm font-medium text-slate-700 mb-1",children:"Nom du projet"}),e.jsx("input",{id:"pf-name",type:"text",value:l,onChange:u=>o(u.target.value),required:!0,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Mon projet"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-product-name",className:"block text-sm font-medium text-slate-700 mb-1",children:"Nom du produit évalué"}),e.jsx("input",{id:"pf-product-name",type:"text",value:E,onChange:u=>M(u.target.value),required:!0,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Ex : Google Maps, Mon application..."}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Utilisé dans les instructions et remplace ",e.jsx("code",{className:"bg-slate-100 px-1 rounded",children:"@product_name"}),"."]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-type",className:"block text-sm font-medium text-slate-700 mb-1",children:"Questionnaire"}),e.jsxs("select",{id:"pf-type",value:d,onChange:u=>h(u.target.value),disabled:s,required:!0,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:bg-slate-100 disabled:text-slate-500",children:[e.jsx("option",{value:"",children:"Choisir..."}),Ve.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))]}),s&&e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Non modifiable (réponses existantes)"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-product-type",className:"block text-sm font-medium text-slate-700 mb-1",children:"Type de produit"}),e.jsxs("select",{id:"pf-product-type",value:P,onChange:u=>F(u.target.value),required:!0,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Choisir..."}),Xe.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-status",className:"block text-sm font-medium text-slate-700 mb-1",children:"Statut"}),e.jsx("select",{id:"pf-status",value:i,onChange:u=>m(u.target.value),required:!0,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:We.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-folder",className:"block text-sm font-medium text-slate-700 mb-1",children:"Dossier"}),e.jsx("input",{id:"pf-folder",type:"text",value:v,onChange:u=>A(u.target.value),list:"pf-folder-suggestions",className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Aucun dossier"}),_.length>0&&e.jsx("datalist",{id:"pf-folder-suggestions",children:_.map(u=>e.jsx("option",{value:u},u))}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Saisissez un nom de dossier ou choisissez un existant. Laissez vide pour aucun dossier."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-instructions",className:"block text-sm font-medium text-slate-700 mb-1",children:"Instructions aux répondants"}),e.jsx("textarea",{id:"pf-instructions",value:U,onChange:u=>S(u.target.value),rows:5,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 resize-y",placeholder:"Instructions affichées aux répondants en haut du questionnaire..."}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[e.jsx("code",{className:"bg-slate-100 px-1 rounded",children:"@product_name"})," sera remplacé par le nom du produit évalué."]}),E.trim()&&U.includes("@product_name")&&e.jsxs("div",{className:"mt-2 p-3 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 mb-1",children:"Aperçu pour le répondant :"}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line",children:U.replace(/@product_name/g,E.trim())})]})]}),p&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 mb-1",children:"URL publique du questionnaire"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-xs text-primary-700 bg-primary-50 px-2 py-1 rounded flex-1 truncate",children:p}),e.jsx("button",{type:"button",onClick:()=>{pe(p).then(()=>{R(!0),setTimeout(()=>R(!1),2e3)})},className:"shrink-0 text-xs text-primary-600 hover:text-primary-700 font-medium cursor-pointer",children:T?"Copié !":"Copier"})]})]}),L&&e.jsx("div",{className:"text-sm text-danger-600 bg-danger-50 px-3 py-2 rounded-lg",children:L}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:k,className:"px-4 py-2 bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 text-white text-sm font-medium rounded-lg transition-colors cursor-pointer disabled:cursor-not-allowed",children:k?"Enregistrement...":t?"Mettre à jour":"Créer le projet"}),n&&e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm font-medium text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors cursor-pointer",children:"Annuler"})]})]})}const w={mean:0,sd:0,ci90:[0,0],ci95:[0,0],ci99:[0,0]};function O(t,s=2){const r=10**s;return Math.round(t*r)/r}function he(t){return t.length===0?0:t.reduce((s,r)=>s+r,0)/t.length}function Ke(t,s){if(t.length<=1)return 0;const r=s??he(t),a=t.reduce((n,l)=>n+(l-r)**2,0)/(t.length-1);return Math.sqrt(a)}function Z(t,s){const r=t<.5?t:1-t,a=t<.5?-1:1,n=Math.log(1/(r*r)),l=2.515517,o=.802853,d=.010328,h=1.432788,i=.189269,m=.001308,b=Math.sqrt(n),x=a*(b-(l+o*b+d*n)/(1+h*b+i*n+m*b*n));if(s>=1e3)return x;const v=(x**3+x)/(4*s),A=(5*x**5+16*x**3+3*x)/(96*s*s),P=(3*x**7+19*x**5+17*x**3-15*x)/(384*s**3),F=(79*x**9+776*x**7+1482*x**5-1920*x**3-945*x)/(92160*s**4);return x+v+A+P+F}function ae(t){return Z(t,1e4)}function Ye(t,s,r){const a=1-s/r;return t/Math.sqrt(s)*Math.sqrt(a)}function B(t,s,r,a,n){const l=Ye(s,r,a),o=n*l;return[t-o,t+o]}function j(t,s){if(t.length===0||s===0)return{...w};const r=he(t),a=Ke(t,r),n=1e100;let l,o,d;if(s>60){const h=ae(.95),i=ae(1-(1-.95)/2),m=ae(1-(1-.99)/2);l=B(r,a,s,n,h),o=B(r,a,s,n,i),d=B(r,a,s,n,m)}else{const h=s-1,i=Z(1-(1-.9)/2,h),m=Z(1-(1-.95)/2,h),b=Z(1-(1-.99)/2,h);l=B(r,a,s,n,i),o=B(r,a,s,n,m),d=B(r,a,s,n,b)}return{mean:O(r),sd:O(a),ci90:[O(l[0]),O(l[1])],ci95:[O(o[0]),O(o[1])],ci99:[O(d[0]),O(d[1])]}}function be(t){const s=(t.Q1??0)+(t.Q3??0)+(t.Q5??0)+(t.Q7??0)+(t.Q9??0),r=4-(t.Q2??0)+(4-(t.Q4??0))+(4-(t.Q6??0))+(4-(t.Q8??0))+(4-(t.Q10??0));return 2.5*(s+r)}function ge(t){return t>=84.1?"A+":t>=80.8?"A":t>=78.9?"A-":t>=77.2?"B+":t>=74.1?"B":t>=72.6?"B-":t>=71.1?"C+":t>=65?"C":t>=62.7?"C-":t>=51.7?"D":"F"}function Ze(t){const s=[];for(const a of t)["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10"].some(l=>typeof a[l]!="number"||Number.isNaN(a[l]))||s.push(be(a));if(s.length===0)return null;const r=j(s,s.length);return{...r,n:s.length,grade:ge(r.mean)}}const Je={G1:["Q1","Q2","Q3","Q4"],G2:["Q5","Q6","Q7"],G3:["Q8","Q9","Q10"],G4:["Q11","Q12","Q13"],G5:["Q14","Q15","Q16"],G6:["Q17","Q18","Q19"]},je={G1:"Contenu percu",G2:"Structure / AI",G3:"Navigation",G4:"Effort cognitif",G5:"Cohérence mise en page",G6:"Guidage visuel"};function et(t){if(t.length===0)return null;const s={G1:[],G2:[],G3:[],G4:[],G5:[],G6:[]};for(const a of t)for(const[n,l]of Object.entries(Je))for(const o of l){const d=a[o];typeof d=="number"&&d>0&&s[n].push(d)}const r=t.length;return{n:r,G1:s.G1.length>0?j(s.G1,r):{...w},G2:s.G2.length>0?j(s.G2,r):{...w},G3:s.G3.length>0?j(s.G3,r):{...w},G4:s.G4.length>0?j(s.G4,r):{...w},G5:s.G5.length>0?j(s.G5,r):{...w},G6:s.G6.length>0?j(s.G6,r):{...w}}}function Ne(t){return 100*((t.Q1??0)+(t.Q2??0)+(t.Q3??0)+(t.Q4??0))/24}function tt(t){if(t.length===0)return null;const s=t.map(Ne);return{...j(s,s.length),n:s.length}}function ye(t){return 100*((t.Q1??0)+(t.Q3??0))/12}function st(t){if(t.length===0)return null;const s=t.map(ye),r=t.map(l=>100/6*(l.Q3??0)),a=t.map(l=>100/6*(l.Q1??0)),n=t.length;return{n,global:j(s,n),usability:j(r,n),usefulness:j(a,n)}}const at={ATT:["Q1","Q12","Q14","Q16","Q24","Q25"],PERSP:["Q2","Q4","Q13","Q21"],EFF:["Q9","Q20","Q22","Q23"],DEP:["Q8","Q11","Q17","Q19"],STIM:["Q5","Q6","Q7","Q18"],NOV:["Q3","Q10","Q15","Q26"]},rt={Q1:"right",Q2:"right",Q3:"left",Q4:"left",Q5:"left",Q6:"right",Q7:"right",Q8:"right",Q9:"left",Q10:"left",Q11:"right",Q12:"left",Q13:"right",Q14:"right",Q15:"right",Q16:"right",Q17:"left",Q18:"left",Q19:"left",Q20:"right",Q21:"left",Q22:"right",Q23:"left",Q24:"left",Q25:"left",Q26:"right"};function nt(t,s){if(!Number.isFinite(t)||t<1||t>7)return null;const r=rt[s];return r?r==="right"?t-4:4-t:null}function lt(t){if(t.length===0)return null;const s={ATT:[],PERSP:[],EFF:[],DEP:[],STIM:[],NOV:[],GLOBAL:[]};for(const a of t)for(const[n,l]of Object.entries(at))for(const o of l){const d=a[o];if(typeof d!="number")continue;const h=nt(d,o);h!=null&&(s[n].push(h),s.GLOBAL.push(h))}const r=t.length;return{n:r,ATT:s.ATT.length>0?j(s.ATT,r):{...w},PERSP:s.PERSP.length>0?j(s.PERSP,r):{...w},EFF:s.EFF.length>0?j(s.EFF,r):{...w},DEP:s.DEP.length>0?j(s.DEP,r):{...w},STIM:s.STIM.length>0?j(s.STIM,r):{...w},NOV:s.NOV.length>0?j(s.NOV,r):{...w},GLOBAL:s.GLOBAL.length>0?j(s.GLOBAL,r):{...w}}}const it={ATT:"Attractivité",PERSP:"Clarté",EFF:"Efficacité",DEP:"Contrôlabilité",STIM:"Stimulation",NOV:"Nouveauté",GLOBAL:"Score global"},W={QP:["QP1","QP2","QP3","QP4","QP5","QP6","QP7"],QHS:["QHS1","QHS2","QHS3","QHS4","QHS5","QHS6","QHS7"],QHI:["QHI1","QHI2","QHI3","QHI4","QHI5","QHI6","QHI7"],ATT:["ATT1","ATT2","ATT3","ATT4","ATT5","ATT6","ATT7"]},X={QP:["QP2","QP3","QP5","QP6"],QHS:["QHS2","QHS5"],QHI:["QHI3","QHI4"],ATT:["ATT2","ATT5"]};function oe(t,s=!1){if(t.length===0)return null;const r=s?X:W,a={QP:[],QHS:[],QHI:[],ATT:[],QH:[]};for(const l of t){for(const o of r.QP)a.QP.push(l[o]??0);for(const o of r.QHS)a.QHS.push(l[o]??0);for(const o of r.QHI)a.QHI.push(l[o]??0);for(const o of r.ATT)a.ATT.push(l[o]??0);for(const o of r.QHS)a.QH.push(l[o]??0);for(const o of r.QHI)a.QH.push(l[o]??0)}const n=t.length;return{n,QP:j(a.QP,n),QHS:j(a.QHS,n),QHI:j(a.QHI,n),ATT:j(a.ATT,n),QH:j(a.QH,n)}}const ot={QP:"Qualité Pragmatique",QHS:"Qualité Hédonique - Stimulation",QHI:"Qualité Hédonique - Identification",ATT:"Attractivité",QH:"Qualité Hédonique"};function ce(t,s=!1){const r=s?[...X.QP,...X.QHS,...X.QHI,...X.ATT]:[...W.QP,...W.QHS,...W.QHI,...W.ATT],a={};if(t.length===0){for(const n of r)a[n]=0;return a}for(const n of r){const l=t.reduce((o,d)=>o+(d[n]??0),0);a[n]=O(l/t.length)}return a}function ct(t){const r=t.properties?.Payload;if(!r?.rich_text)return null;const a=r.rich_text.map(n=>n.plain_text||"").join("");if(!a)return null;try{return JSON.parse(a)}catch{return null}}function dt(t,s){const r=J(t);if(!r)return null;switch(r){case"sus":{const a=be(s);return{score:Math.round(a*100)/100,label:ge(a)}}case"umux":{const a=Ne(s);return{score:Math.round(a*100)/100}}case"umux_lite":{const a=ye(s);return{score:Math.round(a*100)/100}}default:return null}}const ut={"A+":"bg-emerald-100 text-emerald-800",A:"bg-emerald-100 text-emerald-700","A-":"bg-green-100 text-green-700","B+":"bg-lime-100 text-lime-700",B:"bg-lime-100 text-lime-700","B-":"bg-yellow-100 text-yellow-700","C+":"bg-amber-100 text-amber-700",C:"bg-amber-100 text-amber-700","C-":"bg-orange-100 text-orange-700",D:"bg-red-100 text-red-700",F:"bg-red-200 text-red-800"};function xt({project:t,responses:s,onResponsesChanged:r}){const[a,n]=c.useState(null),l=async i=>{n(i);try{await Oe(t.id,i),r()}catch(m){console.error(m)}finally{n(null)}},o=async i=>{n(i);try{await Me(t.id,i),r()}catch(m){console.error(m)}finally{n(null)}},d=s.filter(i=>!i.archived),h=s.filter(i=>i.archived);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Réponses"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:[d.length," active",d.length>1?"s":""]})]}),s.length===0?e.jsx("p",{className:"text-sm text-slate-400 py-4",children:"Aucune réponse pour le moment."}):e.jsx("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 border-b border-slate-200",children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase",children:"#"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase",children:"Score"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase",children:"Note"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-slate-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-slate-500 uppercase",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100",children:[d.map((i,m)=>{const b=ct(i),x=b?.answers?dt(t.questionnaireType,b.answers):null;return e.jsxs("tr",{className:"hover:bg-slate-50/50",children:[e.jsx("td",{className:"px-3 py-2 text-slate-500",children:m+1}),e.jsx("td",{className:"px-3 py-2 font-medium text-slate-900",children:x?x.score.toFixed(1):"—"}),e.jsx("td",{className:"px-3 py-2",children:x?.label?e.jsx("span",{className:`inline-block text-xs font-semibold px-1.5 py-0.5 rounded ${ut[x.label]??"bg-slate-100 text-slate-600"}`,children:x.label}):"—"}),e.jsx("td",{className:"px-3 py-2 text-slate-500 text-xs",children:new Date(i.createdTime).toLocaleString("fr-FR")}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{onClick:()=>l(i.id),disabled:a===i.id,className:"text-xs text-danger-600 hover:text-danger-700 font-medium cursor-pointer disabled:opacity-50",children:"Supprimer"})})]},i.id)}),h.map((i,m)=>e.jsxs("tr",{className:"bg-slate-50/30 opacity-50",children:[e.jsx("td",{className:"px-3 py-2 text-slate-400 line-through",children:d.length+m+1}),e.jsx("td",{className:"px-3 py-2 text-slate-400 line-through",colSpan:2,children:"Supprimée"}),e.jsx("td",{className:"px-3 py-2 text-slate-400 text-xs line-through",children:new Date(i.createdTime).toLocaleString("fr-FR")}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{onClick:()=>o(i.id),disabled:a===i.id,className:"text-xs text-primary-600 hover:text-primary-700 font-medium cursor-pointer disabled:opacity-50",children:"Récupérer"})})]},i.id))]})]})})]})}function mt({title:t,message:s,onConfirm:r,onCancel:a,loading:n}){return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-sm w-full mx-4 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:t}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:s}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:a,disabled:n,className:"px-4 py-2 text-sm font-medium text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors cursor-pointer disabled:opacity-50",children:"Annuler"}),e.jsx("button",{onClick:r,disabled:n,className:"px-4 py-2 text-sm font-medium text-white bg-danger-600 hover:bg-danger-700 rounded-lg transition-colors cursor-pointer disabled:opacity-50",children:n?"Suppression...":"Supprimer"})]})]})})}const V=[{label:"Pire imaginable",max:25,color:"bg-red-500"},{label:"Mauvais",max:39,color:"bg-orange-500"},{label:"Acceptable",max:52,color:"bg-amber-400"},{label:"Bon",max:73,color:"bg-lime-400"},{label:"Excellent",max:86,color:"bg-green-500"},{label:"Meilleur imaginable",max:100,color:"bg-emerald-500"}];function pt({score:t,grade:s}){const r=Math.max(0,Math.min(100,t)),a=r;return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Échelle SUS"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-3 rounded-full overflow-hidden",children:V.map((n,l)=>{const o=l>0?V[l-1].max:0,d=n.max-o;return e.jsx("div",{className:`${n.color}`,style:{width:`${d}%`}},n.label)})}),e.jsx("div",{className:"absolute -top-1 w-5 h-5 bg-white border-2 border-slate-800 rounded-full shadow-sm transform -translate-x-1/2",style:{left:`${a}%`}}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("span",{className:"text-[10px] text-slate-400",children:"0"}),V.map(n=>e.jsx("span",{className:"text-[10px] text-slate-400",style:{position:"absolute",left:`${n.max}%`,transform:"translateX(-50%)"},children:n.max},n.label))]}),e.jsx("div",{className:"flex mt-4 gap-px",children:V.map((n,l)=>{const o=l>0?V[l-1].max:0,d=n.max-o;return e.jsx("div",{style:{width:`${d}%`},className:"text-center",children:e.jsx("span",{className:"text-[9px] text-slate-500 leading-tight block",children:n.label})},n.label)})})]}),e.jsxs("div",{className:"text-center mt-3",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[r.toFixed(1)," / 100"]}),e.jsxs("span",{className:"text-xs text-slate-400 ml-2",children:["Note : ",s]})]})]})}const ft={"A+":"text-emerald-600",A:"text-emerald-600","A-":"text-green-600","B+":"text-lime-600",B:"text-lime-600","B-":"text-yellow-600","C+":"text-amber-600",C:"text-amber-600","C-":"text-orange-600",D:"text-red-600",F:"text-red-700"};function ht({stats:t}){const[s,r]=c.useState("95"),a=s==="90"?t.ci90:s==="99"?t.ci99:t.ci95;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques SUS"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Score moyen"}),e.jsx("p",{className:"text-3xl font-bold text-primary-600",children:t.mean.toFixed(1)}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"/ 100"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Note"}),e.jsx("p",{className:`text-3xl font-bold ${ft[t.grade]??"text-slate-600"}`,children:t.grade}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"Sauro & Lewis (2012)"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Variabilité"}),e.jsxs("p",{className:"text-sm text-slate-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:"σ"})," = ",t.sd.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(n=>e.jsxs("button",{onClick:()=>r(n),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===n?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[n,"%"]},n))]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["[",a[0].toFixed(1)," ; ",a[1].toFixed(1),"]"]})]})]}),e.jsx(pt,{score:t.mean,grade:t.grade})]})}function z({label:t,summary:s,unit:r="",showVariability:a=!0,ciLevel:n="95",colorClass:l="text-primary-600"}){const o=n==="90"?s.ci90:n==="99"?s.ci99:s.ci95;return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:t}),e.jsxs("p",{className:`text-2xl font-bold ${l}`,children:[s.mean.toFixed(2),r&&e.jsx("span",{className:"text-sm font-normal text-slate-400 ml-1",children:r})]}),a&&e.jsxs("div",{className:"mt-2 space-y-0.5",children:[e.jsxs("p",{className:"text-xs text-slate-500",children:[e.jsx("span",{className:"font-medium",children:"σ"})," = ",s.sd.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["IC",n,"% = [",o[0].toFixed(2)," ; ",o[1].toFixed(2),"]"]})]})]})}re.register(Ce,ue,Ae,Ee,ne,le);function bt({stats:t}){const s=["G1","G2","G3","G4","G5","G6"],r=s.map(o=>je[o]),a=s.map(o=>t[o].mean),n={labels:r,datasets:[{label:"Score moyen",data:a,backgroundColor:"rgba(59, 130, 246, 0.15)",borderColor:"rgba(59, 130, 246, 0.8)",borderWidth:2,pointBackgroundColor:"rgba(59, 130, 246, 1)",pointBorderColor:"#fff",pointRadius:4,pointBorderWidth:2}]},l={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}},scales:{r:{beginAtZero:!0,min:0,max:5,ticks:{stepSize:1,font:{size:10},backdropColor:"transparent"},pointLabels:{font:{size:11},color:"#475569"},grid:{color:"rgba(148, 163, 184, 0.3)"},angleLines:{color:"rgba(148, 163, 184, 0.3)"}}}};return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Profil DEEP - 6 dimensions"}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx(ke,{data:n,options:l})})]})}const gt=["text-blue-600","text-purple-600","text-teal-600","text-amber-600","text-pink-600","text-emerald-600"];function jt({stats:t}){const[s,r]=c.useState("95"),a=["G1","G2","G3","G4","G5","G6"];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques DEEP"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(n=>e.jsxs("button",{onClick:()=>r(n),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===n?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[n,"%"]},n))]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:a.map((n,l)=>e.jsx(z,{label:je[n],summary:t[n],unit:"/ 5",ciLevel:s,colorClass:gt[l]},n))}),e.jsx(bt,{stats:t})]})}function ve({score:t,max:s,label:r}){const a=Math.max(0,Math.min(100,t/s*100));return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:r}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-3 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-red-400 via-amber-400 via-50% to-emerald-500 transition-all duration-500",style:{width:`${a}%`}})}),e.jsx("div",{className:"absolute -top-1 w-5 h-5 bg-white border-2 border-slate-800 rounded-full shadow-sm transform -translate-x-1/2 transition-all duration-500",style:{left:`${a}%`}}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("span",{className:"text-[10px] text-slate-400",children:"0"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:s})]})]}),e.jsxs("p",{className:"text-center text-sm font-semibold text-slate-700 mt-2",children:[t.toFixed(1)," / ",s]})]})}function Nt({stats:t}){const[s,r]=c.useState("95"),a=s==="90"?t.ci90:s==="99"?t.ci99:t.ci95;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UMUX"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Score moyen"}),e.jsx("p",{className:"text-3xl font-bold text-primary-600",children:t.mean.toFixed(1)}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"/ 100"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Variabilité"}),e.jsxs("p",{className:"text-sm text-slate-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:"σ"})," = ",t.sd.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(n=>e.jsxs("button",{onClick:()=>r(n),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===n?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[n,"%"]},n))]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["[",a[0].toFixed(1)," ; ",a[1].toFixed(1),"]"]})]})]}),e.jsx(ve,{score:t.mean,max:100,label:"Score UMUX"})]})}function yt({stats:t}){const[s,r]=c.useState("95");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UMUX-Lite"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(a=>e.jsxs("button",{onClick:()=>r(a),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===a?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[a,"%"]},a))]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(z,{label:"Score global",summary:t.global,unit:"/ 100",ciLevel:s,colorClass:"text-primary-600"}),e.jsx(z,{label:"Utilisabilité (Q3)",summary:t.usability,unit:"/ 100",ciLevel:s,colorClass:"text-teal-600"}),e.jsx(z,{label:"Utilité (Q1)",summary:t.usefulness,unit:"/ 100",ciLevel:s,colorClass:"text-purple-600"})]}),e.jsx(ve,{score:t.global.mean,max:100,label:"Score global UMUX-Lite"})]})}const vt={GLOBAL:"text-primary-600",ATT:"text-amber-600",PERSP:"text-blue-600",EFF:"text-teal-600",DEP:"text-indigo-600",STIM:"text-pink-600",NOV:"text-purple-600"},Qt=["GLOBAL","ATT","PERSP","EFF","DEP","STIM","NOV"];function St({stats:t}){const[s,r]=c.useState("95");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UEQ"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(a=>e.jsxs("button",{onClick:()=>r(a),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===a?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[a,"%"]},a))]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:Qt.map(a=>e.jsx(z,{label:it[a],summary:t[a],ciLevel:s,colorClass:vt[a]},a))}),e.jsx("p",{className:"text-xs text-slate-500",children:"Échelle UEQ normalisée de -3 (négatif) à +3 (positif)."})]})}re.register(xe,ue,ne,le);function Tt({qp:t,qh:s}){const r={datasets:[{label:"Produit",data:[{x:t,y:s}],backgroundColor:"rgba(59, 130, 246, 1)",borderColor:"#fff",borderWidth:2,pointRadius:8,pointHoverRadius:10}]},a={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{label:n=>`QP: ${(n.parsed.x??0).toFixed(2)}, QH: ${(n.parsed.y??0).toFixed(2)}`}}},scales:{x:{title:{display:!0,text:"Qualité Pragmatique (QP)",font:{size:11}},min:-3,max:3,grid:{color:"rgba(148, 163, 184, 0.2)"},ticks:{font:{size:10}}},y:{title:{display:!0,text:"Qualité Hédonique (QH)",font:{size:11}},min:-3,max:3,grid:{color:"rgba(148, 163, 184, 0.2)"},ticks:{font:{size:10}}}}};return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Portfolio AttrakDiff"}),e.jsx(Ie,{data:r,options:a})]})}re.register(Re,xe,He,ne,le);const wt={QP:"rgba(59, 130, 246, 0.7)",QHS:"rgba(168, 85, 247, 0.7)",QHI:"rgba(236, 72, 153, 0.7)",ATT:"rgba(245, 158, 11, 0.7)"};function Pt(t){return t.startsWith("QP")?"QP":t.startsWith("QHS")?"QHS":t.startsWith("QHI")?"QHI":t.startsWith("ATT")?"ATT":"QP"}function kt({wordPairs:t,questionnaire:s}){const r=s.questions.filter(i=>i.type==="bipolar"),a=r.map(i=>`${i.leftFr} / ${i.rightFr}`),n=r.map(i=>t[i.id]??0),l=r.map(i=>wt[Pt(i.id)]??"rgba(100,100,100,0.5)"),o={labels:a,datasets:[{label:"Moyenne",data:n,backgroundColor:l,borderWidth:0,borderRadius:3}]},d={responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{min:-3,max:3,grid:{color:"rgba(148, 163, 184, 0.2)"},ticks:{font:{size:10}}},y:{ticks:{font:{size:10}},grid:{display:!1}}}},h=Math.max(300,r.length*28);return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Paires de mots - Moyennes"}),e.jsx("div",{style:{height:`${h}px`},children:e.jsx(Le,{data:o,options:d})})]})}const Ct={QP:"text-blue-600",QHS:"text-purple-600",QHI:"text-pink-600",ATT:"text-amber-600",QH:"text-teal-600"};function At({stats:t,wordPairs:s,questionnaire:r,abridged:a}){const[n,l]=c.useState("95"),o=["QP","QHS","QHI","ATT","QH"];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-900",children:["Statistiques AttrakDiff",a?" (abrégé)":""]}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(d=>e.jsxs("button",{onClick:()=>l(d),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${n===d?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[d,"%"]},d))]})]}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:o.map(d=>e.jsx(z,{label:ot[d],summary:t[d],ciLevel:n,colorClass:Ct[d]},d))}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Tt,{qp:t.QP.mean,qh:t.QH.mean}),e.jsx(kt,{wordPairs:s,questionnaire:r})]})]})}function Qe(t){const r=t.properties?.Payload;if(!r?.rich_text)return null;const a=r.rich_text.map(n=>n.plain_text||"").join("");if(!a)return null;try{return JSON.parse(a)}catch{return null}}function Et(t,s){if(!J(t.questionnaireType))return;const a=[],n=s.filter(i=>!i.archived);for(const i of n){const m=Qe(i);if(!m?.answers)continue;if(a.length===0){const v=["Date",...Object.keys(m.answers)];a.push(v)}const b=new Date(i.createdTime).toLocaleString("fr-FR"),x=Object.values(m.answers).map(v=>String(v??""));a.push([b,...x])}if(a.length===0)return;const l=a.map(i=>i.map(m=>`"${m.replace(/"/g,'""')}"`).join(";")).join(`
`),o=new Blob(["\uFEFF"+l],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(o),h=document.createElement("a");h.href=d,h.download=`${t.name?.replace(/[^a-zA-Z0-9]/g,"_")||"export"}_reponses.csv`,h.click(),URL.revokeObjectURL(d)}function It({project:t,responses:s,responsesLoading:r,onProjectUpdated:a,onProjectDeleted:n,onResponsesChanged:l,existingFolders:o=[],activeTab:d,onTabChange:h}){const[i,m]=c.useState(!1),[b,x]=c.useState(!1),[v,A]=c.useState("stats"),P=d??v,F=h??A,[E,M]=c.useState(!1),[U,S]=c.useState(!1),k=J(t.questionnaireType),I=k?qe(k):null,L=s.filter(f=>!f.archived),C=t.status==="Ouvert",T=t.publicToken?`${window.location.origin}/p/${t.publicToken}`:null,R=async()=>{M(!0);try{const f=C?"Fermé":"Ouvert",q=await me(t.id,{name:t.name,status:f});a(q)}catch(f){console.error(f)}finally{M(!1)}},G=()=>{T&&pe(T).then(()=>{S(!0),setTimeout(()=>S(!1),2e3)})},y=c.useMemo(()=>L.map(Qe).filter(f=>!!f?.answers).map(f=>f.answers),[L]),p=c.useMemo(()=>{if(!k||y.length===0)return null;switch(k){case"sus":return{type:"sus",data:Ze(y)};case"deep":return{type:"deep",data:et(y)};case"umux":return{type:"umux",data:tt(y)};case"umux_lite":return{type:"umux_lite",data:st(y)};case"ueq":return{type:"ueq",data:lt(y)};case"attrakdiff":return{type:"attrakdiff",data:oe(y,!1),wordPairs:ce(y,!1)};case"attrakdiff_abridged":return{type:"attrakdiff_abridged",data:oe(y,!0),wordPairs:ce(y,!0)};default:return null}},[k,y]),_=async()=>{x(!0);try{await Ue(t.id),n()}catch(f){console.error(f)}finally{x(!1),m(!1)}},u=[{id:"stats",label:"Résultats"},{id:"responses",label:`Réponses (${L.length})`},{id:"form",label:"Paramètres"}];return e.jsxs("div",{className:"p-6 max-w-5xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:t.name||"(Sans titre)"}),L.length>0&&e.jsxs("button",{onClick:()=>Et(t,s),className:"text-xs text-primary-600 hover:text-primary-700 font-medium cursor-pointer flex items-center gap-1 shrink-0",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Exporter CSV"]})]}),e.jsxs("div",{className:"flex items-center gap-2.5 mt-2 flex-wrap",children:[e.jsxs("button",{onClick:R,disabled:E,className:`inline-flex items-center gap-1.5 text-xs font-medium pl-2 pr-2.5 py-1 rounded-full transition-colors cursor-pointer disabled:opacity-60 disabled:cursor-wait ${C?"bg-success-50 text-success-700 hover:bg-success-100":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,children:[e.jsxs("span",{className:"relative flex h-4 w-7 items-center",children:[e.jsx("span",{className:`absolute inset-0 rounded-full transition-colors ${C?"bg-success-400":"bg-slate-300"}`}),e.jsx("span",{className:`absolute top-0.5 h-3 w-3 rounded-full bg-white shadow-sm transition-transform ${C?"translate-x-3.5":"translate-x-0.5"}`})]}),E?"...":C?"Ouvert":"Fermé"]}),t.questionnaireType&&e.jsx("span",{className:"text-xs font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded-full",children:t.questionnaireType}),T&&e.jsx("span",{className:"w-px h-4 bg-slate-200"}),T&&e.jsxs("div",{className:"inline-flex items-center gap-1.5 min-w-0",children:[e.jsx("code",{className:"text-[11px] text-slate-400 truncate max-w-[280px]",children:T}),e.jsx("button",{onClick:G,className:"inline-flex items-center gap-1 text-xs text-primary-600 hover:text-primary-700 font-medium cursor-pointer shrink-0",children:U?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 text-success-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-success-600",children:"Copié"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copier"]})})]})]})]}),e.jsx("div",{className:"border-b border-slate-200 mb-6",children:e.jsx("nav",{className:"flex gap-6",children:u.map(f=>e.jsx("button",{onClick:()=>F(f.id),className:`pb-2.5 text-sm font-medium border-b-2 transition-colors cursor-pointer ${P===f.id?"border-primary-500 text-primary-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:f.label},f.id))})}),P==="stats"&&e.jsx("div",{children:r?e.jsx("p",{className:"text-sm text-slate-400 py-8",children:"Chargement des résultats..."}):p?.data?e.jsxs(e.Fragment,{children:[p.type==="sus"&&p.data&&e.jsx(ht,{stats:p.data}),p.type==="deep"&&p.data&&e.jsx(jt,{stats:p.data}),p.type==="umux"&&p.data&&e.jsx(Nt,{stats:p.data}),p.type==="umux_lite"&&p.data&&e.jsx(yt,{stats:p.data}),p.type==="ueq"&&p.data&&e.jsx(St,{stats:p.data}),(p.type==="attrakdiff"||p.type==="attrakdiff_abridged")&&p.data&&I&&e.jsx(At,{stats:p.data,wordPairs:p.wordPairs,questionnaire:I,abridged:p.type==="attrakdiff_abridged"})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-sm text-slate-400",children:y.length===0?"Aucune réponse pour calculer les statistiques.":"Type de questionnaire non reconnu."})})}),P==="responses"&&e.jsx("div",{children:r?e.jsx("p",{className:"text-sm text-slate-400 py-8",children:"Chargement des réponses..."}):e.jsx(xt,{project:t,responses:s,onResponsesChanged:l})}),P==="form"&&e.jsxs("div",{className:"max-w-lg",children:[e.jsx(fe,{project:t,hasResponses:L.length>0,existingFolders:o,onSaved:a}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-200",children:e.jsx("button",{onClick:()=>m(!0),className:"text-sm text-danger-600 hover:text-danger-700 font-medium cursor-pointer",children:"Supprimer ce projet"})})]}),i&&e.jsx(mt,{title:"Supprimer le projet",message:`Le projet « ${t.name} » et toutes ses réponses seront archivés. Cette action est réversible via Notion.`,onConfirm:_,onCancel:()=>m(!1),loading:b})]})}const Lt={stats:"stats",responses:"responses",settings:"form"},Rt={stats:"stats",responses:"responses",form:"settings"};function de(t){const s=t.replace(/^#/,"");if(s===""||s==="presentation")return{mode:"detail",projectId:null,tab:"stats"};if(s==="new")return{mode:"new",projectId:null,tab:"stats"};if(s.startsWith("project/")){const r=s.slice(8),a=r.indexOf("/");if(a===-1)return{mode:"detail",projectId:r||null,tab:"stats"};const n=r.slice(0,a),l=r.slice(a+1),o=Lt[l]??"stats";return{mode:"detail",projectId:n||null,tab:o}}return{mode:"detail",projectId:null,tab:"stats"}}function Ht(t,s,r){if(t==="new")return"#new";if(s){const a=Rt[r]??"stats";return a==="stats"?`#project/${s}`:`#project/${s}/${a}`}return"#presentation"}function qt({onSyncStateChange:t}={}){const s=De(),r=Fe(),[a,n]=c.useState([]),[l,o]=c.useState(!0),[d,h]=c.useState(null),[i,m]=c.useState(null),[b,x]=c.useState("detail"),[v,A]=c.useState("stats"),P=c.useRef(b),F=c.useRef(null),E=c.useRef(v),M=c.useRef(de(s.hash)),{responses:U,loading:S,backgroundRefreshing:k,loadResponses:I,refreshCurrent:L,invalidate:C,clear:T}=_e(),R=c.useRef(null),G=c.useRef(!1),[y,p]=c.useState(null);c.useEffect(()=>{P.current=b},[b]),c.useEffect(()=>{F.current=i?.id??null},[i?.id]),c.useEffect(()=>{E.current=v},[v]);const _=c.useMemo(()=>y||(S||k?"syncing":"idle"),[S,k,y]);c.useEffect(()=>{t?.(_)},[_,t]),c.useEffect(()=>()=>{t?.("idle")},[t]);const u=c.useRef(!1);c.useEffect(()=>{const g=S||k;u.current&&!g&&(p("saved"),R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{p(null),R.current=null},2e3)),u.current=g},[S,k]),c.useEffect(()=>()=>{R.current&&clearTimeout(R.current)},[]),c.useEffect(()=>{let g=!1;return(async()=>{try{o(!0);const Q=ee=>{const{mode:$,projectId:Y,tab:we}=M.current;if($==="new")x("new");else if(Y){const te=ee.find(Pe=>Pe.id===Y);te&&(m(te),x("detail"),A(we),I(te.id))}},H=$e();if(H){if(g)return;n(H),Q(H);return}const D=await Be();if(g)return;n(D),Q(D)}catch(Q){g||h(Q instanceof Error?Q.message:"Erreur inconnue")}finally{g||o(!1)}})(),()=>{g=!0}},[]),c.useEffect(()=>{const{mode:g,projectId:N,tab:Q}=de(s.hash),H=P.current,D=F.current,ee=E.current;if(g==="new"){if(H==="new"&&D===null)return;G.current=!0,m(null),x("new"),T();return}if(N){const $=a.find(Y=>Y.id===N);if($){if(H==="detail"&&D===$.id&&ee===Q)return;G.current=!0,m($),x("detail"),A(Q),I($.id)}return}H==="detail"&&D===null||(G.current=!0,m(null),x("detail"),T())},[s.hash,a,I,T]),c.useEffect(()=>{if(G.current){G.current=!1;return}const g=Ht(b,i?.id??null,v),N=s.hash;g===N||g===""&&(N===""||N==="#")||r(`${s.pathname}${s.search}${g}`,{replace:!0})},[b,i?.id,v,s.pathname,s.search,s.hash,r]);const f=c.useMemo(()=>{const g=new Set;for(const N of a)N.folder?.trim()&&g.add(N.folder.trim());return Array.from(g).sort((N,Q)=>N.localeCompare(Q,"fr"))},[a]),q=()=>{m(null),x("new"),T()},K=c.useCallback(g=>{n(N=>{const Q=N.findIndex(D=>D.id===g.id);if(Q===-1){const D=[g,...N];return se(D),D}const H=[...N];return H[Q]=g,se(H),H}),m(g),x("detail"),I(g.id)},[I]),Se=c.useCallback(()=>{i&&(C(i.id),n(g=>{const N=g.filter(Q=>Q.id!==i.id);return se(N),N})),m(null),x("detail"),T()},[i,C,T]),Te=c.useCallback(()=>{L()},[L]);return e.jsx(ze,{children:l?e.jsx("div",{className:"flex items-center justify-center h-full py-32",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin mb-3"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Chargement des projets..."})]})}):d?e.jsx("div",{className:"flex items-center justify-center h-full py-32",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx("p",{className:"text-sm text-danger-600 mb-2",children:"Impossible de charger les projets."}),e.jsx("p",{className:"text-xs text-slate-400",children:d})]})}):b==="new"?e.jsxs("div",{className:"p-6 max-w-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-6",children:"Nouveau projet"}),e.jsx(fe,{project:null,hasResponses:!1,existingFolders:f,onSaved:K,onCancel:()=>x("detail")})]}):i?e.jsx(It,{project:i,responses:U,responsesLoading:S,onProjectUpdated:K,onProjectDeleted:Se,onResponsesChanged:Te,existingFolders:f,activeTab:v,onTabChange:A},i.id):e.jsxs("div",{className:"mx-auto max-w-3xl px-6 py-14",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Présentation"}),e.jsx("p",{className:"mt-3 text-sm leading-relaxed text-slate-600",children:"Cette section regroupe les questionnaires UX de l'équipe. Vous pouvez créer un projet, suivre ses réponses et accéder aux analyses directement depuis la liste."}),e.jsx("p",{className:"mt-2 text-sm leading-relaxed text-slate-500",children:"Sélectionnez un projet dans le panneau latéral pour ouvrir son détail."}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:q,className:"btn-primary-sm cursor-pointer",children:"Créer un projet"})}),a.length>0&&e.jsxs("p",{className:"mt-5 text-xs text-slate-400",children:[a.length," projet",a.length>1?"s":""," disponible",a.length>1?"s":"","."]})]})})}export{qt as DashboardPage};
