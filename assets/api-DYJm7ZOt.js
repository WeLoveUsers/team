const i="authToken",c="authUser";function w(e){return e==="admin"||e==="team"}function f(e){return e==="active"||e==="suspended"}function p(e){if(!e||typeof e!="object")return!1;const t=e;return typeof t.id=="string"&&typeof t.name=="string"&&typeof t.email=="string"&&w(t.role)&&f(t.status)&&typeof t.expiresAt=="string"&&(typeof t.createdAt=="string"||t.createdAt===null)&&(typeof t.updatedAt=="string"||t.updatedAt===null)}function u(){if(typeof window>"u")return null;const e=window.localStorage.getItem(i);return e&&e.length>0?e:null}function h(){if(typeof window>"u")return null;const e=window.localStorage.getItem(c);if(!e)return null;try{const t=JSON.parse(e);return p(t)?t:null}catch{return null}}function m(){const e=u(),t=h();return!e||!t?(l(),null):{token:e,user:t}}function $(e){typeof window>"u"||(window.localStorage.setItem(i,e.token),window.localStorage.setItem(c,JSON.stringify(e.user)))}function l(){typeof window>"u"||(window.localStorage.removeItem(i),window.localStorage.removeItem(c))}const n="https://outils-wlu.f-jaouali.workers.dev".replace(/\/+$/,"")||"http://localhost:8787";function s(e=!1){const t={};e&&(t["Content-Type"]="application/json");const r=u();return r&&(t.Authorization=`Bearer ${r}`),t}async function E(){const e=await fetch(`${n}/projects`,{headers:s()});if(!e.ok){const r=await e.text();throw new Error(`Erreur API /projects (${e.status}) : ${r}`)}return(await e.json()).projects??[]}async function j(e){const t=await fetch(`${n}/projects/${encodeURIComponent(e)}/responses`,{headers:s()});if(!t.ok){const o=await t.text();throw new Error(`Erreur API réponses (${t.status}) : ${o}`)}return(await t.json()).responses??[]}async function y(e){const t=await fetch(`${n}/projects`,{method:"POST",headers:s(!0),body:JSON.stringify(e)});if(!t.ok){const o=await t.text();throw new Error(`Erreur création projet (${t.status}) : ${o}`)}const r=await t.json();if(!r.project)throw new Error("Réponse création projet invalide");return r.project}async function x(e,t){const r=await fetch(`${n}/projects/${encodeURIComponent(e)}`,{method:"PATCH",headers:s(!0),body:JSON.stringify(t)});if(!r.ok){const a=await r.text();throw new Error(`Erreur mise à jour projet (${r.status}) : ${a}`)}const o=await r.json();if(!o.project)throw new Error("Réponse mise à jour projet invalide");return o.project}async function S(e){const t=await fetch(`${n}/projects/${encodeURIComponent(e)}`,{method:"DELETE",headers:s()});if(!t.ok){const r=await t.text();throw new Error(`Erreur suppression projet (${t.status}) : ${r}`)}}async function g(e,t){const r=await fetch(`${n}/projects/${encodeURIComponent(e)}/responses/${encodeURIComponent(t)}`,{method:"DELETE",headers:s()});if(!r.ok){const o=await r.text();throw new Error(`Erreur suppression réponse (${r.status}) : ${o}`)}}async function A(e,t){const r=await fetch(`${n}/projects/${encodeURIComponent(e)}/responses/${encodeURIComponent(t)}/recover`,{method:"POST",headers:s()});if(!r.ok){const o=await r.text();throw new Error(`Erreur récupération réponse (${r.status}) : ${o}`)}}async function k(){const e=await fetch(`${n}/document-templates`,{headers:s()});if(!e.ok){const r=await e.text();throw new Error(`Erreur modèles (${e.status}) : ${r}`)}return(await e.json()).templates??[]}async function R(e){const t=await fetch(`${n}/document-templates`,{method:"POST",headers:s(!0),body:JSON.stringify(e)});if(!t.ok){const o=await t.text();throw new Error(`Erreur création modèle (${t.status}) : ${o}`)}const r=await t.json();if(!r.template)throw new Error("Réponse création modèle invalide");return r.template}async function T(e){const t=await fetch(`${n}/document-templates/${encodeURIComponent(e)}`,{method:"DELETE",headers:s()});if(!t.ok){const r=await t.text();throw new Error(`Erreur suppression modèle (${t.status}) : ${r}`)}}async function U(e,t){const r=`${n}/login`,o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!o.ok){const d=await o.text();throw new Error(`Erreur de connexion (${o.status}) [${r}] : ${d}`)}const a=await o.json();if(!a.token||!a.user)throw new Error("Réponse de connexion invalide");return{token:a.token,user:a.user}}async function I(){const e=await fetch(`${n}/auth/me`,{headers:s()});if(!e.ok){const r=await e.text();throw new Error(`Erreur récupération utilisateur (${e.status}) : ${r}`)}const t=await e.json();if(!t.user)throw new Error("Réponse utilisateur invalide");return t.user}async function O(){const e=await fetch(`${n}/admin/users`,{headers:s()});if(!e.ok){const r=await e.text();throw new Error(`Erreur chargement utilisateurs (${e.status}) : ${r}`)}return(await e.json()).users??[]}async function P(e){const t=await fetch(`${n}/admin/users`,{method:"POST",headers:s(!0),body:JSON.stringify(e)});if(!t.ok){const o=await t.text();throw new Error(`Erreur création utilisateur (${t.status}) : ${o}`)}const r=await t.json();if(!r.user)throw new Error("Réponse création utilisateur invalide");return r.user}async function C(e,t){const r=await fetch(`${n}/admin/users/${encodeURIComponent(e)}`,{method:"PATCH",headers:s(!0),body:JSON.stringify(t)});if(!r.ok){const a=await r.text();throw new Error(`Erreur mise à jour utilisateur (${r.status}) : ${a}`)}const o=await r.json();if(!o.user)throw new Error("Réponse mise à jour utilisateur invalide");return o.user}async function b(e){const t=await fetch(`${n}/admin/users/${encodeURIComponent(e)}`,{method:"DELETE",headers:s()});if(!t.ok){const r=await t.text();throw new Error(`Erreur suppression utilisateur (${t.status}) : ${r}`)}}async function N(e){const t=await fetch(`${n}/public/submit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const r=await t.json().catch(()=>null);throw r?.closed?new Error("CLOSED"):new Error(r?.error??`Erreur enregistrement réponses (${t.status})`)}}async function v(e){const t=await fetch(`${n}/public/project-status/${encodeURIComponent(e)}`);if(!t.ok){const r=await t.text();throw new Error(`Erreur statut projet (${t.status}) : ${r}`)}return await t.json()}export{E as a,j as b,I as c,l as d,v as e,k as f,N as g,y as h,A as i,g as j,S as k,O as l,P as m,C as n,R as o,b as p,T as q,m as r,$ as s,U as t,x as u};
