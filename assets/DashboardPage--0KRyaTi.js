import{j as e,R as ze,C as re,a as We,P as Te,L as Xe,i as Ke,p as le,b as ie,B as ke,c as Ae,d as xe,e as Pe,S as Ye}from"./charts-nuwTBMFx.js";import{r as c,u as Ze,d as Je}from"./react-DGBwUpAK.js";import{u as Ee,h as et,i as tt,j as st,k as at}from"./api-DYJm7ZOt.js";import{c as oe,D as he,g as nt}from"./Sidebar-Bt-jCTJ7.js";import{D as Ce}from"./DeleteConfirmModal-IVzid9wc.js";import{u as rt,s as ue,g as lt,e as it}from"./App-Y1H6l1b5.js";import"./index-DplQk4st.js";function ot({children:t}){return e.jsx("div",{className:"h-full min-h-0 bg-cream flex",children:e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto",children:e.jsx("div",{className:"mx-auto h-full w-full max-w-5xl",children:t})})})}function Ie(t){if(navigator.clipboard?.writeText)return navigator.clipboard.writeText(t);const s=document.createElement("textarea");return s.value=t,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),Promise.resolve()}const ct=[{value:"SUS",label:"SUS"},{value:"DEEP",label:"DEEP"},{value:"UMUX",label:"UMUX"},{value:"UMUX (Lite)",label:"UMUX (Lite)"},{value:"UEQ",label:"UEQ"},{value:"UEQ-S",label:"UEQ-S"},{value:"AttrakDiff",label:"AttrakDiff"},{value:"AttrakDiff (abrégé)",label:"AttrakDiff (abrégé)"}],dt=[{value:"Ouvert",label:"Ouvert"},{value:"Fermé",label:"Fermé"}],ut=[{value:"Site Web",label:"Site Web"},{value:"Site E-Commerce",label:"Site E-Commerce"},{value:"Application mobile",label:"Application mobile"},{value:"Application tablette",label:"Application tablette"},{value:"Logiciel",label:"Logiciel"},{value:"Autre",label:"Autre"}];function Ge({project:t,hasResponses:s,existingFolders:a,onSaved:n,onCancel:r}){const[l,o]=c.useState(""),[d,u]=c.useState(""),[i,p]=c.useState("Ouvert"),[x,m]=c.useState(""),[S,v]=c.useState(""),[k,f]=c.useState(""),[T,P]=c.useState(""),[I,D]=c.useState(""),[O,H]=c.useState(!1),[G,C]=c.useState(null),[M,V]=c.useState(!1);c.useEffect(()=>{t?(o(t.name??""),u(t.questionnaireType??""),p(t.status??"Ouvert"),m(t.publicToken??""),v(t.folder??""),f(t.productType??""),P(t.productName??""),D(t.instructions??"")):(o(""),u(""),p("Ouvert"),m(""),v(""),f(""),P(""),D("")),C(null)},[t]),c.useEffect(()=>{if(t)return;const h=oe(d);h&&he[h]?D(he[h]):D("")},[d,t]);const q=()=>{if(x.trim())return x.trim();let h;if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")h=crypto.randomUUID();else{const U=new Uint8Array(16);crypto.getRandomValues(U),h=Array.from(U,Z=>Z.toString(16).padStart(2,"0")).join("")}const b=h.replace(/-/g,"").slice(0,12);return m(b),b},N=async h=>{h.preventDefault(),C(null),H(!0);try{if(!l.trim())throw new Error("Le nom du projet est requis.");if(!k)throw new Error("Le type de produit est requis.");if(!T.trim())throw new Error("Le nom du produit est requis.");const b={name:l.trim(),questionnaireType:d||null,status:i||null,publicToken:q(),folder:S.trim()||null,productType:k||null,productName:T.trim(),instructions:I||null},U=t?await Ee(t.id,b):await et(b);n(U)}catch(b){C(b instanceof Error?b.message:"Impossible d'enregistrer le projet")}finally{H(!1)}},g=x?`${window.location.origin}/p/${x}`:null,B=c.useMemo(()=>a.filter(h=>h.trim().length>0),[a]);return e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-name",className:"block text-sm font-medium text-ink mb-1",children:"Nom du projet"}),e.jsx("input",{id:"pf-name",type:"text",value:l,onChange:h=>o(h.target.value),required:!0,className:"field-input",placeholder:"Mon projet"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-product-name",className:"block text-sm font-medium text-ink mb-1",children:"Nom du produit évalué"}),e.jsx("input",{id:"pf-product-name",type:"text",value:T,onChange:h=>P(h.target.value),required:!0,className:"field-input",placeholder:"Ex : Google Maps, Mon application..."}),e.jsxs("p",{className:"text-xs text-taupe mt-1",children:["Utilisé dans les instructions et remplace ",e.jsx("code",{className:"bg-cream px-1 rounded border border-stone text-graphite",children:"@product_name"}),"."]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-type",className:"block text-sm font-medium text-ink mb-1",children:"Questionnaire"}),e.jsxs("select",{id:"pf-type",value:d,onChange:h=>u(h.target.value),disabled:s,required:!0,className:"field-select disabled:opacity-60",children:[e.jsx("option",{value:"",children:"Choisir..."}),ct.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))]}),s&&e.jsx("p",{className:"text-xs text-taupe mt-1",children:"Non modifiable (réponses existantes)"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-product-type",className:"block text-sm font-medium text-ink mb-1",children:"Type de produit"}),e.jsxs("select",{id:"pf-product-type",value:k,onChange:h=>f(h.target.value),required:!0,className:"field-select",children:[e.jsx("option",{value:"",children:"Choisir..."}),ut.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-status",className:"block text-sm font-medium text-ink mb-1",children:"Statut"}),e.jsx("select",{id:"pf-status",value:i,onChange:h=>p(h.target.value),required:!0,className:"field-select",children:dt.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-folder",className:"block text-sm font-medium text-ink mb-1",children:"Dossier"}),e.jsx("input",{id:"pf-folder",type:"text",value:S,onChange:h=>v(h.target.value),list:"pf-folder-suggestions",className:"field-input",placeholder:"Aucun dossier"}),B.length>0&&e.jsx("datalist",{id:"pf-folder-suggestions",children:B.map(h=>e.jsx("option",{value:h},h))}),e.jsx("p",{className:"text-xs text-taupe mt-1",children:"Saisissez un nom de dossier ou choisissez un existant. Laissez vide pour aucun dossier."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pf-instructions",className:"block text-sm font-medium text-ink mb-1",children:"Instructions aux répondants"}),e.jsx("textarea",{id:"pf-instructions",value:I,onChange:h=>D(h.target.value),rows:5,className:"field-textarea",placeholder:"Instructions affichées aux répondants en haut du questionnaire..."}),e.jsxs("p",{className:"text-xs text-taupe mt-1",children:[e.jsx("code",{className:"bg-cream px-1 rounded border border-stone text-graphite",children:"@product_name"})," sera remplacé par le nom du produit évalué."]}),T.trim()&&I.includes("@product_name")&&e.jsxs("div",{className:"mt-2 p-3 bg-cream rounded-brand border border-stone",children:[e.jsx("p",{className:"text-xs font-medium text-taupe mb-1",children:"Aperçu pour le répondant :"}),e.jsx("p",{className:"text-sm text-ink whitespace-pre-line",children:I.replace(/@product_name/g,T.trim())})]})]}),g&&e.jsxs("div",{className:"bg-cream rounded-brand border border-stone p-3",children:[e.jsx("p",{className:"text-xs font-medium text-taupe mb-1",children:"URL publique du questionnaire"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-xs text-flame bg-wash px-2 py-1 rounded flex-1 truncate",children:g}),e.jsx("button",{type:"button",onClick:()=>{Ie(g).then(()=>{V(!0),setTimeout(()=>V(!1),2e3)})},className:"shrink-0 text-xs text-flame hover:text-ink font-medium cursor-pointer transition-colors",children:M?"Copié !":"Copier"})]})]}),G&&e.jsx("div",{className:"text-sm text-berry bg-danger-50 px-3 py-2 rounded-lg",children:G}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:O,className:"btn-primary-sm disabled:opacity-60 disabled:cursor-not-allowed cursor-pointer",children:O?"Enregistrement...":t?"Mettre à jour":"Créer le projet"}),r&&e.jsx("button",{type:"button",onClick:r,className:"btn-secondary-sm cursor-pointer",children:"Annuler"})]})]})}const Q={mean:0,sd:0,ci90:[0,0],ci95:[0,0],ci99:[0,0]};function F(t,s=2){const a=10**s;return Math.round(t*a)/a}function L(t){return t.length===0?0:t.reduce((s,a)=>s+a,0)/t.length}function mt(t,s){if(t.length<=1)return 0;const a=s??L(t),n=t.reduce((r,l)=>r+(l-a)**2,0)/(t.length-1);return Math.sqrt(n)}function ae(t,s){const a=t<.5?t:1-t,n=t<.5?-1:1,r=Math.log(1/(a*a)),l=2.515517,o=.802853,d=.010328,u=1.432788,i=.189269,p=.001308,x=Math.sqrt(r),m=n*(x-(l+o*x+d*r)/(1+u*x+i*r+p*x*r));if(s>=1e3)return m;const S=(m**3+m)/(4*s),v=(5*m**5+16*m**3+3*m)/(96*s*s),k=(3*m**7+19*m**5+17*m**3-15*m)/(384*s**3),f=(79*m**9+776*m**7+1482*m**5-1920*m**3-945*m)/(92160*s**4);return m+S+v+k+f}function me(t){return ae(t,1e4)}function xt(t,s,a){const n=1-s/a;return t/Math.sqrt(s)*Math.sqrt(n)}function W(t,s,a,n,r){const l=xt(s,a,n),o=r*l;return[t-o,t+o]}function y(t,s){if(t.length===0||s===0)return{...Q};const a=L(t);if(s<=1||t.length<=1){const u=F(a);return{mean:u,sd:0,ci90:[u,u],ci95:[u,u],ci99:[u,u]}}const n=mt(t,a),r=1e100;let l,o,d;if(s>60){const u=me(.95),i=me(1-(1-.95)/2),p=me(1-(1-.99)/2);l=W(a,n,s,r,u),o=W(a,n,s,r,i),d=W(a,n,s,r,p)}else{const u=s-1,i=ae(1-(1-.9)/2,u),p=ae(1-(1-.95)/2,u),x=ae(1-(1-.99)/2,u);l=W(a,n,s,r,i),o=W(a,n,s,r,p),d=W(a,n,s,r,x)}return{mean:F(a),sd:F(n),ci90:[F(l[0]),F(l[1])],ci95:[F(o[0]),F(o[1])],ci99:[F(d[0]),F(d[1])]}}function pt(t){const s=(t.Q1??0)+(t.Q3??0)+(t.Q5??0)+(t.Q7??0)+(t.Q9??0),a=4-(t.Q2??0)+(4-(t.Q4??0))+(4-(t.Q6??0))+(4-(t.Q8??0))+(4-(t.Q10??0));return 2.5*(s+a)}function ht(t){return t>=84.1?"A+":t>=80.8?"A":t>=78.9?"A-":t>=77.2?"B+":t>=74.1?"B":t>=72.6?"B-":t>=71.1?"C+":t>=65?"C":t>=62.7?"C-":t>=51.7?"D":"F"}function Le(t){const s=[];for(const n of t)["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10"].some(l=>typeof n[l]!="number"||Number.isNaN(n[l]))||s.push(pt(n));if(s.length===0)return null;const a=y(s,s.length);return{...a,n:s.length,grade:ht(a.mean)}}const ft={G1:["Q1","Q2","Q3","Q4"],G2:["Q5","Q6","Q7"],G3:["Q8","Q9","Q10"],G4:["Q11","Q12","Q13"],G5:["Q14","Q15","Q16"],G6:["Q17","Q18","Q19"]},He={G1:"Contenu percu",G2:"Structure / AI",G3:"Navigation",G4:"Effort cognitif",G5:"Cohérence mise en page",G6:"Guidage visuel"},gt=new Set(["Q12","Q15"]);function bt(t,s){return typeof t!="number"||!Number.isFinite(t)||t===0||t<1||t>5?null:gt.has(s)?6-t:t}function Re(t){if(t.length===0)return null;const s={G1:[],G2:[],G3:[],G4:[],G5:[],G6:[]};let a=0;for(const n of t){let r=!1;for(const[l,o]of Object.entries(ft)){const d=[];for(const u of o){const i=bt(n[u],u);i!=null&&d.push(i)}d.length>0&&(s[l].push(L(d)),r=!0)}r&&a++}return a===0?null:{n:a,G1:s.G1.length>0?y(s.G1,s.G1.length):{...Q},G2:s.G2.length>0?y(s.G2,s.G2.length):{...Q},G3:s.G3.length>0?y(s.G3,s.G3.length):{...Q},G4:s.G4.length>0?y(s.G4,s.G4.length):{...Q},G5:s.G5.length>0?y(s.G5,s.G5.length):{...Q},G6:s.G6.length>0?y(s.G6,s.G6.length):{...Q}}}function yt(t){const s=t.Q1,a=t.Q2,n=t.Q3,r=t.Q4;return[s,a,n,r].some(l=>typeof l!="number"||Number.isNaN(l)||l<0||l>6)?0:100*(s+(6-a)+n+(6-r))/24}function we(t){if(t.length===0)return null;const s=[];for(const n of t)["Q1","Q2","Q3","Q4"].some(l=>typeof n[l]!="number"||Number.isNaN(n[l])||n[l]<0||n[l]>6)||s.push(yt(n));return s.length===0?null:{...y(s,s.length),n:s.length}}function jt(t){const s=t.Q1,a=t.Q3;return[s,a].some(n=>typeof n!="number"||Number.isNaN(n)||n<0||n>6)?0:100*(s+a)/12}function De(t){if(t.length===0)return null;const s=[],a=[],n=[];for(const l of t){const o=l.Q1,d=l.Q3;[o,d].some(u=>typeof u!="number"||Number.isNaN(u)||u<0||u>6)||(s.push(jt(l)),a.push(100/6*d),n.push(100/6*o))}if(s.length===0)return null;const r=s.length;return{n:r,global:y(s,r),usability:y(a,r),usefulness:y(n,r)}}const Nt={ATT:["Q1","Q12","Q14","Q16","Q24","Q25"],PERSP:["Q2","Q4","Q13","Q21"],EFF:["Q9","Q20","Q22","Q23"],DEP:["Q8","Q11","Q17","Q19"],STIM:["Q5","Q6","Q7","Q18"],NOV:["Q3","Q10","Q15","Q26"]},Qt={Q1:"right",Q2:"right",Q3:"left",Q4:"left",Q5:"left",Q6:"right",Q7:"right",Q8:"right",Q9:"left",Q10:"left",Q11:"right",Q12:"left",Q13:"right",Q14:"right",Q15:"right",Q16:"right",Q17:"left",Q18:"left",Q19:"left",Q20:"right",Q21:"left",Q22:"right",Q23:"left",Q24:"left",Q25:"left",Q26:"right"};function St(t,s){if(!Number.isFinite(t)||t<1||t>7)return null;const a=Qt[s];return a?a==="right"?t-4:4-t:null}function Oe(t){if(t.length===0)return null;const s={ATT:[],PERSP:[],EFF:[],DEP:[],STIM:[],NOV:[]},a=[];for(const r of t){const l=[];for(const[o,d]of Object.entries(Nt)){const u=[];for(const i of d){const p=r[i];if(typeof p!="number")continue;const x=St(p,i);x!=null&&(u.push(x),l.push(x))}u.length>0&&s[o].push(L(u))}l.length>0&&a.push(L(l))}return{n:a.length,ATT:s.ATT.length>0?y(s.ATT,s.ATT.length):{...Q},PERSP:s.PERSP.length>0?y(s.PERSP,s.PERSP.length):{...Q},EFF:s.EFF.length>0?y(s.EFF,s.EFF.length):{...Q},DEP:s.DEP.length>0?y(s.DEP,s.DEP.length):{...Q},STIM:s.STIM.length>0?y(s.STIM,s.STIM.length):{...Q},NOV:s.NOV.length>0?y(s.NOV,s.NOV.length):{...Q},GLOBAL:a.length>0?y(a,a.length):{...Q}}}const ee={ATT:"Attractivité",PERSP:"Clarté",EFF:"Efficacité",DEP:"Contrôlabilité",STIM:"Stimulation",NOV:"Nouveauté",GLOBAL:"Score global"},vt={PRAG:["Q1","Q2","Q3","Q4"],HED:["Q5","Q6","Q7","Q8"]},Tt={Q1:"right",Q2:"right",Q3:"right",Q4:"right",Q5:"right",Q6:"right",Q7:"right",Q8:"right"};function kt(t,s){if(!Number.isFinite(t)||t<1||t>7)return null;const a=Tt[s];return a?a==="right"?t-4:4-t:null}function Me(t){if(t.length===0)return null;const s={PRAG:[],HED:[]},a=[];for(const r of t){const l=[];for(const[o,d]of Object.entries(vt)){const u=[];for(const i of d){const p=r[i];if(typeof p!="number")continue;const x=kt(p,i);x!=null&&(u.push(x),l.push(x))}u.length>0&&s[o].push(L(u))}l.length>0&&a.push(L(l))}return{n:a.length,PRAG:s.PRAG.length>0?y(s.PRAG,s.PRAG.length):{...Q},HED:s.HED.length>0?y(s.HED,s.HED.length):{...Q},GLOBAL:a.length>0?y(a,a.length):{...Q}}}const te={PRAG:"Qualité pragmatique",HED:"Qualité hédonique",GLOBAL:"Score global"},K={QP:["QP1","QP2","QP3","QP4","QP5","QP6","QP7"],QHS:["QHS1","QHS2","QHS3","QHS4","QHS5","QHS6","QHS7"],QHI:["QHI1","QHI2","QHI3","QHI4","QHI5","QHI6","QHI7"],ATT:["ATT1","ATT2","ATT3","ATT4","ATT5","ATT6","ATT7"]},Y={QP:["QP2","QP3","QP5","QP6"],QHS:["QHS2","QHS5"],QHI:["QHI3","QHI4"],ATT:["ATT2","ATT5"]},At=new Set(["QP1","ATT1","QHS1","QP2","QHI2","QP3","ATT3","QHI3","QP5","QHI6","ATT5","QHS3","QHS4","ATT7","QHS7"]);function se(t,s){return typeof t!="number"||!Number.isFinite(t)||t<-3||t>3?null:At.has(s)?-t:t}function ne(t,s=!1){if(t.length===0)return null;const a=s?Y:K,n={QP:[],QHS:[],QHI:[],ATT:[],QH:[]};for(const l of t){const o=[],d=[],u=[],i=[];for(const x of a.QP){const m=se(l[x],x);m!=null&&o.push(m)}for(const x of a.QHS){const m=se(l[x],x);m!=null&&d.push(m)}for(const x of a.QHI){const m=se(l[x],x);m!=null&&u.push(m)}for(const x of a.ATT){const m=se(l[x],x);m!=null&&i.push(m)}o.length>0&&n.QP.push(L(o)),d.length>0&&n.QHS.push(L(d)),u.length>0&&n.QHI.push(L(u)),i.length>0&&n.ATT.push(L(i));const p=[...d,...u];p.length>0&&n.QH.push(L(p))}return{n:Math.max(n.QP.length,n.QHS.length,n.QHI.length,n.ATT.length),QP:n.QP.length>0?y(n.QP,n.QP.length):{...Q},QHS:n.QHS.length>0?y(n.QHS,n.QHS.length):{...Q},QHI:n.QHI.length>0?y(n.QHI,n.QHI.length):{...Q},ATT:n.ATT.length>0?y(n.ATT,n.ATT.length):{...Q},QH:n.QH.length>0?y(n.QH,n.QH.length):{...Q}}}const Pt={QP:"Qualité Pragmatique",QHS:"Qualité Hédonique - Stimulation",QHI:"Qualité Hédonique - Identification",ATT:"Attractivité",QH:"Qualité Hédonique"};function fe(t,s=!1){const a=s?[...Y.QP,...Y.QHS,...Y.QHI,...Y.ATT]:[...K.QP,...K.QHS,...K.QHI,...K.ATT],n={};if(t.length===0){for(const r of a)n[r]=0;return n}for(const r of a){const l=t.reduce((o,d)=>o+(d[r]??0),0);n[r]=F(l/t.length)}return n}function Et(t){const a=t.properties?.Payload;if(!a?.rich_text)return null;const n=a.rich_text.map(r=>r.plain_text||"").join("");if(!n)return null;try{return JSON.parse(n)}catch{return null}}function $(t,s){const a=t[s];return typeof a!="number"||Number.isNaN(a)||!Number.isFinite(a)?null:a}function Ct(t){switch(t){case"sus":return[{key:"score",label:"Score SUS",decimals:1},{key:"grade",label:"Note",kind:"grade"},...Array.from({length:10},(s,a)=>({key:`Q${a+1}`,label:`Q${a+1}`,kind:"integer"}))];case"deep":return[{key:"naCount",label:"N/A",kind:"integer"},{key:"G1",label:"G1",decimals:2},{key:"G2",label:"G2",decimals:2},{key:"G3",label:"G3",decimals:2},{key:"G4",label:"G4",decimals:2},{key:"G5",label:"G5",decimals:2},{key:"G6",label:"G6",decimals:2}];case"umux":return[{key:"score",label:"Score UMUX",decimals:1},{key:"Q1",label:"Q1",kind:"integer"},{key:"Q2",label:"Q2",kind:"integer"},{key:"Q3",label:"Q3",kind:"integer"},{key:"Q4",label:"Q4",kind:"integer"}];case"umux_lite":return[{key:"global",label:"Global",decimals:1},{key:"usefulness",label:"Utilité",decimals:1},{key:"usability",label:"Utilisabilité",decimals:1},{key:"Q1",label:"Q1",kind:"integer"},{key:"Q3",label:"Q3",kind:"integer"}];case"ueq":return[{key:"GLOBAL",label:"Global",decimals:2},{key:"ATT",label:"ATT",decimals:2},{key:"PERSP",label:"PERSP",decimals:2},{key:"EFF",label:"EFF",decimals:2},{key:"DEP",label:"DEP",decimals:2},{key:"STIM",label:"STIM",decimals:2},{key:"NOV",label:"NOV",decimals:2}];case"ueq_s":return[{key:"GLOBAL",label:"Global",decimals:2},{key:"PRAG",label:"PRAG",decimals:2},{key:"HED",label:"HED",decimals:2}];case"attrakdiff":case"attrakdiff_abridged":return[{key:"QP",label:"QP",decimals:2},{key:"QHS",label:"QHS",decimals:2},{key:"QHI",label:"QHI",decimals:2},{key:"ATT",label:"ATT",decimals:2},{key:"QH",label:"QH",decimals:2}];default:return[{key:"answered",label:"Réponses",kind:"integer"}]}}function It(t,s){if(!s)return{};switch(t){case"sus":{const a=Le([s]),n={};for(let r=1;r<=10;r+=1)n[`Q${r}`]=$(s,`Q${r}`);return a&&(n.score=a.mean,n.grade=a.grade),n}case"deep":{const a=Re([s]),r={naCount:Array.from({length:19},(l,o)=>$(s,`Q${o+1}`)).filter(l=>l===0).length};return a&&(r.G1=a.G1.mean,r.G2=a.G2.mean,r.G3=a.G3.mean,r.G4=a.G4.mean,r.G5=a.G5.mean,r.G6=a.G6.mean),r}case"umux":return{score:we([s])?.mean??null,Q1:$(s,"Q1"),Q2:$(s,"Q2"),Q3:$(s,"Q3"),Q4:$(s,"Q4")};case"umux_lite":{const a=De([s]);return{global:a?.global.mean??null,usefulness:a?.usefulness.mean??null,usability:a?.usability.mean??null,Q1:$(s,"Q1"),Q3:$(s,"Q3")}}case"ueq":{const a=Oe([s]);return a?{GLOBAL:a.GLOBAL.mean,ATT:a.ATT.mean,PERSP:a.PERSP.mean,EFF:a.EFF.mean,DEP:a.DEP.mean,STIM:a.STIM.mean,NOV:a.NOV.mean}:{}}case"ueq_s":{const a=Me([s]);return a?{GLOBAL:a.GLOBAL.mean,PRAG:a.PRAG.mean,HED:a.HED.mean}:{}}case"attrakdiff":{const a=ne([s],!1);return a?{QP:a.QP.mean,QHS:a.QHS.mean,QHI:a.QHI.mean,ATT:a.ATT.mean,QH:a.QH.mean}:{}}case"attrakdiff_abridged":{const a=ne([s],!0);return a?{QP:a.QP.mean,QHS:a.QHS.mean,QHI:a.QHI.mean,ATT:a.ATT.mean,QH:a.QH.mean}:{}}default:return{answered:Object.keys(s).length}}}function Gt(t,s){return t==null?"—":typeof t=="number"?s.kind==="integer"?String(Math.round(t)):t.toFixed(s.decimals??2):String(t)}const Lt={"A+":"bg-emerald-100 text-emerald-800",A:"bg-emerald-100 text-emerald-700","A-":"bg-green-100 text-green-700","B+":"bg-lime-100 text-lime-700",B:"bg-lime-100 text-lime-700","B-":"bg-yellow-100 text-yellow-700","C+":"bg-amber-100 text-amber-700",C:"bg-amber-100 text-amber-700","C-":"bg-orange-100 text-orange-700",D:"bg-red-100 text-red-700",F:"bg-red-200 text-red-800"};function Ht({project:t,responses:s,onResponsesChanged:a}){const[n,r]=c.useState(null),[l,o]=c.useState(null),d=async f=>{r(f);try{await st(t.id,f),a()}catch(T){console.error(T)}finally{r(null)}},u=async f=>{r(f);try{await tt(t.id,f),a()}catch(T){console.error(T)}finally{r(null)}},i=oe(t.questionnaireType),p=s.filter(f=>!f.archived),x=s.filter(f=>f.archived),m=c.useMemo(()=>Ct(i),[i]),S=m.length>0?m.length:1,v=c.useMemo(()=>p.map(f=>{const P=Et(f)?.answers??null;return{response:f,metrics:It(i,P)}}),[p,i]),k=async()=>{if(!l)return;await d(l.id),o(null)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-ink",children:"Réponses"}),e.jsxs("span",{className:"text-xs text-taupe bg-slate-100 px-2 py-0.5 rounded-full",children:[p.length," active",p.length>1?"s":""]})]}),s.length===0?e.jsx("p",{className:"text-sm text-taupe py-4",children:"Aucune réponse pour le moment."}):e.jsx("div",{className:"border border-stone rounded-brand overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-max text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-cream border-b border-stone",children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-taupe uppercase",children:"#"}),m.map(f=>e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-taupe uppercase whitespace-nowrap",children:f.label},f.key)),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-taupe uppercase",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-taupe uppercase",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100",children:[v.map((f,T)=>e.jsxs("tr",{className:"hover:bg-cream/50",children:[e.jsx("td",{className:"px-3 py-2 text-taupe",children:T+1}),m.map(P=>{const I=f.metrics[P.key];return P.kind==="grade"&&typeof I=="string"?e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`inline-block text-xs font-semibold px-1.5 py-0.5 rounded ${Lt[I]??"bg-slate-100 text-graphite"}`,children:I})},P.key):e.jsx("td",{className:"px-3 py-2 text-ink whitespace-nowrap",children:Gt(I??null,P)},P.key)}),e.jsx("td",{className:"px-3 py-2 text-taupe text-xs whitespace-nowrap",children:new Date(f.response.createdTime).toLocaleString("fr-FR")}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{onClick:()=>o(f.response),disabled:n===f.response.id,className:"text-xs text-berry hover:text-berry/80 font-medium cursor-pointer disabled:opacity-50 transition-colors",children:"Supprimer"})})]},f.response.id)),x.map((f,T)=>e.jsxs("tr",{className:"bg-cream/30 opacity-50",children:[e.jsx("td",{className:"px-3 py-2 text-taupe line-through",children:v.length+T+1}),e.jsx("td",{className:"px-3 py-2 text-taupe line-through",colSpan:S,children:"Supprimée"}),e.jsx("td",{className:"px-3 py-2 text-taupe text-xs line-through whitespace-nowrap",children:new Date(f.createdTime).toLocaleString("fr-FR")}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{onClick:()=>u(f.id),disabled:n===f.id,className:"text-xs text-flame hover:text-ink font-medium cursor-pointer disabled:opacity-50 transition-colors",children:"Récupérer"})})]},f.id))]})]})})}),l&&e.jsx(Ce,{title:"Supprimer la réponse",message:"Cette réponse sera archivée et retirée des statistiques.",onConfirm:k,onCancel:()=>o(null),loading:n===l.id})]})}const X=[{label:"Pire imaginable",max:25,color:"bg-red-500"},{label:"Mauvais",max:39,color:"bg-orange-500"},{label:"Acceptable",max:52,color:"bg-amber-400"},{label:"Bon",max:73,color:"bg-lime-400"},{label:"Excellent",max:86,color:"bg-green-500"},{label:"Meilleur imaginable",max:100,color:"bg-emerald-500"}];function Rt({score:t,grade:s}){const a=Math.max(0,Math.min(100,t)),n=a;return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Échelle SUS"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-3 rounded-full overflow-hidden",children:X.map((r,l)=>{const o=l>0?X[l-1].max:0,d=r.max-o;return e.jsx("div",{className:`${r.color}`,style:{width:`${d}%`}},r.label)})}),e.jsx("div",{className:"absolute -top-1 w-5 h-5 bg-white border-2 border-slate-800 rounded-full shadow-sm transform -translate-x-1/2",style:{left:`${n}%`}}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("span",{className:"text-[10px] text-slate-400",children:"0"}),X.map(r=>e.jsx("span",{className:"text-[10px] text-slate-400",style:{position:"absolute",left:`${r.max}%`,transform:"translateX(-50%)"},children:r.max},r.label))]}),e.jsx("div",{className:"flex mt-4 gap-px",children:X.map((r,l)=>{const o=l>0?X[l-1].max:0,d=r.max-o;return e.jsx("div",{style:{width:`${d}%`},className:"text-center",children:e.jsx("span",{className:"text-[9px] text-slate-500 leading-tight block",children:r.label})},r.label)})})]}),e.jsxs("div",{className:"text-center mt-3",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[a.toFixed(1)," / 100"]}),e.jsxs("span",{className:"text-xs text-slate-400 ml-2",children:["Note : ",s]})]})]})}const wt={"A+":"text-emerald-600",A:"text-emerald-600","A-":"text-green-600","B+":"text-lime-600",B:"text-lime-600","B-":"text-yellow-600","C+":"text-amber-600",C:"text-amber-600","C-":"text-orange-600",D:"text-red-600",F:"text-red-700"};function Dt({stats:t}){const[s,a]=c.useState("95"),n=s==="90"?t.ci90:s==="99"?t.ci99:t.ci95;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques SUS"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Score moyen"}),e.jsx("p",{className:"text-3xl font-bold text-primary-600",children:t.mean.toFixed(1)}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"/ 100"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Note"}),e.jsx("p",{className:`text-3xl font-bold ${wt[t.grade]??"text-slate-600"}`,children:t.grade}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"Sauro & Lewis (2012)"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Variabilité"}),e.jsxs("p",{className:"text-sm text-slate-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:"σ"})," = ",t.sd.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(r=>e.jsxs("button",{onClick:()=>a(r),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===r?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[r,"%"]},r))]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["[",n[0].toFixed(1)," ; ",n[1].toFixed(1),"]"]})]})]}),e.jsx(Rt,{score:t.mean,grade:t.grade})]})}function _({label:t,summary:s,unit:a="",showVariability:n=!0,ciLevel:r="95",colorClass:l="text-primary-600"}){const o=r==="90"?s.ci90:r==="99"?s.ci99:s.ci95;return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:t}),e.jsxs("p",{className:`text-2xl font-bold ${l}`,children:[s.mean.toFixed(2),a&&e.jsx("span",{className:"text-sm font-normal text-slate-400 ml-1",children:a})]}),n&&e.jsxs("div",{className:"mt-2 space-y-0.5",children:[e.jsxs("p",{className:"text-xs text-slate-500",children:[e.jsx("span",{className:"font-medium",children:"σ"})," = ",s.sd.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["IC",r,"% = [",o[0].toFixed(2)," ; ",o[1].toFixed(2),"]"]})]})]})}re.register(We,Te,Xe,Ke,le,ie);function Ot({stats:t}){const s=["G1","G2","G3","G4","G5","G6"],a=s.map(o=>He[o]),n=s.map(o=>t[o].mean),r={labels:a,datasets:[{label:"Score moyen",data:n,backgroundColor:"rgba(59, 130, 246, 0.15)",borderColor:"rgba(59, 130, 246, 0.8)",borderWidth:2,pointBackgroundColor:"rgba(59, 130, 246, 1)",pointBorderColor:"#fff",pointRadius:4,pointBorderWidth:2}]},l={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}},scales:{r:{beginAtZero:!0,min:0,max:5,ticks:{stepSize:1,font:{size:10},backdropColor:"transparent"},pointLabels:{font:{size:11},color:"#475569"},grid:{color:"rgba(148, 163, 184, 0.3)"},angleLines:{color:"rgba(148, 163, 184, 0.3)"}}}};return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Profil DEEP - 6 dimensions"}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx(ze,{data:r,options:l})})]})}const Mt=["text-blue-600","text-purple-600","text-teal-600","text-amber-600","text-pink-600","text-emerald-600"];function Ft({stats:t}){const[s,a]=c.useState("95"),n=["G1","G2","G3","G4","G5","G6"];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques DEEP"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(r=>e.jsxs("button",{onClick:()=>a(r),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===r?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[r,"%"]},r))]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:n.map((r,l)=>e.jsx(_,{label:He[r],summary:t[r],unit:"/ 5",ciLevel:s,colorClass:Mt[l]},r))}),e.jsx(Ot,{stats:t})]})}function Fe({score:t,max:s,label:a}){const n=Math.max(0,Math.min(100,t/s*100));return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:a}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-3 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-red-400 via-amber-400 via-50% to-emerald-500 transition-all duration-500",style:{width:`${n}%`}})}),e.jsx("div",{className:"absolute -top-1 w-5 h-5 bg-white border-2 border-slate-800 rounded-full shadow-sm transform -translate-x-1/2 transition-all duration-500",style:{left:`${n}%`}}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("span",{className:"text-[10px] text-slate-400",children:"0"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:s})]})]}),e.jsxs("p",{className:"text-center text-sm font-semibold text-slate-700 mt-2",children:[t.toFixed(1)," / ",s]})]})}function qt({stats:t}){const[s,a]=c.useState("95"),n=s==="90"?t.ci90:s==="99"?t.ci99:t.ci95;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UMUX"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Score moyen"}),e.jsx("p",{className:"text-3xl font-bold text-primary-600",children:t.mean.toFixed(1)}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"/ 100"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-1",children:"Variabilité"}),e.jsxs("p",{className:"text-sm text-slate-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:"σ"})," = ",t.sd.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(r=>e.jsxs("button",{onClick:()=>a(r),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===r?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[r,"%"]},r))]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["[",n[0].toFixed(1)," ; ",n[1].toFixed(1),"]"]})]})]}),e.jsx(Fe,{score:t.mean,max:100,label:"Score UMUX"})]})}function Ut({stats:t}){const[s,a]=c.useState("95");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UMUX-Lite"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(n=>e.jsxs("button",{onClick:()=>a(n),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===n?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[n,"%"]},n))]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(_,{label:"Score global",summary:t.global,unit:"/ 100",ciLevel:s,colorClass:"text-primary-600"}),e.jsx(_,{label:"Utilisabilité (Q3)",summary:t.usability,unit:"/ 100",ciLevel:s,colorClass:"text-teal-600"}),e.jsx(_,{label:"Utilité (Q1)",summary:t.usefulness,unit:"/ 100",ciLevel:s,colorClass:"text-purple-600"})]}),e.jsx(Fe,{score:t.global.mean,max:100,label:"Score global UMUX-Lite"})]})}re.register(Ae,xe,Pe,le,ie);function ge(t,s){return s==="90"?t.ci90:s==="99"?t.ci99:t.ci95}const _t={id:"mean-ci-error-bars",afterDatasetsDraw:t=>{const s=t.scales.x,a=t.getDatasetMeta(0),n=t.data.datasets[0];if(!s||!a||!n?.ciLow||!n?.ciHigh)return;const{ctx:r}=t,l=4,o=typeof s.min=="number"?s.min:-1/0,d=typeof s.max=="number"?s.max:1/0;r.save(),r.strokeStyle="#0f172a",r.lineWidth=1.5,a.data.forEach((u,i)=>{const p=n.ciLow?.[i],x=n.ciHigh?.[i];if(typeof p!="number"||typeof x!="number")return;const m=Math.max(o,Math.min(d,p)),S=Math.max(o,Math.min(d,x)),v=u.y,k=s.getPixelForValue(m),f=s.getPixelForValue(S);r.beginPath(),r.moveTo(k,v),r.lineTo(f,v),r.moveTo(k,v-l),r.lineTo(k,v+l),r.moveTo(f,v-l),r.lineTo(f,v+l),r.stroke()}),r.restore()}};function qe({title:t,rows:s,ciLevel:a,xMin:n=-3,xMax:r=3}){const l=s.map(i=>ge(i.summary,a)),o={labels:s.map(i=>i.label),datasets:[{label:"Moyenne",data:s.map(i=>i.summary.mean),backgroundColor:s.map(i=>i.color),borderWidth:0,borderRadius:4,maxBarThickness:28,ciLow:l.map(i=>i[0]),ciHigh:l.map(i=>i[1])}]},d={responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1},tooltip:{callbacks:{label:i=>{const p=s[i.dataIndex];if(!p)return"";const[x,m]=ge(p.summary,a);return`Moyenne ${p.summary.mean.toFixed(2)} | IC${a}% [${x.toFixed(2)} ; ${m.toFixed(2)}]`}}}},scales:{x:{min:n,max:r,ticks:{stepSize:1,font:{size:10}},grid:{color:"rgba(148, 163, 184, 0.2)"}},y:{ticks:{font:{size:11}},grid:{display:!1}}}},u=Math.max(220,s.length*42);return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:t}),e.jsx("div",{style:{height:`${u}px`},children:e.jsx(ke,{data:o,options:d,plugins:[_t]},a)}),e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Barres: moyenne. Traits noirs: intervalle de confiance (IC",a,"%, tronqué a [",n,"; ",r,"] si besoin)."]})]})}const be={GLOBAL:"text-primary-600",ATT:"text-amber-600",PERSP:"text-blue-600",EFF:"text-teal-600",DEP:"text-indigo-600",STIM:"text-pink-600",NOV:"text-purple-600"},ye={GLOBAL:"rgba(2, 132, 199, 0.75)",ATT:"rgba(217, 119, 6, 0.75)",PERSP:"rgba(37, 99, 235, 0.75)",EFF:"rgba(13, 148, 136, 0.75)",DEP:"rgba(79, 70, 229, 0.75)",STIM:"rgba(219, 39, 119, 0.75)",NOV:"rgba(147, 51, 234, 0.75)"},je=["ATT","PERSP","EFF","DEP","STIM","NOV"];function Bt({stats:t}){const[s,a]=c.useState("95");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UEQ"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(n=>e.jsxs("button",{onClick:()=>a(n),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===n?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[n,"%"]},n))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-primary-700",children:"Score global"}),e.jsx("div",{className:"max-w-sm",children:e.jsx(_,{label:ee.GLOBAL,summary:t.GLOBAL,ciLevel:s,colorClass:be.GLOBAL})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-600",children:"Dimensions detaillees"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3",children:je.map(n=>e.jsx(_,{label:ee[n],summary:t[n],ciLevel:s,colorClass:be[n]},n))})]}),e.jsx(qe,{title:"Profil UEQ - Moyennes et IC",ciLevel:s,rows:[{label:ee.GLOBAL,summary:t.GLOBAL,color:ye.GLOBAL},...je.map(n=>({label:ee[n],summary:t[n],color:ye[n]}))],xMin:-3,xMax:3}),e.jsx("p",{className:"text-xs text-slate-500",children:"Échelle UEQ normalisée de -3 (négatif) à +3 (positif)."})]})}const Ne={GLOBAL:"text-primary-600",PRAG:"text-teal-600",HED:"text-pink-600"},Qe={GLOBAL:"rgba(2, 132, 199, 0.75)",PRAG:"rgba(13, 148, 136, 0.75)",HED:"rgba(219, 39, 119, 0.75)"},Se=["PRAG","HED"];function $t({stats:t}){const[s,a]=c.useState("95");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Statistiques UEQ-S"}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(n=>e.jsxs("button",{onClick:()=>a(n),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${s===n?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[n,"%"]},n))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-primary-700",children:"Score global"}),e.jsx("div",{className:"max-w-sm",children:e.jsx(_,{label:te.GLOBAL,summary:t.GLOBAL,ciLevel:s,colorClass:Ne.GLOBAL})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-600",children:"Dimensions detaillees"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Se.map(n=>e.jsx(_,{label:te[n],summary:t[n],ciLevel:s,colorClass:Ne[n]},n))})]}),e.jsx(qe,{title:"Profil UEQ-S - Moyennes et IC",ciLevel:s,rows:[{label:te.GLOBAL,summary:t.GLOBAL,color:Qe.GLOBAL},...Se.map(n=>({label:te[n],summary:t[n],color:Qe[n]}))],xMin:-3,xMax:3}),e.jsx("p",{className:"text-xs text-slate-500",children:"Échelle UEQ-S normalisée de -3 (négatif) à +3 (positif)."})]})}re.register(xe,Te,le,ie);function Vt({qp:t,qh:s}){const a={datasets:[{label:"Produit",data:[{x:t,y:s}],backgroundColor:"rgba(59, 130, 246, 1)",borderColor:"#fff",borderWidth:2,pointRadius:8,pointHoverRadius:10}]},n={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{label:r=>`QP: ${(r.parsed.x??0).toFixed(2)}, QH: ${(r.parsed.y??0).toFixed(2)}`}}},scales:{x:{title:{display:!0,text:"Qualité Pragmatique (QP)",font:{size:11}},min:-3,max:3,grid:{color:"rgba(148, 163, 184, 0.2)"},ticks:{font:{size:10}}},y:{title:{display:!0,text:"Qualité Hédonique (QH)",font:{size:11}},min:-3,max:3,grid:{color:"rgba(148, 163, 184, 0.2)"},ticks:{font:{size:10}}}}};return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Portfolio AttrakDiff"}),e.jsx(Ye,{data:a,options:n})]})}re.register(Ae,xe,Pe,le,ie);const zt={QP:"rgba(59, 130, 246, 0.7)",QHS:"rgba(168, 85, 247, 0.7)",QHI:"rgba(236, 72, 153, 0.7)",ATT:"rgba(245, 158, 11, 0.7)"};function Wt(t){return t.startsWith("QP")?"QP":t.startsWith("QHS")?"QHS":t.startsWith("QHI")?"QHI":t.startsWith("ATT")?"ATT":"QP"}function Xt({wordPairs:t,questionnaire:s}){const a=s.questions.filter(i=>i.type==="bipolar"),n=a.map(i=>`${i.leftFr} / ${i.rightFr}`),r=a.map(i=>t[i.id]??0),l=a.map(i=>zt[Wt(i.id)]??"rgba(100,100,100,0.5)"),o={labels:n,datasets:[{label:"Moyenne",data:r,backgroundColor:l,borderWidth:0,borderRadius:3}]},d={responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{min:-3,max:3,grid:{color:"rgba(148, 163, 184, 0.2)"},ticks:{font:{size:10}}},y:{ticks:{font:{size:10}},grid:{display:!1}}}},u=Math.max(300,a.length*28);return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-3",children:"Paires de mots - Moyennes"}),e.jsx("div",{style:{height:`${u}px`},children:e.jsx(ke,{data:o,options:d})})]})}const Kt={QP:"text-blue-600",QHS:"text-purple-600",QHI:"text-pink-600",ATT:"text-amber-600",QH:"text-teal-600"};function Yt({stats:t,wordPairs:s,questionnaire:a,abridged:n}){const[r,l]=c.useState("95"),o=["QP","QHS","QHI","ATT","QH"];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-900",children:["Statistiques AttrakDiff",n?" (abrégé)":""]}),e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full",children:["n = ",t.n]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"IC"}),["90","95","99"].map(d=>e.jsxs("button",{onClick:()=>l(d),className:`text-xs px-1.5 py-0.5 rounded cursor-pointer transition-colors ${r===d?"bg-primary-100 text-primary-700 font-medium":"text-slate-400 hover:text-slate-600"}`,children:[d,"%"]},d))]})]}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:o.map(d=>e.jsx(_,{label:Pt[d],summary:t[d],ciLevel:r,colorClass:Kt[d]},d))}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Vt,{qp:t.QP.mean,qh:t.QH.mean}),e.jsx(Xt,{wordPairs:s,questionnaire:a})]})]})}function Ue(t){const a=t.properties?.Payload;if(!a?.rich_text)return null;const n=a.rich_text.map(r=>r.plain_text||"").join("");if(!n)return null;try{return JSON.parse(n)}catch{return null}}function Zt(t,s){if(!oe(t.questionnaireType))return;const n=[],r=s.filter(i=>!i.archived);for(const i of r){const p=Ue(i);if(!p?.answers)continue;if(n.length===0){const S=["Date",...Object.keys(p.answers)];n.push(S)}const x=new Date(i.createdTime).toLocaleString("fr-FR"),m=Object.values(p.answers).map(S=>String(S??""));n.push([x,...m])}if(n.length===0)return;const l=n.map(i=>i.map(p=>`"${p.replace(/"/g,'""')}"`).join(";")).join(`
`),o=new Blob(["\uFEFF"+l],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(o),u=document.createElement("a");u.href=d,u.download=`${t.name?.replace(/[^a-zA-Z0-9]/g,"_")||"export"}_reponses.csv`,u.click(),URL.revokeObjectURL(d)}function Jt({project:t,responses:s,responsesLoading:a,onProjectUpdated:n,onProjectDeleted:r,onResponsesChanged:l,existingFolders:o=[],activeTab:d,onTabChange:u}){const[i,p]=c.useState(!1),[x,m]=c.useState(!1),[S,v]=c.useState("stats"),k=d??S,f=u??v,[T,P]=c.useState(!1),[I,D]=c.useState(!1),O=oe(t.questionnaireType),H=O?nt(O):null,G=s.filter(b=>!b.archived),C=t.status==="Ouvert",M=t.publicToken?`${window.location.origin}/p/${t.publicToken}`:null,V=async()=>{P(!0);try{const b=C?"Fermé":"Ouvert",U=await Ee(t.id,{name:t.name,status:b});n(U)}catch(b){console.error(b)}finally{P(!1)}},q=()=>{M&&Ie(M).then(()=>{D(!0),setTimeout(()=>D(!1),2e3)})},N=c.useMemo(()=>G.map(Ue).filter(b=>!!b?.answers).map(b=>b.answers),[G]),g=c.useMemo(()=>{if(!O||N.length===0)return null;switch(O){case"sus":return{type:"sus",data:Le(N)};case"deep":return{type:"deep",data:Re(N)};case"umux":return{type:"umux",data:we(N)};case"umux_lite":return{type:"umux_lite",data:De(N)};case"ueq":return{type:"ueq",data:Oe(N)};case"ueq_s":return{type:"ueq_s",data:Me(N)};case"attrakdiff":return{type:"attrakdiff",data:ne(N,!1),wordPairs:fe(N,!1)};case"attrakdiff_abridged":return{type:"attrakdiff_abridged",data:ne(N,!0),wordPairs:fe(N,!0)};default:return null}},[O,N]),B=async()=>{m(!0);try{await at(t.id),r()}catch(b){console.error(b)}finally{m(!1),p(!1)}},h=[{id:"stats",label:"Résultats"},{id:"responses",label:`Réponses (${G.length})`},{id:"form",label:"Paramètres"}];return e.jsxs("div",{className:"p-6 max-w-5xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-ink",children:t.name||"(Sans titre)"}),G.length>0&&e.jsxs("button",{onClick:()=>Zt(t,s),className:"text-xs text-flame hover:text-ink font-medium cursor-pointer flex items-center gap-1 shrink-0 transition-colors",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Exporter CSV"]})]}),e.jsxs("div",{className:"flex items-center gap-2.5 mt-2 flex-wrap",children:[e.jsxs("button",{onClick:V,disabled:T,className:`inline-flex items-center gap-1.5 text-xs font-medium pl-2 pr-2.5 py-1 rounded-full transition-colors cursor-pointer disabled:opacity-60 disabled:cursor-wait ${C?"bg-success-50 text-success-700 hover:bg-success-100":"bg-slate-100 text-taupe hover:bg-slate-200"}`,children:[e.jsxs("span",{className:"relative flex h-4 w-7 items-center",children:[e.jsx("span",{className:`absolute inset-0 rounded-full transition-colors ${C?"bg-success-400":"bg-slate-300"}`}),e.jsx("span",{className:`absolute top-0.5 h-3 w-3 rounded-full bg-white shadow-sm transition-transform ${C?"translate-x-3.5":"translate-x-0.5"}`})]}),T?"...":C?"Ouvert":"Fermé"]}),t.questionnaireType&&e.jsx("span",{className:"text-xs font-medium text-taupe bg-slate-100 px-2 py-1 rounded-full",children:t.questionnaireType}),M&&e.jsx("span",{className:"w-px h-4 bg-stone"}),M&&e.jsxs("div",{className:"inline-flex items-center gap-1.5 min-w-0",children:[e.jsx("code",{className:"text-[11px] text-taupe truncate max-w-[280px]",children:M}),e.jsx("button",{onClick:q,className:"inline-flex items-center gap-1 text-xs text-flame hover:text-ink font-medium cursor-pointer shrink-0 transition-colors",children:I?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 text-sage",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-sage",children:"Copié"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copier"]})})]})]})]}),e.jsx("div",{className:"border-b border-stone mb-6",children:e.jsx("nav",{className:"flex gap-6",children:h.map(b=>e.jsx("button",{onClick:()=>f(b.id),className:`pb-2.5 text-sm font-medium border-b-2 transition-colors cursor-pointer ${k===b.id?"border-flame text-flame":"border-transparent text-taupe hover:text-ink"}`,children:b.label},b.id))})}),k==="stats"&&e.jsx("div",{children:a?e.jsx("p",{className:"text-sm text-taupe py-8",children:"Chargement des résultats..."}):g?.data?e.jsxs(e.Fragment,{children:[g.type==="sus"&&g.data&&e.jsx(Dt,{stats:g.data}),g.type==="deep"&&g.data&&e.jsx(Ft,{stats:g.data}),g.type==="umux"&&g.data&&e.jsx(qt,{stats:g.data}),g.type==="umux_lite"&&g.data&&e.jsx(Ut,{stats:g.data}),g.type==="ueq"&&g.data&&e.jsx(Bt,{stats:g.data}),g.type==="ueq_s"&&g.data&&e.jsx($t,{stats:g.data}),(g.type==="attrakdiff"||g.type==="attrakdiff_abridged")&&g.data&&H&&e.jsx(Yt,{stats:g.data,wordPairs:g.wordPairs,questionnaire:H,abridged:g.type==="attrakdiff_abridged"})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-sm text-taupe",children:N.length===0?"Aucune réponse pour calculer les statistiques.":"Type de questionnaire non reconnu."})})}),k==="responses"&&e.jsx("div",{children:a?e.jsx("p",{className:"text-sm text-taupe py-8",children:"Chargement des réponses..."}):e.jsx(Ht,{project:t,responses:s,onResponsesChanged:l})}),k==="form"&&e.jsxs("div",{className:"max-w-lg",children:[e.jsx(Ge,{project:t,hasResponses:G.length>0,existingFolders:o,onSaved:n}),e.jsx("div",{className:"mt-8 pt-6 border-t border-stone",children:e.jsx("button",{onClick:()=>p(!0),className:"text-sm text-berry hover:text-berry/80 font-medium cursor-pointer transition-colors",children:"Supprimer ce projet"})})]}),i&&e.jsx(Ce,{title:"Supprimer le projet",message:`Le projet « ${t.name} » et toutes ses réponses seront archivés. Cette action est réversible via Notion.`,onConfirm:B,onCancel:()=>p(!1),loading:x})]})}const es={stats:"stats",responses:"responses",settings:"form"},ts={stats:"stats",responses:"responses",form:"settings"};function ve(t){const s=t.replace(/^#/,"");if(s===""||s==="presentation")return{mode:"detail",projectId:null,tab:"stats"};if(s==="new")return{mode:"new",projectId:null,tab:"stats"};if(s.startsWith("project/")){const a=s.slice(8),n=a.indexOf("/");if(n===-1)return{mode:"detail",projectId:a||null,tab:"stats"};const r=a.slice(0,n),l=a.slice(n+1),o=es[l]??"stats";return{mode:"detail",projectId:r||null,tab:o}}return{mode:"detail",projectId:null,tab:"stats"}}function ss(t,s,a){if(t==="new")return"#new";if(s){const n=ts[a]??"stats";return n==="stats"?`#project/${s}`:`#project/${s}/${n}`}return"#presentation"}function ds({onSyncStateChange:t}={}){const s=Ze(),a=Je(),[n,r]=c.useState([]),[l,o]=c.useState(!0),[d,u]=c.useState(null),[i,p]=c.useState(null),[x,m]=c.useState("detail"),[S,v]=c.useState("stats"),[k,f]=c.useState(!1),T=c.useRef(x),P=c.useRef(null),I=c.useRef(S),D=c.useRef(ve(s.hash)),{responses:O,loading:H,backgroundRefreshing:G,loadResponses:C,refreshCurrent:M,invalidate:V,clear:q}=rt(),N=c.useRef(null),g=c.useRef(!1),[B,h]=c.useState(null);c.useEffect(()=>{T.current=x},[x]),c.useEffect(()=>{P.current=i?.id??null},[i?.id]),c.useEffect(()=>{I.current=S},[S]);const b=c.useMemo(()=>B||(H||G?"syncing":"idle"),[H,G,B]);c.useEffect(()=>{t?.(b)},[b,t]),c.useEffect(()=>()=>{t?.("idle")},[t]);const U=c.useRef(!1);c.useEffect(()=>{const j=H||G;U.current&&!j&&(h("saved"),N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{h(null),N.current=null},2e3)),U.current=j},[H,G]),c.useEffect(()=>()=>{N.current&&clearTimeout(N.current)},[]),c.useEffect(()=>{let j=!1;return(async()=>{try{o(!0);const E=ce=>{const{mode:z,projectId:J,tab:$e}=D.current;if(z==="new")m("new");else if(J){const de=ce.find(Ve=>Ve.id===J);de&&(p(de),m("detail"),v($e),C(de.id))}},R=lt();if(R){if(j)return;r(R),E(R);return}const w=await it();if(j)return;r(w),E(w)}catch(E){j||u(E instanceof Error?E.message:"Erreur inconnue")}finally{j||(g.current=!0,f(!0),o(!1))}})(),()=>{j=!0}},[]),c.useEffect(()=>{const{mode:j,projectId:A,tab:E}=ve(s.hash),R=T.current,w=P.current,ce=I.current;if(j==="new"){if(R==="new"&&w===null)return;g.current=!0,p(null),m("new"),q();return}if(A){const z=n.find(J=>J.id===A);if(z){if(R==="detail"&&w===z.id&&ce===E)return;g.current=!0,p(z),m("detail"),v(E),C(z.id)}return}R==="detail"&&w===null||(g.current=!0,p(null),m("detail"),q())},[s.hash,n,C,q]),c.useEffect(()=>{if(!k)return;if(g.current){g.current=!1;return}const j=ss(x,i?.id??null,S),A=s.hash;j===A||j===""&&(A===""||A==="#")||a(`${s.pathname}${s.search}${j}`,{replace:!0})},[x,i?.id,S,s.pathname,s.search,s.hash,a,k]);const Z=c.useMemo(()=>{const j=new Set;for(const A of n)A.folder?.trim()&&j.add(A.folder.trim());return Array.from(j).sort((A,E)=>A.localeCompare(E,"fr"))},[n]),pe=c.useCallback(j=>{r(A=>{const E=A.findIndex(w=>w.id===j.id);if(E===-1){const w=[j,...A];return ue(w),w}const R=[...A];return R[E]=j,ue(R),R}),p(j),m("detail"),C(j.id)},[C]),_e=c.useCallback(()=>{i&&(V(i.id),r(j=>{const A=j.filter(E=>E.id!==i.id);return ue(A),A})),p(null),m("detail"),q()},[i,V,q]),Be=c.useCallback(()=>{M()},[M]);return e.jsx(ot,{children:l?e.jsx("div",{className:"flex items-center justify-center h-full py-32",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin mb-3"}),e.jsx("p",{className:"text-sm text-taupe",children:"Chargement des projets..."})]})}):d?e.jsx("div",{className:"flex items-center justify-center h-full py-32",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx("p",{className:"text-sm text-berry mb-2",children:"Impossible de charger les projets."}),e.jsx("p",{className:"text-xs text-taupe",children:d})]})}):x==="new"?e.jsxs("div",{className:"p-6 max-w-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-ink mb-6",children:"Nouveau projet"}),e.jsx(Ge,{project:null,hasResponses:!1,existingFolders:Z,onSaved:pe,onCancel:()=>m("detail")})]}):i?e.jsx(Jt,{project:i,responses:O,responsesLoading:H,onProjectUpdated:pe,onProjectDeleted:_e,onResponsesChanged:Be,existingFolders:Z,activeTab:S,onTabChange:v},i.id):e.jsx("div",{className:"flex items-center justify-center h-full py-32",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx("p",{className:"text-sm text-graphite",children:"Sélectionnez un projet dans le panneau latéral ou créez-en un nouveau."}),n.length>0&&e.jsxs("p",{className:"mt-3 text-xs text-taupe",children:[n.length," projet",n.length>1?"s":""," disponible",n.length>1?"s":"","."]})]})})})}export{ds as DashboardPage};
