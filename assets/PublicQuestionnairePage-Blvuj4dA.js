import{j as e}from"./charts-nuwTBMFx.js";import{f as Y,r}from"./react-DGBwUpAK.js";import{g as G,c as J}from"./Sidebar-Bt-jCTJ7.js";import{e as K,g as X}from"./api-DYJm7ZOt.js";const Z={"Site Web":"ce site web","Site E-Commerce":"ce site e-commerce","Application mobile":"cette application mobile","Application tablette":"cette application tablette",Logiciel:"ce logiciel",Autre:"ce produit"};function q(l){return l?Z[l]??"ce produit":"ce produit"}function ee(l,n){return l.map(s=>s.type==="likert"?{...s,textFr:s.textFr.replace(/@product_type/g,n)}:{...s,leftFr:s.leftFr.replace(/@product_type/g,n),rightFr:s.rightFr.replace(/@product_type/g,n)})}function te({q:l,index:n,value:s,onChange:u,showError:c}){return e.jsxs("div",{className:`py-5 ${n>0?"border-t border-slate-100":""}`,children:[e.jsxs("p",{className:`text-sm font-medium mb-3 ${c&&s===null?"text-danger-600":"text-slate-800"}`,children:[e.jsxs("span",{className:"text-slate-400 mr-2",children:[n+1,"."]}),l.textFr]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.scale.map(o=>e.jsx("button",{type:"button",onClick:()=>u(o.value),className:`px-3 py-1.5 text-xs rounded-full border transition-all cursor-pointer ${s===o.value?"bg-primary-600 text-white border-primary-600 shadow-sm":"bg-white text-slate-600 border-slate-300 hover:border-primary-300 hover:bg-primary-50"}`,children:o.labelFr},o.value))}),c&&s===null&&e.jsx("p",{className:"text-xs text-danger-500 mt-1.5",children:"Veuillez répondre à cette question."})]})}function se({q:l,index:n,value:s,onChange:u,showError:c}){return e.jsxs("div",{className:`py-5 ${n>0?"border-t border-slate-100":""}`,children:[e.jsxs("p",{className:`text-sm font-medium mb-3 ${c&&s===null?"text-danger-600":"text-slate-800"}`,children:[e.jsxs("span",{className:"text-slate-400 mr-2",children:[n+1,"."]}),l.textFr]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.scale.map(o=>e.jsx("button",{type:"button",onClick:()=>u(o.value),className:`px-3 py-1.5 text-xs rounded-full border transition-all cursor-pointer ${s===o.value?"bg-primary-600 text-white border-primary-600 shadow-sm":"bg-white text-slate-600 border-slate-300 hover:border-primary-300 hover:bg-primary-50"}`,children:o.labelFr},o.value)),e.jsx("button",{type:"button",onClick:()=>u(0),className:`px-3 py-1.5 text-xs rounded-full border transition-all cursor-pointer ${s===0?"bg-slate-600 text-white border-slate-600 shadow-sm":"bg-white text-slate-400 border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:"Non applicable"})]}),c&&s===null&&e.jsx("p",{className:"text-xs text-danger-500 mt-1.5",children:"Veuillez répondre à cette question."})]})}function re({q:l,index:n,value:s,onChange:u,showError:c,hideValueLabels:o}){return e.jsxs("div",{className:`py-5 ${n>0?"border-t border-slate-100":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:`text-sm font-medium ${c&&s===null?"text-danger-600":"text-slate-600"}`,children:l.leftFr}),e.jsx("span",{className:`text-sm font-medium text-right ${c&&s===null?"text-danger-600":"text-slate-600"}`,children:l.rightFr})]}),e.jsx("div",{className:"flex items-center justify-center gap-1.5",children:l.scaleValues.map(d=>e.jsx("button",{type:"button",onClick:()=>u(d),"aria-label":`Choisir ${d}`,className:`w-9 h-9 rounded-full border-2 text-xs font-medium transition-all cursor-pointer flex items-center justify-center ${s===d?"bg-primary-600 text-white border-primary-600 shadow-sm scale-110":"bg-white text-slate-500 border-slate-300 hover:border-primary-300 hover:bg-primary-50"}`,children:o?e.jsx("span",{className:"sr-only",children:d}):d},d))}),c&&s===null&&e.jsx("p",{className:"text-xs text-danger-500 mt-1.5 text-center",children:"Veuillez répondre à cette question."})]})}function oe(){const n=Y().projectToken,[s,u]=r.useState({}),[c,o]=r.useState(!1),[d,w]=r.useState(!1),[v,p]=r.useState(null),[b,S]=r.useState(!1),[_,Q]=r.useState(!1),[m,I]=r.useState(null),[T,z]=r.useState(null),[k,A]=r.useState(null),[C,B]=r.useState(null),[j,M]=r.useState(null),[D,F]=r.useState(!1),[H,L]=r.useState(!0),[R,g]=r.useState(!1);r.useEffect(()=>{if(!n){L(!1),g(!0);return}let t=!1;return(async()=>{try{const a=await K(n);if(t)return;z(a.name),A(a.productType),B(a.productName),M(a.instructions);const E=J(a.questionnaireType);E?I(E):g(!0),a.status==="Fermé"&&F(!0)}catch{t||g(!0)}finally{t||L(!1)}})(),()=>{t=!0}},[n]);const x=r.useMemo(()=>m?G(m):null,[m]),h=r.useMemo(()=>{if(!x)return[];const t=q(k);return ee(x.questions,t)},[x,k]),P=r.useMemo(()=>{if(!j)return null;const t=C||"";return j.replace(/@product_name/g,t)},[j,C]);if(H)return e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})});if(R||!x)return e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-brand border border-stone p-8 text-center max-w-sm",children:e.jsx("p",{className:"text-slate-700",children:"Questionnaire introuvable."})})});if(D)return e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white rounded-brand border border-stone p-8 text-center max-w-sm",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Questionnaire fermé"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Ce questionnaire n'est plus disponible."})]})});const f=h.length,y=h.filter(t=>s[t.id]!=null).length,V=y===f,N=(t,i)=>{u(a=>({...a,[t]:i}))},U=()=>{p(null),S(!1),Q(!0)},W=async t=>{if(t.preventDefault(),p(null),!V){S(!0);const i=h.find(a=>s[a.id]==null);i&&document.getElementById(`q-${i.id}`)?.scrollIntoView({behavior:"smooth",block:"center"});return}if(!n){p("Ce lien de questionnaire est incomplet (token manquant).");return}try{w(!0),await X({projectToken:n,answers:s}),o(!0)}catch(i){i instanceof Error&&i.message==="CLOSED"?F(!0):p(i instanceof Error?i.message:"Une erreur est survenue lors de l'enregistrement.")}finally{w(!1)}};if(c)return e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white rounded-brand border border-stone p-8 text-center max-w-sm",children:[e.jsx("div",{className:"w-14 h-14 bg-success-50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-7 h-7 text-success-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Merci pour votre participation"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Vos réponses ont été enregistrées avec succès."})]})});const $=m==="deep",O=m==="ueq"||m==="ueq_s"||m==="attrakdiff"||m==="attrakdiff_abridged";return e.jsx("div",{className:"min-h-screen bg-cream py-8 px-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:_?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sticky top-4 z-20 bg-white rounded-brand border border-stone p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"Progression"}),e.jsxs("span",{className:"text-xs font-medium text-slate-700",children:[y," / ",f]})]}),e.jsx("div",{className:"h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all duration-300",style:{width:`${f>0?y/f*100:0}%`}})})]}),e.jsxs("form",{onSubmit:W,className:"bg-white rounded-brand border border-stone p-6",children:[h.map((t,i)=>e.jsxs("div",{id:`q-${t.id}`,children:[t.type==="likert"&&!$&&e.jsx(te,{q:t,index:i,value:s[t.id]??null,onChange:a=>N(t.id,a),showError:b}),t.type==="likert"&&$&&e.jsx(se,{q:t,index:i,value:s[t.id]??null,onChange:a=>N(t.id,a),showError:b}),t.type==="bipolar"&&e.jsx(re,{q:t,index:i,value:s[t.id]??null,onChange:a=>N(t.id,a),showError:b,hideValueLabels:O})]},t.id)),v&&e.jsx("div",{className:"text-sm text-danger-600 bg-danger-50 px-3 py-2 rounded-lg mt-4",children:v}),b&&!V&&e.jsx("div",{className:"text-sm text-warning-600 bg-warning-50 px-3 py-2 rounded-lg mt-4",children:"Veuillez répondre à toutes les questions avant d'envoyer."}),e.jsx("div",{className:"mt-6 pt-4 border-t border-slate-100",children:e.jsx("button",{type:"submit",disabled:d,className:"btn-primary-sm w-full sm:w-auto disabled:opacity-70 disabled:cursor-not-allowed",children:d?"Envoi en cours...":"Envoyer mes réponses"})})]})]}):e.jsxs("div",{className:"bg-white rounded-brand border border-stone p-6",children:[e.jsx("h1",{className:"text-3xl font-serif text-ink",children:T||x.nameFr}),e.jsx("p",{className:"text-sm text-primary-600 font-medium mt-1",children:x.nameFr}),P?e.jsx("div",{className:"text-sm text-slate-600 mt-2 whitespace-pre-line",children:P}):e.jsx("div",{className:"text-sm text-slate-600 mt-2 [&_strong]:font-semibold [&_em]:italic",dangerouslySetInnerHTML:{__html:x.descriptionHtmlFr}}),e.jsx("div",{className:"mt-6 pt-4 border-t border-slate-100",children:e.jsx("button",{type:"button",onClick:U,className:"btn-primary-sm w-full sm:w-auto",children:"Commencer"})})]})})})}export{oe as PublicQuestionnairePage};
