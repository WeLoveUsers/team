const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DashboardPage-Da-wa_Do.js","assets/charts-DKGMT1ng.js","assets/react-DGBwUpAK.js","assets/api-Bvj00Ti9.js","assets/Sidebar-DvhsLLju.js","assets/index-DVf0JBI4.js","assets/index-CTH5po5s.css","assets/AdministrationPage-CcYDW7KY.js","assets/BrandFontsPage-Ce6gQYRT.js","assets/BrandGuidelinesPage-neZASnmR.js","assets/BrandSlidesPage-p88saKc7.js","assets/DocumentTemplatesPage-BNkXt40Z.js","assets/HomePage-BwOL9Jml.js","assets/LoginPage-CidcV3UO.js","assets/WorkingMethodPage-BXunb9Ir.js"])))=>i.map(i=>d[i]);
import{_ as j}from"./index-DVf0JBI4.js";import{j as e}from"./charts-DKGMT1ng.js";import{u as I,d as U,r as s,L as y,N as K,R as X,c as g,e as Y}from"./react-DGBwUpAK.js";import{f as Z,a as E}from"./api-Bvj00Ti9.js";let S={token:null,projects:null,inFlight:null};const F=new Set;function M(n){for(const a of F)a(n)}function J(){return typeof window>"u"?null:window.localStorage.getItem("authToken")}function N(){const n=J();return S.token!==n&&(S={token:n,projects:null,inFlight:null}),S}function z(){return N().projects}function Le(n){const a=N();a.projects=n,M(n)}async function V(){const n=N(),a=n.token;return n.projects?n.projects:(n.inFlight||(n.inFlight=Z().then(d=>{const p=N();return p.token===a&&(p.projects=d,M(d)),d}).finally(()=>{const d=N();d.token===a&&(d.inFlight=null)})),n.inFlight)}function ee(){S={token:null,projects:null,inFlight:null},M(null)}function te(n){return F.add(n),()=>{F.delete(n)}}function ne({state:n}){return n==="idle"?null:e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[n==="syncing"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-[1.5px] border-primary-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-slate-400",children:"Synchronisation..."})]}),n==="saved"&&e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3.5 h-3.5 text-success-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-slate-400",children:"Synchronisé"})]}),n==="error"&&e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3.5 h-3.5 text-danger-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),e.jsx("span",{className:"text-danger-500",children:"Erreur de sync"})]})]})}const se=[{to:"/modeles-documents#cadrage",label:"Cadrage"},{to:"/modeles-documents#terrain",label:"Terrain"},{to:"/modeles-documents#analyse",label:"Analyse"},{to:"/modeles-documents#restitution",label:"Restitution"},{to:"/modeles-documents#operationnel",label:"Opérationnel"}],$=[{to:"/",label:"Accueil",end:!0},{to:"/notre-facon-de-travailler",label:"Notre façon de travailler"},{to:"/questionnaires",label:"Questionnaires UX"},{to:"/charte-graphique",label:"Charte graphique",children:[{to:"/charte-graphique/fonts",label:"Fonts"},{to:"/charte-graphique/slides",label:"Slides"},{to:"/charte-graphique",label:"Design system",end:!0}]},{to:"/modeles-documents",label:"Modèles de documents",children:se},{to:"/administration",label:"Administration",separatorBefore:!0}],T="__sans_dossier__";function D(n){return n.to==="/questionnaires"||!!n.children?.length}function ae(n){return $.find(a=>D(a)&&(n===a.to||n.startsWith(`${a.to}/`)))}function re(n){return n.to==="/charte-graphique"?"/charte-graphique/fonts":n.to==="/questionnaires"?"/questionnaires#presentation":n.to}function oe({children:n,onLogout:a,fullBleed:d=!1,headerSyncState:p}){const o=I(),m=U(),i=ae(o.pathname),[b,v]=s.useState(i?.to??null),L=z(),[w,r]=s.useState(()=>L??[]),[f,x]=s.useState(!L),[u,Q]=s.useState(new Set),O=t=>t.end?o.pathname===t.to:o.pathname===t.to||o.pathname.startsWith(`${t.to}/`),H=t=>{const[l,h]=t.to.split("#");return h?o.pathname===l&&o.hash===`#${h}`:t.end?o.pathname===l:o.pathname===l||o.pathname.startsWith(`${l}/`)};s.useEffect(()=>{v(i?.to??null)},[o.pathname,i?.to]),s.useEffect(()=>{let t=!0;const l=z();l?(r(l),x(!1)):x(!0);const h=te(c=>{t&&(r(c??[]),x(!1))});return l||V().catch(c=>{console.error("Load questionnaires list failed:",c),t&&x(!1)}),()=>{t=!1,h()}},[]);const _=$.find(t=>t.to===b&&D(t)),B=!!_?.children||_?.to==="/questionnaires",G=o.pathname==="/questionnaires"&&(o.hash===""||o.hash==="#"||o.hash==="#presentation"),A=t=>o.pathname==="/questionnaires"&&(o.hash===`#project/${t}`||o.hash.startsWith(`#project/${t}/`)),{folders:R,ungrouped:P}=s.useMemo(()=>{const t=new Map,l=[];for(const c of w){const k=c.folder?.trim();k?(t.has(k)||t.set(k,[]),t.get(k).push(c)):l.push(c)}return{folders:Array.from(t.entries()).sort(([c],[k])=>c.localeCompare(k,"fr")),ungrouped:l}},[w]),W=t=>{Q(l=>{const h=new Set(l);return h.has(t)?h.delete(t):h.add(t),h})};return e.jsxs("div",{className:"h-screen bg-cream text-ink flex flex-col",children:[e.jsx("header",{className:"w-full bg-cream",children:e.jsxs("div",{className:"flex w-full items-center justify-between px-6 py-4",children:[e.jsxs(y,{to:"/",className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-serif text-2xl leading-none text-ink md:text-3xl",children:"We Love Users"}),e.jsx("span",{className:"brand-chip",children:"TEAM"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[p&&e.jsx(ne,{state:p}),e.jsx("button",{onClick:a,className:"btn-secondary-sm cursor-pointer justify-center",children:"Déconnexion"})]})]})}),e.jsxs("div",{className:"min-h-0 flex flex-1",children:[e.jsx("aside",{className:"w-72 shrink-0 px-3 pb-3",children:e.jsxs("div",{className:"relative h-full overflow-hidden rounded-brand border border-stone bg-white shadow-sm",children:[e.jsx("div",{className:`absolute inset-0 overflow-y-auto px-3 py-4 transition-transform duration-300 ease-out ${B?"-translate-x-full":"translate-x-0"}`,children:e.jsx("nav",{children:e.jsx("ul",{className:"space-y-2",children:$.map(t=>e.jsx("li",{className:t.separatorBefore?"nav-item-separator":"",children:D(t)?e.jsxs("button",{type:"button","aria-expanded":b===t.to,onClick:()=>{v(t.to),m(re(t))},className:`nav-link nav-link-toggle cursor-pointer ${O(t)?"active":""}`,children:[e.jsx("span",{children:t.label}),e.jsx("svg",{className:`h-4 w-4 ${O(t)?"text-flame":"text-taupe"}`,viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M7.22 4.22a.75.75 0 0 1 1.06 0l5.25 5.25a.75.75 0 0 1 0 1.06l-5.25 5.25a.75.75 0 1 1-1.06-1.06L11.94 10 7.22 5.28a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"})})]}):e.jsx(K,{to:t.to,end:t.end,onClick:()=>v(null),className:({isActive:l})=>`nav-link ${l?"active":""}`,children:t.label})},t.to))})})}),e.jsxs("div",{className:`absolute inset-0 overflow-y-auto border-l border-stone/70 bg-white/60 px-4 py-4 transition-transform duration-300 ease-out ${B?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("button",{type:"button",onClick:()=>v(null),className:"btn-secondary-sm mb-3 cursor-pointer",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})}),e.jsx("span",{children:"Retour"})]}),e.jsx("p",{className:"mb-3 text-[11px] font-medium uppercase tracking-[0.14em] text-flame",children:_?.label}),_?.to==="/questionnaires"?e.jsxs("nav",{children:[e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:e.jsx(y,{to:"/questionnaires#presentation",className:`subnav-link ${G?"active":""}`,children:"Présentation"})}),f?e.jsx("li",{children:e.jsx("span",{className:"subnav-link opacity-70",children:"Chargement..."})}):e.jsxs(e.Fragment,{children:[R.map(([t,l])=>{const h=u.has(t);return e.jsxs("li",{className:"pt-1",children:[e.jsxs("button",{type:"button",onClick:()=>W(t),className:"flex w-full items-center gap-1.5 rounded px-2 py-1.5 text-left text-xs font-semibold uppercase tracking-wide text-taupe transition-colors hover:bg-wash hover:text-ink",children:[e.jsx("svg",{className:`h-3 w-3 shrink-0 transition-transform ${h?"":"rotate-90"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.25,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}),e.jsx("svg",{className:"h-3.5 w-3.5 shrink-0 text-taupe/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),e.jsx("span",{className:"truncate",children:t}),e.jsx("span",{className:"ml-auto text-[10px] font-normal tracking-normal text-taupe",children:l.length})]}),!h&&e.jsx("ul",{className:"ml-1 mt-1 space-y-1",children:l.map(c=>e.jsx("li",{children:e.jsx(y,{to:`/questionnaires#project/${c.id}`,className:`subnav-link ${A(c.id)?"active":""}`,children:c.name||"(Sans titre)"})},c.id))})]},t)}),R.length>0&&P.length>0&&e.jsxs("li",{className:"pt-1",children:[e.jsxs("button",{type:"button",onClick:()=>W(T),className:"flex w-full items-center gap-1.5 rounded px-2 py-1.5 text-left text-xs font-semibold uppercase tracking-wide text-taupe transition-colors hover:bg-wash hover:text-ink",children:[e.jsx("svg",{className:`h-3 w-3 shrink-0 transition-transform ${u.has(T)?"":"rotate-90"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.25,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}),e.jsx("span",{className:"truncate",children:"Sans dossier"}),e.jsx("span",{className:"ml-auto text-[10px] font-normal tracking-normal text-taupe",children:P.length})]}),!u.has(T)&&e.jsx("ul",{className:"ml-1 mt-1 space-y-1",children:P.map(t=>e.jsx("li",{children:e.jsx(y,{to:`/questionnaires#project/${t.id}`,className:`subnav-link ${A(t.id)?"active":""}`,children:t.name||"(Sans titre)"})},t.id))})]}),R.length===0&&P.map(t=>e.jsx("li",{children:e.jsx(y,{to:`/questionnaires#project/${t.id}`,className:`subnav-link ${A(t.id)?"active":""}`,children:t.name||"(Sans titre)"})},t.id))]})]}),!f&&w.length===0&&e.jsx("p",{className:"px-3 py-2 text-xs text-taupe",children:"Aucun projet"})]}):e.jsx("nav",{children:e.jsx("ul",{className:"space-y-1.5",children:_?.children?.map(t=>e.jsx("li",{children:e.jsx(y,{to:t.to,className:`subnav-link ${H(t)?"active":""}`,children:t.label})},t.to))})})]})]})}),e.jsx("main",{className:d?"min-w-0 flex-1 min-h-0 overflow-hidden":"min-w-0 flex-1 min-h-0 overflow-y-auto px-6 py-10 md:px-8 md:py-12",children:n})]})]})}const le=6e4;let C={token:null,byProject:new Map};function ie(){return typeof window>"u"?null:window.localStorage.getItem("authToken")}function q(){const n=ie();return C.token!==n&&(C={token:n,byProject:new Map}),C.byProject}function ce(){C={token:null,byProject:new Map}}function Pe(){const[n,a]=s.useState([]),[d,p]=s.useState(!1),[o,m]=s.useState(!1),i=s.useRef(null),b=s.useCallback(async r=>{i.current=r;const f=q(),x=f.get(r);if(x){if(a(x.responses),p(!1),Date.now()-x.fetchedAt<le){m(!1);return}m(!0);try{const u=await E(r);i.current===r&&(a(u),f.set(r,{responses:u,fetchedAt:Date.now()}))}catch(u){console.error("Background refresh failed:",u)}finally{i.current===r&&m(!1)}}else{a([]),p(!0),m(!1);try{const u=await E(r);i.current===r&&(a(u),f.set(r,{responses:u,fetchedAt:Date.now()}))}catch(u){console.error("Load responses failed:",u),i.current===r&&a([])}finally{i.current===r&&p(!1)}}},[]),v=s.useCallback(async()=>{const r=i.current;if(r){m(!0);try{const f=await E(r);i.current===r&&(a(f),q().set(r,{responses:f,fetchedAt:Date.now()}))}catch(f){console.error("Refresh responses failed:",f)}finally{i.current===r&&m(!1)}}},[]),L=s.useCallback(r=>{q().delete(r)},[]),w=s.useCallback(()=>{i.current=null,a([]),p(!1),m(!1)},[]);return{responses:n,loading:d,backgroundRefreshing:o,loadResponses:b,refreshCurrent:v,invalidate:L,clear:w}}const de=s.lazy(async()=>({default:(await j(()=>import("./DashboardPage-Da-wa_Do.js"),__vite__mapDeps([0,1,2,3,4,5,6]))).DashboardPage})),ue=s.lazy(async()=>({default:(await j(()=>import("./AdministrationPage-CcYDW7KY.js"),__vite__mapDeps([7,1,2]))).AdministrationPage})),he=s.lazy(async()=>({default:(await j(()=>import("./BrandFontsPage-Ce6gQYRT.js"),__vite__mapDeps([8,1,2]))).BrandFontsPage})),pe=s.lazy(async()=>({default:(await j(()=>import("./BrandGuidelinesPage-neZASnmR.js"),__vite__mapDeps([9,1,2]))).BrandGuidelinesPage})),fe=s.lazy(async()=>({default:(await j(()=>import("./BrandSlidesPage-p88saKc7.js"),__vite__mapDeps([10,1,2]))).BrandSlidesPage})),me=s.lazy(async()=>({default:(await j(()=>import("./DocumentTemplatesPage-BNkXt40Z.js"),__vite__mapDeps([11,1,2]))).DocumentTemplatesPage})),xe=s.lazy(async()=>({default:(await j(()=>import("./HomePage-BwOL9Jml.js"),__vite__mapDeps([12,1,2]))).HomePage})),ge=s.lazy(async()=>({default:(await j(()=>import("./LoginPage-CidcV3UO.js"),__vite__mapDeps([13,1,2,3]))).LoginPage})),je=s.lazy(async()=>({default:(await j(()=>import("./WorkingMethodPage-BXunb9Ir.js"),__vite__mapDeps([14,1,2]))).WorkingMethodPage}));function ve(){return e.jsx("div",{className:"min-h-screen bg-cream flex items-center justify-center",children:e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})})}function be(){return e.jsx("div",{className:"flex items-center justify-center h-full py-24",children:e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})})}function ke(){const n=I(),[a,d]=s.useState(()=>!!localStorage.getItem("authToken")),[p,o]=s.useState("idle");s.useEffect(()=>{a&&V().catch(v=>{console.error("Preload projects failed:",v)})},[a]);const m=()=>{d(!0)},i=()=>{ee(),ce(),localStorage.removeItem("authToken"),d(!1)};if(!a)return e.jsx(s.Suspense,{fallback:e.jsx(ve,{}),children:e.jsx(ge,{onLogin:m,title:"Connexion requise",subtitle:"Connectez-vous pour accéder à l'espace Team."})});const b=n.pathname==="/questionnaires";return e.jsx(oe,{onLogout:i,fullBleed:b,headerSyncState:b?p:void 0,children:e.jsx(s.Suspense,{fallback:e.jsx(be,{}),children:e.jsxs(X,{children:[e.jsx(g,{path:"/",element:e.jsx(xe,{})}),e.jsx(g,{path:"/notre-facon-de-travailler",element:e.jsx(je,{})}),e.jsx(g,{path:"/charte-graphique",element:e.jsx(pe,{})}),e.jsx(g,{path:"/charte-graphique/slides",element:e.jsx(fe,{})}),e.jsx(g,{path:"/charte-graphique/fonts",element:e.jsx(he,{})}),e.jsx(g,{path:"/modeles-documents",element:e.jsx(me,{})}),e.jsx(g,{path:"/questionnaires",element:e.jsx(de,{onSyncStateChange:o})}),e.jsx(g,{path:"/administration",element:e.jsx(ue,{})}),e.jsx(g,{path:"*",element:e.jsx(Y,{to:"/",replace:!0})})]})})})}const Se=Object.freeze(Object.defineProperty({__proto__:null,default:ke},Symbol.toStringTag,{value:"Module"}));export{Se as A,V as e,z as g,Le as s,Pe as u};
